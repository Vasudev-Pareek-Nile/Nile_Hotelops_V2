{% extends "task/homebase.html" %} {% block content %}
 <style>
         table th{
            text-align: center;
          text-transform: uppercase;
        font-size: 11px; 
        font-family: arial nova;
  }
       td {
    text-align: center;
  }
  thead tr{
     background-color: #2F4050;
  }
   body{
    font-family: arial nova;
   font-size: 11px;  
    
  }
 #statusSelect {
    border: 1px solid transparent; 
    
}


#errorBorder {
    border-color: red !important;
}


    </style>
<div class="card">
 <div class="card-header">
  <div class="row">
    <div class="col-md-6">
      <h5 class="card-title">Filter Form</h5>
    </div>
    <div class="col-md-6 text-right">
      <a href="{% url 'task_add' %}" class="btn btn-primary"><strong>Add Task +</strong></a>
    </div>
  </div>
</div>
  <div class="card-body">
    <form method="GET">
      {% csrf_token %}
      <div class="row">
        <div class="col-md-3">
          <label for="">Hotel Name</label>
          <select name="project" class="form-control">
            <option value="">ALL</option>
            {% for organization in memOrg %}
            <option value="{{ organization.Organization_name }}" {% if organization.OrganizationID == selectedOrganizationID %}selected{% endif %}>
              {{ organization.Organization_name }}
            </option>
            {% endfor %}
          </select>
        </div>
       <div class="col-md-2">
    <label for="department">Department</label>
    <select name="department" class="form-control" id="department">
        <option value="">Select Department</option>
        {% for department in department_data %}
            <option value="{{ department.Department }}">{{ department.Department }}</option>
        {% endfor %}
    </select>
</div>
        <div class="col-md-2">
          <label for="">Status</label>
          <select name="status" class="form-control">
            <option value="">Select a Status</option>
            <option value="Completed" {% if task.status == "Completed" %}selected{% endif %}>Completed</option>
            <option value="In_Progress" {% if task.status == "In_Progress" %}selected{% endif %}>In Progress</option>
            <option value="In_Completed" {% if task.status == "In_Completed" %}selected{% endif %}>In Completed</option>
            <option value="Not_Applicable" {% if task.status == "Not_Applicable" %}selected{% endif %}>Not Applicable</option>
            <option value="Not_Started" {% if task.status == "Not_Started" %}selected{% endif %}>Not Started</option>
            <option value="Pending" {% if task.status == "Pending" %}selected{% endif %}>Pending</option>
          </select>
        </div>
        <div class="col-md-2">
          <input type="submit" class="btn btn-primary fa fa-filter" style="margin-top: 30px;" value="Filter" />
        </div>
      </div>
    </form>
  </div>
</div>
</br>
    
     <br> 
<div style="height: 400px; overflow-y: auto;">
    <table id="example" class="table table-bordered">
     <thead class="thead-" >
    <tr class="table-success">
        <th>Project</th>
        <th>Task Name</th>
        
        <th>Target Date</th>
        <th>Status</th>
       
        <th>Contact Name</th>
       
      

      <th>Department</th>
      <th>Additional Information</th>
      
      <th>Links Title</th>
      <th >Action</th>
    </tr>
     
</thead>
       <tbody> 
         {% for task in tasklist %}
    <tr>
      <td>{{task.project}}</td>
      <td>{{task.task_name}}</td>
      
     <td>
                    {% if task.DayBefore %}
                        {{ task.calculate_target_date|date }}
                    {% else %}
                        No target date specified
                    {% endif %}
                </td>
      <td>
    <form id="statusForm" method="post" action="{% url 'updatestuts' %}">
    {% csrf_token %}
   <select id="statusSelect" name="new_status" class="{% if error %}errorBorder{% endif %}">
    <option value="Completed" {% if task.status == "Completed" %}selected{% endif %}>Completed</option>
    <option value="In_Progress" {% if task.status == "In_Progress" %}selected{% endif %}>In Progress</option>
    <option value="In_Completed" {% if task.status == "In_Completed" %}selected{% endif %}>In Completed</option>
    <option value="Not_Applicable" {% if task.status == "Not_Applicable" %}selected{% endif %}>Not Applicable</option>
    <option value="Not_Started" {% if task.status == "Not_Started" %}selected{% endif %}>Not Started</option>
    <option value="Pending" {% if task.status == "Pending" %}selected{% endif %}>Pending</option>
    <!-- Include other options similarly -->
</select>
    <input type="hidden" name="task_id" value="{{ task.id }}">
</form>

        
        </td>
      {% comment %} <td>{{task.responsible_user}}</td> {% endcomment %}
      <td>{{task.contact_full_name}}</td>
      
      <td>{{task.department}}</td>
      <td>{{task.add_info}}</td>
      {% comment %} <td>{{task.link_of_project}}</td> {% endcomment %}
      <td>{{task.link_title}}</td>
      <td>
        <span class="one-line" style="position: relative">
           <a
            class="btn btn-primary btn-sm fa fa-edit"
            href="{% url 'task_add' %}?ID={{task.id}}"
            ></a
          >
          <a
            onclick="return confirm('Are you sure you want to delete this?')"
            class="btn btn-danger btn-sm fa fa-trash-o"
           href="{% url 'task_delet' %}?ID={{task.id}}"
            ></a
          > 
         
          {% comment %} <a
            class="btn btn-info btn-sm"
            href="{% url 'updatestatus' task.id %}"
            style="margin: 4px"
            >Update</a
          > {% endcomment %}
        </span>
      </td>
    </tr>

    {% endfor %}
      </tbody>
    </table>
   
  </div>
</div>
</div>
<link
  rel="stylesheet"
  href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.css"
/>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
$(document).ready(function () {
    
    $('#example thead tr')
        .clone(true)
        .addClass('filters')
        .appendTo('#example thead');

    
    var table = $('#example').DataTable({
        orderCellsTop: true,
        fixedHeader: true,
        initComplete: function () {
            var api = this.api();

           
            api.columns().eq(0).each(function (colIdx) {
                
                var cell = $('.filters th').eq(colIdx);
                var title = $(cell).text();
                $(cell).html('<input type="text" placeholder="' + title + '" />');

                $('input', cell)
                    .off('keyup change')
                    .on('keyup change', function () {
                        var val = $.fn.dataTable.util.escapeRegex($(this).val());

                        api.column(colIdx)
                            .search(val ? '^' + val + '$' : '', true, false)
                            .draw();
                    });
            });
        }
    });

    // Add event listener for select elements with name "new_status"
    var selectElements = document.querySelectorAll('select[name="new_status"]');
    selectElements.forEach(function (selectElement) {
        selectElement.addEventListener('change', function () {
            var form = this.closest('form');
            form.submit();
        });
    });
});
</script>



{% endblock content %}
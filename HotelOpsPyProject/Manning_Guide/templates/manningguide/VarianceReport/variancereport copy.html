{% extends "manningguide/homebase.html" %}
{% load maningfilter %}
{% block content %}
{% load static %}
<!DOCTYPE html>
<html>
<head>
    
    <style>
        .body{
            font-family: 'Arial Nova',
        }
        .actions {
            margin-left: 10px;
        }

        .actions a {
            margin-right: 5px;
            text-decoration: none;
            color: blue;
        }

        .actions a:hover {
            text-decoration: underline;
        }
        .custom-card {
            width: 98%;
            margin: auto;
        }
        .modal-dialog{
            width: 72%;
            max-width: 72%;
            min-width: 720px;
        }
        th, td {
            font-size: 13px;
            font-family: 'Arial Nova', Arial, sans-serif;
            border: 1px solid #ddd;
        }
        .input-small {
            width: 70px;
            height: 30px;
            border: none; 
            background: transparent; 
            text-align: center; 
        }
        th {
            text-align: center;
            font-size: 13px;
        }
        table {
            width: 100%;
        }
        .center-text {
            text-align: center;
        }
        .center-input {
            display: block;
            margin: 0 auto;
        }
        .form-control {
            font-size: 0.8rem;
        }
        th{
            text-transform:uppercase;
            text-align:center;
            line-height:1.7;
            vertical-align:middle
        }
        .table-container {
  max-height: 400px; /* adjust as needed */
  overflow-y: auto;
  border: 1px solid #ccc;
}

.table-container table {
  width: 100%;
  border-collapse: collapse;
}

.table-container th,
.table-container td {
  padding: 8px 12px;
  border: 1px solid #ccc;
  background: #fff;
  text-align: left;
}

.table-container thead th {
  position: sticky;
  top: 0;
  background-color: #f8f8f8;
  z-index: 1;
}

      
    </style>
    <style>
        .table-hover tbody tr:hover {
            background-color: #dae3dc; /* Change hover color to red */
             /* Optional: Change text color to white for better contrast */
        }
        .custom-checkbox {
            width: 20px; /* Adjust width */
            height: 15px; /* Adjust height */
            transform: scale(2.1); /* Adjust scale factor */
           
        }
        .HeaderWithColor{
            background-color:#edf0fb !important;
            {% comment %} color:black; {% endcomment %}
            border-color: #bdac9f !important;
            text-transform:uppercase !important;
        }
        .TableThColor{
            /* background-color:#edf0fb !important; */
            font-size:13px; 
            font-weight: bold !important;
        }

        .HeaderWithproperty{
            padding: 10px;
            margin-bottom: 10px;
        }
    </style>
    {% comment %} <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script> {% endcomment %}
    {% comment %} <script src="{% static 'assets/js/jquery-3.7.1.min.js' %}"></script> {% endcomment %}
</head>


<body>
<div class="card">
    <div class="card-header">
        <div class="row">
            <div class="col-md-6 text-uppercase"><strong>Variance Report</strong></div>
        </div>
    </div>
    <form method="get_item">
        <div class="row">
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <div class="col-lg-3">
                <select name="hotel_name" style="margin-right: 20px;" class="form-control select">
                    {% for itm in memOrg %}
                        <option value="{{ itm.OrganizationID }}" {% if itm.OrganizationID == selectedOrganizationID %}selected{% endif %}>
                            {{ itm.Organization_name }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-1"  style="display:none">
                <select name="divisionname" class="form-control select" >
                    <option value="All Division">All Division</option>
                    {% for Divisiondata in Divisiondatas %}
                        <option value="{{ Divisiondata.DivisionName }}" {% if Divisiondata.DivisionName == selected_division %}selected{% endif %}>
                            {{ Divisiondata.DivisionName }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-2 "  style="display:none">
                <select name="departmentname" class="form-control select">
                    <option value="All Department">All Department</option>
                    {% for department in Departmentsdatas %}
                        <option value="{{ department.DepartmentName }}" {% if department.DepartmentName == selected_department %}selected{% endif %}>
                            {{ department.DepartmentName }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="col-md-2" >
                <div class="input-group input-group-sm">
                    <div class="input-group-prepend d-flex align-items-center">
                        <label class="input-group-text mb-0 ml-2" for="exclude_zero_headcount" style="padding: 10px;">
                            <input type="checkbox" name="exclude_zero_headcount" class="custom-checkbox" value="0" id="exclude_zero_headcount" {% if request.get_item.exclude_zero_headcount %}checked{% endif %} style="margin-right: 10px;">
                            Excluding 0 Head Count</label>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3">
                <button type="submit" class="btn btn-primary btn-sm " style="margin-right: 10px; padding: 10px;">
                    <i class="fa fa-filter"></i> Filter
                </button>
                <a class="btn btn-primary btn-sm" style="margin-right: 10px; padding: 10px;" data-bs-toggle="modal" data-bs-target=".bd-example-modal-sm">
                    Export
                </a>
                <button class="btn btn-secondary btn-sm " id="exportBtn" style="padding: 10px;">Export Excel</button>
            </div>
        </div>
    </form>
</div> 
    
{% comment %} </div> {% endcomment %}
{% if SelHotelName and SelHotelName != 'Select' %}
    <h3>Selected Hotel:</h3>
    <p>Hotel ID: {{ SelHotelName }}</p>
{% endif %}

        
    
    
    <div class="card">
        <div class="card-body ">
            
                <input type="hidden" name="hotel_name" value="{{ hotel_name }}" />

               
                <br>
                <h4 class="HeaderWithColor HeaderWithproperty">ON ROLL MANNING</h4>
                <div class="table-container">
                <table class="table table-striped table-hover" id="myTable">
                    <thead>
                       <tr>
                        <th class="TableThColor">DIV</th>
                        <th class="TableThColor">DEPT</th>
                        <th class="TableThColor">POSITION</th>
                        <th class="TableThColor">BUDGETED<br/> AVG SALARY</th>
                        <th class="TableThColor">ACTUAL <br/>AVG SALARY</th>
                        <th class="TableThColor">VARIANCE <br/>AVG SALARY</th>
                        <th class="TableThColor">BUDGETED <br/>HEAD COUNT</th>
                        <th class="TableThColor">ACTUAL <br/>HEAD COUNT</th>
                        <th class="TableThColor">VARIANCE <br/>HEAD COUNT</th>
                        <th class="TableThColor">BUDGETED <br/>TOTAL CTC</th>
                        <th class="TableThColor">ACTUAL <br/>TOTAL CTC</th>
                        <th class="TableThColor">VARIANCE <br/>TOTAL CTC</th>
                    </tr>
                    </thead>
                 <tbody>
                    
              
                    {% if divisions %}
                    {% for division in divisions %}
                    {%if forloop.counter0 != 0 %}
                    {% comment %} <tr style="background-color:#fff !important;">
                        <td colspan="12"  style="background-color:#fff !important;">&nbsp;</td>
                    </tr> {% endcomment %}
                    {%endif%}
                    {% comment %} <tr>
                        <td colspan="12" class="HeaderWithColor"><strong>{{ division.DivisionName }}</strong></td>
                    </tr> {% endcomment %}
                    {% for department in division.onrolldepartmentmaster_set.all %}
                    {% comment %} <tr>
                        <td colspan="12" style="background-color: #6a6162; color: #fff; text-transform: uppercase;"><strong> {{ department.DepartmentName }}<strong></td>
                    </tr>
                    {% endcomment %}
                    {% for designation in department.onrolldesignationmaster_set.all %}
                    {% with emp=employees_dict|get:department.DepartmentName|get:designation.designations %}
                    {% with budget=budgets_dict|get:department.DepartmentName|get:designation.designations %}
                    {% with variance=variance_dict|get:department.DepartmentName|get:designation.designations %}
                    {% if emp.num_employees > 0 or not exclude_zero_headcount %}
                    <tr data-division="{{ division.DivisionName }}" data-department="{{ department.DepartmentName }}" data-designation="{{ designation.designations }}">
                        <td style="width: 70px;">{{ division.DivisionName }}</td>
                        <td style="width: 70px;">{{ department.DepartmentName }}</td>
                        <td style="width: 310px;">{{ designation.designations }}</td>
                        <td style="width: 120px; text-align: right;">{{ budget.aavg_salary|formatingdata }}</td>
                        <td style="width: 120px; text-align: right;">{{ emp.avg_salary|formatingdata }}</td>
                        <td style=" width: 120px; text-align: right; color: {% if variance.variance_salary > 0 %}red{% elif variance.variance_salary < 0 %}green{% else %}black{% endif %};">
                            {{ variance.variance_salary|formatingdata }}
                        </td>
                        <td style="width: 90px; text-align: center;">{{ budget.head_count|default:'0' }}</td>
                        <td style="width: 90px; text-align: center;">{{ emp.num_employees|default:'0' }}</td>
                        <td style="width: 90px; text-align: center; color: {% if variance.variance_head_count > 0 %}red{% elif variance.variance_head_count < 0 %}green{% else %}black{% endif %};">
                            {{ variance.variance_head_count|default:'0' }}
                        </td>
                        <td style=" width: 120px; text-align: right;">{{ budget.budgetmultiplication_result|formatingdata }}</td>
                        <td style=" width: 120px; text-align: right;">{{ emp.multiplication_result|formatingdata }}</td>
                        <td style=" width: 120px; text-align: right; color: {% if variance.variance_total_result > 0 %}red{% elif variance.variance_total_result < 0 %}green{% else %}black{% endif %};">
                            {{ variance.variance_total_result|formatingdata }}
                        </td>
                    </tr>
                    {% endif %}
                    {% endwith %}
                    {% endwith %}
                    {% endwith %}
                {% endfor %}
                

                 <tr data-division="{{ division.DivisionName }}" data-department="{{ department.DepartmentName }}">
                        <td colspan="3" style="text-transform: uppercase;">
                            {{ department.DepartmentName }} Total
                            <input type="hidden" name="department_ID_{{ forloop.counter0 }}" value="{{ department.id }}" />
                        </td>
                        <td style="width: 120px;   text-align: right;">{{department_totals|get:department.DepartmentName|get:"aavg_salary"|formatingdata|default:"0" }}</td>
                        <td style="width: 120px;   text-align: right;">{{departmentemp_totals|get:department.DepartmentName|get:"total_salarymulti"|formatingdata|default:"0" }}</td></td>
                        <td style="text-align: right; color: {% if department_variance_dict|get:division.DivisionName|get:"variance_salary_multi" < 0 %}green{% else %}red{% endif %};">
                            {{ department_variance_dict|get:division.DivisionName|get:"variance_salary_multi"|formatingdata|default:"0" }}
                        </td>
                        
                        <td style="text-align: center;">{{department_totals|get:department.DepartmentName|get:"total_headcount"|formatingdata|default:"0" }}</td>
                        <td style="text-align: center;">{{departmentemp_totals|get:department.DepartmentName|get:"total_headcount"|formatingdata|default:"0" }}</td>
                        <td style="text-align: center; color: {{ department_variance_dict|get:division.DivisionName|get:"variance_headcount"|variance_color }};">
                            {{ department_variance_dict|get:division.DivisionName|get:"variance_headcount"|formatingdata|default:"0" }}
                        </td>
                        <td style="text-align: right;">{{department_totals|get:department.DepartmentName|get:"salary_headcount_product"|formatingdata|default:"0" }}</td>
                        <td style="text-align: right;">{{departmentemp_totals|get:department.DepartmentName|get:"salary_headcount_product"|formatingdata|default:"0" }}</td>
                        <td style="text-align: right; color: {{ department_variance_dict|get:division.DivisionName|get:"variance_salary_headcount_product"|variance_color }};">
                            {{ department_variance_dict|get:division.DivisionName|get:"variance_salary_headcount_product"|formatingdata|default:"0" }}
                        </td>
                        
                    </tr> 
                    {% endfor %}
                    
                    <tr data-division="{{ division.DivisionName }}" style="background-color:  #84aba7; color: #fff;">
                        <td colspan="3" style="text-transform: uppercase; ">{{ division.DivisionName }} TOTAL
                            <input type="hidden" name="division_ID_{{ forloop.counter0 }}" value="{{ division.id }}" />
                        </td>
                        <td style="width: 120px; text-align: right;">{{ divisiononroll_dict|get:division.DivisionName|get:"onrollonmultiplication_result"|formatingdata|default:"0" }}</td>
                        <td style="width: 120px; text-align: right;">{{ division_totals|get:division.DivisionName|get:"divisiontotal_salarymulti"|formatingdata|default:"0" }}</td>
                        <td style="width: 120px; text-align: right; color: {{ division_variance_dict|get:division.DivisionName|get:"variance_salary_multi"|variance_color }};">
                            {{ division_variance_dict|get:division.DivisionName|get:"variance_salary_multi"|formatingdata|default:"0" }}
                        </td>
                        <td style="text-align: center;">{{ divisiononroll_dict|get:division.DivisionName|get:"onrolldivisiontotal_headcount"|formatingdata|default:"0" }}</td>
                        <td style="text-align: center;">{{ division_totals|get:division.DivisionName|get:"divisiontotal_headcount"|formatingdata|default:"0" }}</td>
                        <td style="text-align: center; color: {{ division_variance_dict|get:division.DivisionName|get:"variance_headcount"|variance_color }};">
                            {{ division_variance_dict|get:division.DivisionName|get:"variance_headcount"|formatingdata|default:"0" }}
                        </td>
                        <td style="text-align: right;">{{ divisiononroll_dict|get:division.DivisionName|get:"onrolldivisionsalary_headcount_product"|formatingdata|default:"0" }}</td>
                        <td style="text-align: right;">{{ division_totals|get:division.DivisionName|get:"divisionsalary_headcount_product"|formatingdata|default:"0" }}</td>
                        <td style="text-align: right; color: {{ division_variance_dict|get:division.DivisionName|get:"variance_salary_headcount_product"|variance_color }};">
                            {{ division_variance_dict|get:division.DivisionName|get:"variance_salary_headcount_product"|formatingdata|default:"0" }}
                        </td>
                    
                    </tr>
                    {% endfor %}
                {% else %}
                <tr>
                    <td colspan="12">Data not found for selected hotel.</td>
                </tr>
                {% endif %}
                <tr>
                    <td colspan="12"  ><strong>&nbsp;</strong></td>
                </tr>
               
                 <tr>
                    <td colspan="3" style="text-transform: uppercase; width: 285px;"><strong>GRAND TOTAL</strong></td>
                    <td style="width: 120px; text-align: right;">
                        {{ grandtotalondatabudget|formatingdata|default:"0" }}
                    </td>

                    <td style="width: 120px; text-align: right;">
                        {{ grandtotalondataemp|formatingdata }}
                    </td>

                    <td style="width: 120px; text-align: right; color: {{ variance_detaavg_salary|variance_color }};">
                        {{ variance_detaavg_salary|formatingdata }}
                    </td>

                   
                    <td style="text-align: center;">
                        {{ headgrandtotalondatabudget|default:"0" }}
                    </td>
                    <td style="text-align: center;">
                        {{ grandtotalondataemp_headcount|default:"0" }}
                    </td>

                    <td style="text-align: center; color: {{ variance_detaheadcount|variance_color }};">
                        {{ variance_detaheadcount }}
                    </td>

                    <td style="width: 120px; text-align: right;">
                        {{ orrollServicesgrandsalarydivion|formatingdata }}
                    </td>

                    <td style="width: 120px; text-align: right;">
                        {{ Servicesgrandsalarydivion|formatingdata }}
                    </td>

                    <td style="width: 120px; text-align: right; color: {{ variance_detatotal_ctc|variance_color }};">
                        {{ variance_detatotal_ctc|formatingdata }}
                    </td>
                </tr>
                 
                
            </tbody>
        </table>
    </div>
        <h4 class="HeaderWithColor HeaderWithproperty">DEPARTMENT TOTAL</h4>
        <table class="table table-striped table-hover" id="myTable2" >
            <thead>
                <tr>
                    <th class="TableThColor" colspan="3">DEPARTMENT TOTAL</th>
                    <th class="TableThColor">BUDGETED AVG SALARY</th>
                    <th class="TableThColor">ACTUAL AVG SALARY</th>
                    <th class="TableThColor">VARIANCE AVG SALARY</th>
                    <th class="TableThColor">BUDGETED HEAD COUNT</th>
                    <th class="TableThColor">ACTUAL HEAD COUNT</th>
                    <th class="TableThColor">VARIANCE HEAD COUNT</th>
                    <th class="TableThColor">BUDGETED TOTAL CTC</th>
                    <th style="background-color: #34444c;  color: #fff; font-size: 13px;">ACTUAL TOTAL CTC</th>
                    <th class="TableThColor">VARIANCE TOTAL CTC</th>
                </tr>
            </thead>
         <tbody>
            
        {% if divisions %}
            {% for division in divisions %}
           
            {% for department in division.onrolldepartmentmaster_set.all %}
          
          
            {% for designation in department.onrolldesignationmaster_set.all %}
           
        {% endfor %}
        

         <tr data-division="{{ division.DivisionName }}" data-department="{{ department.DepartmentName }}">
                <td colspan="3" style="text-transform: uppercase;">
                    {{ department.DepartmentName }} 
                    <input type="hidden" name="department_ID_{{ forloop.counter0 }}" value="{{ department.id }}" />
                </td>
                <td style="width: 120px;   text-align: right;">{{department_totals|get:department.DepartmentName|get:"aavg_salary"|formatingdata|default:"0" }}</td>
                <td style="width: 120px;   text-align: right;">{{departmentemp_totals|get:department.DepartmentName|get:"total_salarymulti"|formatingdata|default:"0" }}</td></td>
                <td style="text-align: right; color: {% if department_variance_dict|get:division.DivisionName|get:"variance_salary_multi" < 0 %}green{% else %}red{% endif %};">
                    {{ department_variance_dict|get:division.DivisionName|get:"variance_salary_multi"|formatingdata|default:"0" }}
                </td>
                
                <td style="text-align: center;">{{department_totals|get:department.DepartmentName|get:"total_headcount"|formatingdata|default:"0" }}</td>
                <td style="text-align: center;">{{departmentemp_totals|get:department.DepartmentName|get:"total_headcount"|formatingdata|default:"0" }}</td>
                <td style="text-align: center; color: {{ department_variance_dict|get:division.DivisionName|get:"variance_headcount"|variance_color }};">
                    {{ department_variance_dict|get:division.DivisionName|get:"variance_headcount"|formatingdata|default:"0" }}
                </td>
                <td style="text-align: right;">{{department_totals|get:department.DepartmentName|get:"salary_headcount_product"|formatingdata|default:"0" }}</td>
                <td style="text-align: right;">{{departmentemp_totals|get:department.DepartmentName|get:"salary_headcount_product"|formatingdata|default:"0" }}</td>
                <td style="text-align: right; color: {{ department_variance_dict|get:division.DivisionName|get:"variance_salary_headcount_product"|variance_color }};">
                    {{ department_variance_dict|get:division.DivisionName|get:"variance_salary_headcount_product"|formatingdata|default:"0" }}
                </td>
                
            </tr> 
            {% endfor %}
        
            {% endfor %}
        {% else %}
        <tr>
            <td colspan="12">Data not found for selected hotel.</td>
        </tr>
        {% endif %}
      
    </tbody>
</table>


               
                <h4 class="HeaderWithColor HeaderWithproperty">CONTRACT MANNING</h4>

                <table class="table table-striped  custom-table" id="myTable3" >
                 <thead>
                     <tr>
                         <th class="TableThColor">DIV</th>
                         <th class="TableThColor">DEPT</th>
                         <th class="TableThColor">POSITION</th>
                         <th class="TableThColor">BUDGETED AVG SALARY</th>
                         <th class="TableThColor">ACTUAL AVG SALARY</th>
                         <th class="TableThColor">VARIANCE AVG SALARY</th>
                         <th class="TableThColor">BUDGETED HEAD COUNT</th>
                         <th class="TableThColor">ACTUAL HEAD COUNT</th>
                         <th class="TableThColor">VARIANCE HEAD COUNT</th>
                         <th class="TableThColor">BUDGETED TOTAL CTC</th>
                         <th style="background-color: #34444c;  color: #fff; font-size: 13px;">ACTUAL TOTAL CTC</th>
                         <th class="TableThColor">VARIANCE TOTAL CTC</th>
                     </tr>
                 </thead>
                 <tbody>
                     {% if divisions %}
                         {% for division in contractdivisions %}
                         <tr>
                             <td colspan="12"  style="background-color: #f3f3f3;"><strong>&nbsp;</strong></td>
                         </tr>
                             <tr>
                                 <td colspan="12" class="HeaderWithColor"><strong>{{ division.DivisionName }}</strong></td>
                             </tr>
                             {% for department in division.contractdepartmentmaster_set.all %}
                                 <tr>
                                     <td colspan="12" style="background-color: #6a6162; color: #fff; text-transform: uppercase;"><strong> {{ department.DepartmentName }}<strong></td>
                                 </tr>
                                 
                                 {% for designation in department.contractdesignationmaster_set.all %}
                                 {% with item=actual_dict|get:department.DepartmentName|get:designation.designations %}
                                 {% with itembudget=budget_dict|get:department.DepartmentName|get:designation.designations %}
                                 {% with variance=variance_contract_dict|get:department.DepartmentName|get:designation.designations %}
                                 <tr data-division="{{ division.DivisionName }}" data-department="{{ department.DepartmentName }}" data-designation="{{ designation.designations }}">
                                     <td style="width: 80px;">{{ designation.Div }}</td>
                                     <td style="width: 80px;">{{ department.DepartmentName }}</td>
                                     <td style="width: 310px;">{{ designation.designations }}</td>
                                     <td style="width: 120px; text-align: right;">{{ itembudget.budget_avg_salary|formatingdata }}</td>
                                     <td style="width:  120px;text-align: right;">{{ item.actual_avg_salary|formatingdata }}</td>
                                     <td style="width: 120px; text-align: right; color: {% if variance.variance_avg_salary > 0 %}red{% elif variance.variance_avg_salary < 0 %}green{% else %}black{% endif %};">
                                         {{ variance.variance_avg_salary|formatingdata }}
                                     </td>
                                     <td style="width: 90px; text-align: center;">{{ itembudget.budget_head_count|default:'0' }}</td>
                                     <td style=" width: 90px; text-align: center;">{{ item.actual_head_count|default:'0' }}</td>
                                     <td style="width: 90px; text-align: center; color: {% if variance.variance_head_count > 0 %}red{% elif variance.variance_head_count < 0 %}green{% else %}black{% endif %};">
                                         {{ variance.variance_head_count|default:"0" }}
                                     </td>
                                     <td style="width: 120px; text-align: right;">{{ itembudget.budget_total_ctc|formatingdata }}</td>
                                     <td style=" width: 120px; text-align: right;">{{ item.actual_total_ctc|formatingdata }}</td>
                                     <td style="width: 120px; text-align: right; color: {% if variance.variance_total_ctc > 0 %}red{% elif variance.variance_total_ctc < 0 %}green{% else %}black{% endif %};">
                                         {{ variance.variance_total_ctc|formatingdata }}
                                     </td>
                                 </tr>
                                 {% endwith %}
                                 {% endwith %}
                                 {% endwith %}
                             {% endfor %}
                               <tr data-division="{{ division.DivisionName }}" data-department="{{ department.DepartmentName }}" style="background-color: #d9d9d9;">
                                 <td colspan="3" style="text-transform: uppercase;">
                                     <b>{{ department.DepartmentName }} TOTAL<b>
                                     <input type="hidden" name="department_ID_{{ forloop.counter0 }}" value="{{ department.id }}" />
                                 </td>
                                 <td style=" text-align: right;">{{ onrollContractdepartment_totals|get:department.DepartmentName|get:"Contractmultiplication_result"|formatingdata|default:"0" }}</td>
                                 <td style=" text-align: right;">{{ Contractdepartment_totals|get:department.DepartmentName|get:"Contractmultiplication_result"|formatingdata|default:"0" }}</td>
                                 <td style="text-align: right; color: {{ onrolldepartment_variance_dict|get:department.DepartmentName|get:"variance_multiplication_result"|variance_color }};">
                                     {{ onrolldepartment_variance_dict|get:department.DepartmentName|get:"variance_multiplication_result"|formatingdata|default:"0" }}
                                 </td>
                                 <td style=" text-align: center;">{{ onrollContractdepartment_totals|get:department.DepartmentName|get:"Contracthead_count"|formatingdata|default:"0" }}</td>
                                 <td style=" text-align: center;">{{ Contractdepartment_totals|get:department.DepartmentName|get:"Contracthead_count"|default:"0" }}</td>
                                 <td style="text-align: center; color: {{ onrolldepartment_variance_dict|get:department.DepartmentName|get:"variance_head_count"|variance_color }};">
                                     {{ onrolldepartment_variance_dict|get:department.DepartmentName|get:"variance_head_count"|formatingdata|default:"0" }}
                                 </td>
                                 <td style=" text-align: right;">{{ onrollContractdepartment_totals|get:department.DepartmentName|get:"salary_headcount_contract"|formatingdata|default:"0" }}</td>
                                 
                                 <td style=" text-align: right;">{{ Contractdepartment_totals|get:department.DepartmentName|get:"salary_headcount_contract"|formatingdata|default:"0" }}</td>
                                 <td style="text-align: right; color: {{ onrolldepartment_variance_dict|get:department.DepartmentName|get:"variance_salary_headcount_contract"|variance_color }};">
                                     {{ onrolldepartment_variance_dict|get:department.DepartmentName|get:"variance_salary_headcount_contract"|formatingdata|default:"0" }}
                                 </td>
                             </tr> 
                                  
                             {% endfor %}
                             <tr data-division="{{ division.DivisionName }}" style="background-color:  #84aba7; color: #fff;">
                                 <td colspan="3" style="text-transform: uppercase; text-align: center;"><b>{{ division.DivisionName }} TOTAL<b>
                                     <input type="hidden" name="division_ID_{{ forloop.counter0 }}" value="{{ division.id }}" />
                                 </td>
                                 <td style="text-align: right; width: 50px;">{{ onrollContractdivision_totals|get:division.DivisionName|get:"Contractdivisionmultiplication_result"|formatingdata|default:"0" }}</td>
                                 <td style=" text-align: right;">{{ Contractdivision_totals|get:division.DivisionName|get:"Contractdivisionmultiplication_result"|formatingdata|default:"0" }}</td>
                                 <td style="text-align: right; color: {{ onrolldivision_variance_dict|get:division.DivisionName|get:'variance_multiplication_result'|variance_color }};">
                                     {{ onrolldivision_variance_dict|get:division.DivisionName|get:'variance_multiplication_result'|formatingdata|default:"0" }}
                                 </td>
                                 <td style=" text-align: center;">{{ onrollContractdivision_totals|get:division.DivisionName|get:"Contractdivisiontotal_headcount"|formatingdata|default:"0" }}</td>
                                 <td style=" text-align: center;">{{ Contractdivision_totals|get:division.DivisionName|get:"Contractdivisiontotal_headcount"|formatingdata|default:"0" }}</td>
                                 <td style="text-align: center; color: {{ onrolldivision_variance_dict|get:division.DivisionName|get:'variance_head_count'|variance_color }};">
                                     {{ onrolldivision_variance_dict|get:division.DivisionName|get:'variance_head_count'|formatingdata|default:"0" }}
                                 </td>
                                 <td style=" text-align: right;">{{ onrollContractdivision_totals|get:division.DivisionName|get:"Contractdivisionsalary_headcount_product"|formatingdata|default:"0" }}</td>
                                
                                 <td style=" text-align: right;">{{ Contractdivision_totals|get:division.DivisionName|get:"Contractdivisionsalary_headcount_product"|formatingdata|default:"0" }}</td>
                                 <td style="text-align: right; color: {{ onrolldivision_variance_dict|get:division.DivisionName|get:'variance_salary_headcount_product'|variance_color }};">
                                     {{ onrolldivision_variance_dict|get:division.DivisionName|get:'variance_salary_headcount_product'|formatingdata|default:"0" }}
                                 </td>
                             </tr>  
                         {% endfor %}
                     {% else %}
                       
                     {% endif %}
                     <tr>
                         <td colspan="12"  ><strong>&nbsp;</strong></td>
                     </tr>
                     <tr>
                         <td colspan="3" style="text-transform: uppercase; width: 285px;"><strong>GRAND TOTAL<strong></td>
                             <td style="width: 120px; text-align: right;">
                                 {{ budgetcontractgrandtotalondataemp|formatingdata|default:"0" }}
                             </td>
         
                             <td style="width: 120px; text-align: right;">
                                 {{ enterycontractdetasgrand|formatingdata|default:"0" }}
                             </td>
         
                             <td style="width: 120px; text-align: right; color: {{ datavariance_detaavg_salary|variance_color }};">
                                 {{ datavariance_detaavg_salary|formatingdata|default:"0" }}
                             </td>
                             
         
                            
                             <td style="text-align: center;">
                                 {{ budgetcontractgrandtotalondataemp_headcount|formatingdata|default:"0" }}
                             </td>
                             <td style="text-align: center;">
                                 {{ enterycontractdetasheadgrandtotalon|formatingdata|default:"0" }}
                             </td>
         
                             <td style="text-align: center; color: {{ datavariance_detaheadcount|variance_color }};">
                                 {{ datavariance_detaheadcount|formatingdata|default:"0" }}
                             </td>
         
                             <td style="width: 120px; text-align: right;">
                                 {{ budgetcontractdatagrandsalarydivion|formatingdata|default:"0" }}
                             </td>
         
                             <td style="width: 120px; text-align: right;">
                                 {{ enterycontractempgrandsalarydivion|formatingdata|default:"0" }}
                             </td>
         
                             <td style="width: 120px; text-align: right; color: {{ datavariance_detatotal_ctc|variance_color }};">
                                 {{ datavariance_detatotal_ctc|formatingdata|default:"0" }}
                             </td>
                             
                     </tr>
                 </tbody>
             </table>
        <br>

        <h4 class="HeaderWithColor HeaderWithproperty">SHARED SERVICES MANNING</h4>

               <table class="table table-striped  custom-table" id="myTable4" >
                <thead>
                    <tr>
                        <th class="TableThColor">DIV</th>
                        <th class="TableThColor">DEPT</th>
                        <th class="TableThColor">POSITION</th>
                        <th class="TableThColor">BUDGETED AVG SALARY</th>
                        <th class="TableThColor">ACTUAL AVG SALARY</th>
                        <th class="TableThColor">VARIANCE AVG SALARY</th>
                        <th class="TableThColor">BUDGETED HEAD COUNT</th>
                        <th class="TableThColor">ACTUAL HEAD COUNT</th>
                        <th class="TableThColor">VARIANCE HEAD COUNT</th>
                        <th class="TableThColor">BUDGETED TOTAL CTC</th>
                        <th style="background-color: #34444c;  color: #fff; font-size: 13px;">ACTUAL TOTAL CTC</th>
                        <th class="TableThColor">VARIANCE TOTAL CTC</th>
                    </tr>
                </thead>
                <tbody>
                    {% if divisions %}
                        {% for division in Servicedivisions %}
                        <tr>
                            <td colspan="12"  style="background-color: #f3f3f3;"><strong>&nbsp;</strong></td>
                        </tr>
                            <tr>
                                <td colspan="12" class="HeaderWithColor"><strong>{{ division.DivisionName }}</strong></td>
                            </tr>
                            {% for department in division.servicesdepartmentmaster_set.all %}
                                <tr>
                                    <td colspan="12" style="background-color: #6a6162; color: #fff; text-transform: uppercase;"><strong> {{ department.DepartmentName }}<strong></td>
                                </tr>
                              
                                {% for designation in department.servicesdesignationmaster_set.all %}
                                {% with item=actualservice_dict|get:department.DepartmentName|get:designation.designations %}
                                {% with itembudget=budgetservice_dict|get:department.DepartmentName|get:designation.designations %}
                                {% with variance=variance_shared_services_dict|get:department.DepartmentName|get:designation.designations %}
                                <tr data-division="{{ division.DivisionName }}" data-department="{{ department.DepartmentName }}" data-designation="{{ designation.designations }}">
                                    <td style="width: 80px;">{{ designation.Div }}</td>
                                    <td style="width: 80px;">{{ designation.Dept }}</td>
                                    <td style="width: 310px;">{{ designation.designations }}</td>
                                    <td style="width: 120px; text-align: right;">{{ itembudget.budgetservice_avg_salary|formatingdata }}</td>
                                    <td style="width: 120px; text-align: right;">{{ item.actualservice_avg_salary|formatingdata }}</td>
                                    <td style="width: 120px; text-align: right; color: {% if variance.variance_avg_salary > 0 %}red{% elif variance.variance_avg_salary < 0 %}green{% else %}black{% endif %};">
                                        {{ variance.variance_avg_salary|formatingdata }}
                                    </td>
                                    <td style="width: 90px; text-align: center;">{{ itembudget.budgetservice_head_count|default:'0' }}</td>
                                    <td style=" width: 90px; text-align: center;">{{ item.actualservice_head_count|default:'0' }}</td>
                                    <td style=" width: 90px; text-align: center; color: {% if variance.variance_head_count > 0 %}red{% elif variance.variance_head_count < 0 %}green{% else %}black{% endif %};">
                                        {{ variance.variance_head_count|default:'0' }}
                                    </td>
                                    <td style=" width: 120px; text-align: right;">{{ itembudget.budgetservice_total_ctc|formatingdata }}</td>
                                    <td style=" width: 120px; text-align: right;">{{ item.actualservice_total_ctc|formatingdata }}</td>
                                    <td style=" width: 120px;text-align: right; color: {% if variance.variance_total_ctc > 0 %}red{% elif variance.variance_total_ctc < 0 %}green{% else %}black{% endif %};">
                                        {{ variance.variance_total_ctc|formatingdata }}
                                    </td>
                                </tr>
                                {% endwith %}
                                {% endwith %}
                                {% endwith %}
                            {% endfor %}
                              <tr data-division="{{ division.DivisionName }}" data-department="{{ department.DepartmentName }}" style="background-color: #f3f3f3;">
                                <td colspan="3" style="text-transform: uppercase;">{{ department.DepartmentName }} Total</td>
                               
                                <td style=" width: 120px; text-align: right;">{{ totaldepartmentservices_dict|get:department.DepartmentName|get:"TotalServicesmultiplication_result"|default:"0" }}</td>
                                <td  style="width: 120px; text-align: right;">{{ departmentservices_dict|get:department.DepartmentName|get:"TotalServicesmultiplication_result"|formatingdata|default:"0" }}</td>
                                
                                <td style="width: 120px; text-align: right; color: {{ onrolldepartment_variance_dictss|get:department.DepartmentName|get:'variance_multiplication_result'|variance_color }};">
                                    {{ onrolldepartment_variance_dictss|get:department.DepartmentName|get:'variance_multiplication_result'|formatingdata|default:"0" }}
                                </td>
                                
                                <td style=" width: 90px; text-align: center;">{{ totaldepartmentservices_dict|get:department.DepartmentName|get:"TotalServiceshead_count"|default:"0" }}</td>
                                <td style="width: 90px; text-align: center;">{{ departmentservices_dict|get:department.DepartmentName|get:"TotalServiceshead_count"|formatingdata|default:"0" }}</td>
                                
                                <td style="width: 90px; text-align: center; color: {{ onrolldepartment_variance_dictss|get:department.DepartmentName|get:'variance_head_count'|variance_color }};">
                                    {{ onrolldepartment_variance_dictss|get:department.DepartmentName|get:'variance_head_count'|formatingdata|default:"0" }}
                                </td>
                               
                                <td style=" width: 120px; text-align: right;">{{ totaldepartmentservices_dict|get:department.DepartmentName|get:"TotalServicessalary_headcount_contract"|formatingdata|default:"0" }}</td>
                                <td style="width: 120px; text-align: right;">{{ departmentservices_dict|get:department.DepartmentName|get:"TotalServicessalary_headcount_contract"|formatingdata|default:"0" }}</td>
                                
                                <td style="width: 120px; text-align: right; color: {{ onrolldepartment_variance_dictss|get:department.DepartmentName|get:'variance_salary_headcount_contract'|variance_color }};">
                                    {{ onrolldepartment_variance_dictss|get:department.DepartmentName|get:'variance_salary_headcount_contract'|formatingdata|default:"0" }}
                                </td>
                            </tr> 
                            {% endfor %}
                           <tr data-division="{{ division.DivisionName }}" style="background-color:  #84aba7; color: #fff;">
                                <td colspan="3" style="text-transform: uppercase; text-align: center;">{{ division.DivisionName }} TOTAL</td>
                               
                                <td style=" text-align: right;">{{ totaldivisionservices_dict|get:division.DivisionName|get:"Servicedivisionmultiplication_result"|formatingdata|default:"0.00" }}</td>
                                <td style=" text-align: right;">{{ divisionservices_dict|get:division.DivisionName|get:"Servicedivisionmultiplication_result"|formatingdata|default:"0" }}</td>
                                
                                <td style="text-align: right; color: {{ onrolldivision_variance_dictss|get:division.DivisionName|get:'variance_multiplication_result'|variance_color }};">
                                    {{ onrolldivision_variance_dictss|get:division.DivisionName|get:'variance_multiplication_result'|formatingdata|default:"0.00" }}
                                </td>
                                
                                <td style=" text-align: center;">{{ totaldivisionservices_dict|get:division.DivisionName|get:"Servicedivisiontotal_headcount"|formatingdata|default:"0" }}</td>
                                <td style=" text-align: center;">{{ divisionservices_dict|get:division.DivisionName|get:"Servicedivisiontotal_headcount"|formatingdata|default:"0" }}</td>
                                
                                <td style="text-align: center; color: {{ onrolldivision_variance_dictss|get:division.DivisionName|get:'variance_head_count'|variance_color }};">
                                    {{ onrolldivision_variance_dictss|get:division.DivisionName|get:'variance_head_count'|formatingdata|default:"0.00" }}
                                </td>
                                
                                <td style=" text-align: right;">{{ totaldivisionservices_dict|get:division.DivisionName|get:"Servicedivisionsalary_headcount_product"|formatingdata|default:"0" }}</td>
                                <td style=" text-align: right;">{{ divisionservices_dict|get:division.DivisionName|get:"Servicedivisionsalary_headcount_product"|formatingdata|default:"0.00" }}</td>
                                
                                <td style="text-align: right; color: {{ onrolldivision_variance_dictss|get:division.DivisionName|get:'variance_salary_headcount_product'|variance_color }};">
                                    {{ onrolldivision_variance_dictss|get:division.DivisionName|get:'variance_salary_headcount_product'|formatingdata|default:"0.00" }}
                                </td>
                            </tr>  
                        {% endfor %}
                    {% else %}
                      
                    {% endif %}
                    <tr>
                        <td colspan="12"  ><strong>&nbsp;</strong></td>
                    </tr>
                    <tr style="background-color:  #95917e; color: #fff;">
                        <td colspan="3" style="text-transform: uppercase; width: 285px;"><strong>TOTAL - SHARED SERVICES<strong></td>
                            
                            <td style="width: 120px; text-align: right;">
                                {{ budgetservicegrandtotalondataemp|formatingdata|default:"0" }}
                            </td>
        
                            <td style="width: 120px; text-align: right;">
                                {{ enteryservicedetasgrand|formatingdata|default:"0" }}
                            </td>
        
                            <td style="width: 120px; text-align: right; color: {{ servicedatavariance_detaavg_salary|variance_color }};">
                                {{ servicedatavariance_detaavg_salary|formatingdata|default:"0" }}
                            </td>
                            
        
                           
                            <td style="text-align: center;">
                                {{ budgetcontractgrandtotalondataemp_headcount|formatingdata|default:"0" }}
                            </td>
                            <td style="text-align: center;">
                                {{ enteryservicedetasheadgrandtotalon|formatingdata|default:"0" }}
                            </td>
        
                            <td style="text-align: center; color: {{ servicedatavariance_detaheadcount|variance_color }};">
                                {{ servicedatavariance_detaheadcount|formatingdata|default:"0" }}
                            </td>
        
                            <td style="width: 120px; text-align: right;">
                                {{ budgetcontractdatagrandsalarydivion|formatingdata|default:"0" }}
                            </td>
        
                            <td style="width: 120px; text-align: right;">
                                {{ budgetservicedatagrandsalarydivion|formatingdata|default:"0" }}
                            </td>
        
                            <td style="width: 120px; text-align: right; color: {{ servicedatavariance_detatotal_ctc|variance_color }};">
                                {{ servicedatavariance_detatotal_ctc|formatingdata|default:"0" }}
                            </td>
                    </tr>

                  
                </tbody>
            </table>
            <br>
            {% comment %} <table>
                <thead>
                    <tr>
                        <td colspan="13"  ><strong>&nbsp;</strong></td>
                    </tr>
                    <tr>
                        <th class="TableThColor">DIV</th>
                        <th class="TableThColor">DEPT</th>
                        <th class="TableThColor">POSITION</th>
                        <th style="background-color: #34444c; color: #fff; font-size: 13px; width: 170px;">BUDGETED AVG SALARY</th>
                        <th class="TableThColor">ACTUAL AVG SALARY</th>
                        <th class="TableThColor">VARIANCE AVG SALARY</th>
                        <th class="TableThColor">BUDGETED HEAD COUNT</th>
                        <th class="TableThColor">ACTUAL HEAD COUNT</th>
                        <th class="TableThColor">VARIANCE HEAD COUNT</th>
                        <th class="TableThColor">BUDGETED TOTAL CTC</th>
                        <th style="background-color: #34444c;  color: #fff; font-size: 13px;">ACTUAL TOTAL CTC</th>
                        <th class="TableThColor">VARIANCE TOTAL CTC</th>
                    </tr>
                    <tr >
                        <td colspan="3" style="text-transform: uppercase; width: 285px;  "><strong>TOTAL ON ROLL<strong></td>
                            
                            <td style="width: 150px; text-align: center; "><b>{{ grand_total_salary|formatingdata  }}<b></td>
                            <td style="width: 70px; text-align: center;"><b>{{ grand_total_headcount }}<b></td>
                            <td style="width: 70px;  ">&nbsp;</td>
                            <td style="width: 70px; text-align: center; "><b>{{ grand_total_headcount }}<b></td>
                            <td style="width: 70px;">&nbsp;</td>
                            <td style="width: 70px; ">&nbsp;</td>
                            <td style="width: 70px; ">&nbsp;</td>
                            <td style="width: 70px; ">&nbsp;</td>
                            <td style="width: 150px; text-align: center; "><b>{{grandsalarydivion|formatingdata}}<b></td>
                            
                       
                    </tr>
                    <tr >
                        <td colspan="3" style="text-transform: uppercase; width: 285px;"><strong>TOTAL - CONTRACT<strong></td>
                            
                        <td><input type="text" id="grandsalarytotal" name="grandsalarytotal" style="width: 170px; text-align: center; border: none; background: transparent; " class="form-control input-small" readonly></td>
                        <td><input type="text" id="grandheadtotal" name="grandheadtotal" style="width: 80px; text-align: center; border: none; background: transparent;" class="form-control input-small" readonly></td>
                        <td><input type="text" id="grandmorningtotal" name="grandmorningtotal" style="width: 80px; text-align: center; border: none; background: transparent;" class="form-control input-small" readonly></td>
                        <td><input type="text" id="grandgeneraltotal" name="grandgeneraltotal" style="width: 80px; text-align: center; border: none; background: transparent;" class="form-control input-small" readonly></td>
                        <td><input type="text" id="grandafternoontotal" name="grandafternoontotal" style="width: 80px; text-align: center; border: none; background: transparent;" class="form-control input-small" readonly></td>
                        <td><input type="text" id="grandnighttotal" name="grandnighttotal" style="width: 80px; text-align: center; border: none; background: transparent;" class="form-control input-small" readonly></td>
                        <td><input type="text" id="grandmbreaktotal" name="grandmbreaktotal" style="width: 80px; text-align: center; border: none; background: transparent;" class="form-control input-small" readonly></td>
                        <td><input type="text" id="grandrelieverstotal" name="grandrelieverstotal" style="width: 80px; text-align: center; border: none; background: transparent;" class="form-control input-small" readonly></td>
                        <td><input type="text" id="grandtotalctc" name="grandtotalctc" style="width: 170px; text-align: center; border: none; background: transparent;" class="form-control input-small" readonly></td>
                    </tr>
                    <tr >
                        <td colspan="3" style="text-transform: uppercase; width: 285px;"><strong>TOTAL - SHARED SERVICES<strong></td>
                          
                                <td style="width: 150px; text-align: center; "><b>{{ grand_total_service_salary|formatingdata  }}<b></td>
                                <td style="width: 70px; text-align: center; "><b>{{ grand_total_service_headcount }}<b></td>
                                <td style="width: 70px;  ">&nbsp;</td>
                                <td style="width: 70px; text-align: center; "><b>{{ grand_total_service_headcount }}<b></td>
                                <td style="width: 70px;">&nbsp;</td>
                                <td style="width: 70px; ">&nbsp;</td>
                                <td style="width: 70px; ">&nbsp;</td>
                                <td style="width: 70px; ">&nbsp;</td>
                                <td style="width: 150px; text-align: center; "><b>{{grand_service_salary_headcount_product|formatingdata}}<b></td>
                    </tr>
                    <tr >
                        <td colspan="3" style="text-transform: uppercase; width: 285px;"><strong>TOTAL - CAFETERIA MEAL COST<strong></td>
                           
                        <td><input type="text" id="grandsalarytotal" name="grandsalarytotal" style="width: 170px; text-align: center; border: none; background: transparent; " class="form-control input-small" readonly></td>
                        <td><input type="text" id="grandheadtotal" name="grandheadtotal" style="width: 80px; text-align: center; border: none; background: transparent;" class="form-control input-small" readonly></td>
                        <td><input type="text" id="grandmorningtotal" name="grandmorningtotal" style="width: 80px; text-align: center; border: none; background: transparent;" class="form-control input-small" readonly></td>
                        <td><input type="text" id="grandgeneraltotal" name="grandgeneraltotal" style="width: 80px; text-align: center; border: none; background: transparent;" class="form-control input-small" readonly></td>
                        <td><input type="text" id="grandafternoontotal" name="grandafternoontotal" style="width: 80px; text-align: center; border: none; background: transparent;" class="form-control input-small" readonly></td>
                        <td><input type="text" id="grandnighttotal" name="grandnighttotal" style="width: 80px; text-align: center; border: none; background: transparent;" class="form-control input-small" readonly></td>
                        <td>{{ budgetmeal }}</td>
                        <td>{{ Entrymealcost }}</td>
                        <td><input type="text" id="grandtotalctc" name="grandtotalctc" style="width: 170px; text-align: center; border: none; background: transparent;" class="form-control input-small" readonly></td>
                    </tr>
                    <tr >
                        <td colspan="3" style="text-transform: uppercase; width: 285px;"><strong>TOTAL - EMPLOYEE INSURANCE COST<strong></td>
                          
                        <td><input type="text" id="grandsalarytotal" name="grandsalarytotal" style="width: 170px; text-align: center; border: none; background: transparent; " class="form-control input-small" readonly></td>
                        <td><input type="text" id="grandheadtotal" name="grandheadtotal" style="width: 80px; text-align: center; border: none; background: transparent;" class="form-control input-small" readonly></td>
                        <td><input type="text" id="grandmorningtotal" name="grandmorningtotal" style="width: 80px; text-align: center; border: none; background: transparent;" class="form-control input-small" readonly></td>
                        <td><input type="text" id="grandgeneraltotal" name="grandgeneraltotal" style="width: 80px; text-align: center; border: none; background: transparent;" class="form-control input-small" readonly></td>
                        <td><input type="text" id="grandafternoontotal" name="grandafternoontotal" style="width: 80px; text-align: center; border: none; background: transparent;" class="form-control input-small" readonly></td>
                        <td><input type="text" id="grandnighttotal" name="grandnighttotal" style="width: 80px; text-align: center; border: none; background: transparent;" class="form-control input-small" readonly></td>
                        <td>{{ Insurance_cost }}</td>
                        <td>{{ EntryInsurance_cost }}</td>
                        <td><input type="text" id="grandtotalctc" name="grandtotalctc" style="width: 170px; text-align: center; border: none; background: transparent;" class="form-control input-small" readonly></td>
                    </tr>
                    <tr >
                        <td colspan="3" style="text-transform: uppercase; width: 285px;"><strong>TOTAL WAGES & BENEFITS<strong></td>
                           
                        <td><input type="text" id="grandsalarytotal" name="grandsalarytotal" style="width: 170px; text-align: center; border: none; background: transparent; " class="form-control input-small" readonly></td>
                        <td><input type="text" id="grandheadtotal" name="grandheadtotal" style="width: 80px; text-align: center; border: none; background: transparent;" class="form-control input-small" readonly></td>
                        <td><input type="text" id="grandmorningtotal" name="grandmorningtotal" style="width: 80px; text-align: center; border: none; background: transparent;" class="form-control input-small" readonly></td>
                        <td><input type="text" id="grandgeneraltotal" name="grandgeneraltotal" style="width: 80px; text-align: center; border: none; background: transparent;" class="form-control input-small" readonly></td>
                        <td><input type="text" id="grandafternoontotal" name="grandafternoontotal" style="width: 80px; text-align: center; border: none; background: transparent;" class="form-control input-small" readonly></td>
                        <td><input type="text" id="grandnighttotal" name="grandnighttotal" style="width: 80px; text-align: center; border: none; background: transparent;" class="form-control input-small" readonly></td>
                        <td><input type="text" id="grandmbreaktotal" name="grandmbreaktotal" style="width: 80px; text-align: center; border: none; background: transparent;" class="form-control input-small" readonly></td>
                        <td><input type="text" id="grandrelieverstotal" name="grandrelieverstotal" style="width: 80px; text-align: center; border: none; background: transparent;" class="form-control input-small" readonly></td>
                        <td><input type="text" id="grandtotalctc" name="grandtotalctc" style="width: 170px; text-align: center; border: none; background: transparent;" class="form-control input-small" readonly></td>
                    </tr>
                </thead>
            </table>  {% endcomment %}
            <table class="table table-striped" id="myTable5" >
                <thead>
                    <tr>
                        <td colspan="12" style="background-color: #f3f3f3;" ><strong>&nbsp;</strong></td>
                    </tr>
                    <tr>
                        <th class="TableThColor">DIV</th>
                        <th class="TableThColor">DEPT</th>
                        <th class="TableThColor">POSITION</th>
                        <th class="TableThColor">BUDGETED AVG SALARY</th>
                        <th class="TableThColor">ACTUAL AVG SALARY</th>
                        <th class="TableThColor">VARIANCE AVG SALARY</th>
                        <th class="TableThColor">BUDGETED HEAD COUNT</th>
                        <th class="TableThColor">ACTUAL HEAD COUNT</th>
                        <th class="TableThColor">VARIANCE HEAD COUNT</th>
                        <th class="TableThColor">BUDGETED TOTAL CTC</th>
                        <th style="background-color: #34444c;  color: #fff; font-size: 13px;">ACTUAL TOTAL CTC</th>
                        <th class="TableThColor">VARIANCE TOTAL CTC</th>
                    </tr>
                    
                    <tr >
                        <td colspan="3" style="text-transform: uppercase; width: 310px;  "><strong>TOTAL ON ROLL<strong></td>
                            
                            <td style="width: 120px; text-align: right;">
                                {{ grandtotalondatabudget|formatingdata|default:"0" }}
                            </td>
        
                            <td style="width: 120px; text-align: right;">
                                {{ grandtotalondataemp|formatingdata }}
                            </td>
        
                            <td style="width: 120px; text-align: right; color: {{ variance_detaavg_salary|variance_color }};">
                                {{ variance_detaavg_salary|formatingdata }}
                            </td>
        
                           
                            <td style="text-align: center;">
                                {{ headgrandtotalondatabudget|default:"0" }}
                            </td>
                            <td style="text-align: center;">
                                {{ grandtotalondataemp_headcount|default:"0" }}
                            </td>
        
                            <td style="text-align: center; color: {{ variance_detaheadcount|variance_color }};">
                                {{ variance_detaheadcount }}
                            </td>
        
                            <td style="width: 120px; text-align: right;">
                                {{ orrollServicesgrandsalarydivion|formatingdata }}
                            </td>
        
                            <td style="width: 120px; text-align: right;">
                                {{ Servicesgrandsalarydivion|formatingdata }}
                            </td>
        
                            <td style="width: 120px; text-align: right; color: {{ variance_detatotal_ctc|variance_color }};">
                                {{ variance_detatotal_ctc|formatingdata }}
                            </td>
                            
                       
                    </tr>
                    
                    <tr >
                        <td colspan="3" style="text-transform: uppercase; width: 310px;"><strong>TOTAL - CONTRACT<strong></td>
                           
                            <td style="width: 120px; text-align: right;">
                                {{ budgetcontractgrandtotalondataemp|formatingdata|default:"0" }}
                            </td>
        
                            <td style="width: 120px; text-align: right;">
                                {{ enterycontractdetasgrand|formatingdata|default:"0" }}
                            </td>
        
                            <td style="width: 120px; text-align: right; color: {{ datavariance_detaavg_salary|variance_color }};">
                                {{ datavariance_detaavg_salary|formatingdata|default:"0" }}
                            </td>
                            
        
                           
                            <td style="text-align: center;">
                                {{ budgetcontractgrandtotalondataemp_headcount|formatingdata|default:"0" }}
                            </td>
                            <td style="text-align: center;">
                                {{ enterycontractdetasheadgrandtotalon|formatingdata|default:"0" }}
                            </td>
        
                            <td style="text-align: center; color: {{ datavariance_detaheadcount|variance_color }};">
                                {{ datavariance_detaheadcount|formatingdata|default:"0" }}
                            </td>
        
                            <td style="width: 120px; text-align: right;">
                                {{ budgetcontractdatagrandsalarydivion|formatingdata|default:"0" }}
                            </td>
        
                            <td style="width: 120px; text-align: right;">
                                {{ enterycontractempgrandsalarydivion|formatingdata|default:"0" }}
                            </td>
        
                            <td style="width: 120px; text-align: right; color: {{ datavariance_detatotal_ctc|variance_color }};">
                                {{ datavariance_detatotal_ctc|formatingdata|default:"0" }}
                            </td>
                    </tr>
                    <tr>
                       
                            <td colspan="3" style="text-transform: uppercase; width: 310px;"><strong>TOTAL - SHARED SERVICES<strong></td>
                              
                                    
                                <td style="width: 120px; text-align: right;">
                                    {{ budgetservicegrandtotalondataemp|formatingdata|default:"0" }}
                                </td>
            
                                <td style="width: 120px; text-align: right;">
                                    {{ enteryservicedetasgrand|formatingdata|default:"0" }}
                                </td>
            
                                <td style="width: 120px; text-align: right; color: {{ servicedatavariance_detaavg_salary|variance_color }};">
                                    {{ servicedatavariance_detaavg_salary|formatingdata|default:"0" }}
                                </td>
                                
            
                               
                                <td style="text-align: center;">
                                    {{ budgetcontractgrandtotalondataemp_headcount|formatingdata|default:"0" }}
                                </td>
                                <td style="text-align: center;">
                                    {{ enteryservicedetasheadgrandtotalon|formatingdata|default:"0" }}
                                </td>
            
                                <td style="text-align: center; color: {{ servicedatavariance_detaheadcount|variance_color }};">
                                    {{ servicedatavariance_detaheadcount|formatingdata|default:"0" }}
                                </td>
            
                                <td style="width: 120px; text-align: right;">
                                    {{ budgetcontractdatagrandsalarydivion|formatingdata|default:"0" }}
                                </td>
            
                                <td style="width: 120px; text-align: right;">
                                    {{ budgetservicedatagrandsalarydivion|formatingdata|default:"0" }}
                                </td>
            
                                <td style="width: 120px; text-align: right; color: {{ servicedatavariance_detatotal_ctc|variance_color }};">
                                    {{ servicedatavariance_detatotal_ctc|formatingdata|default:"0" }}
                                </td>
                        
                    </tr>
                    <tr >
                        <td colspan="3" style="text-transform: uppercase; width: 310px;"><strong>TOTAL - CAFETERIA MEAL COST<strong></td>
                          
                            <td style="width: 110px;text-align: right; "><b>&nbsp;<b></td>
                                <td style="width: 110px; text-align: right;  ">&nbsp;</td>
                                <td style="width: 110px; text-align: right; "><b><b></td>
                                <td style="width: 110px; text-align: center; ">&nbsp;</td>
                                <td style="width: 110px; text-align: center; ">&nbsp;</td>
                                <td style="width: 110px;  text-align: center;">&nbsp;</td>
                               
                        <td style="width: 110px; text-align: right; ">{{budgetmeal|formatingdata}}</td>
                        <td style="width: 110px; text-align: right; ">{{Entrymealcost|formatingdata}}</td>
                        <td style="width: 110px; text-align: right; color: {{ varicanmealcoast|variance_color }};">
                            {{ varicanmealcoast|formatingdata }}
                        </td>
                    </tr>
                    <tr >
                        <td colspan="3" style="text-transform: uppercase; width: 310px;"><strong>TOTAL - EMPLOYEE INSURANCE COST<strong></td>
                           
                            <td style="width: 110px; text-align: right; "><b>&nbsp;<b></td>
                                <td style="width: 110px; text-align: right; ">&nbsp;</td>
                                <td style="width: 110px; text-align: right; "><b>&nbsp;<b></td>
                                <td style="width: 110px; ">&nbsp;</td>
                                <td style="width: 110px; ">&nbsp;</td>
                                <td style="width: 110px; ">&nbsp;</td>
                        <td style="width: 110px; text-align: right; ">{{Insurance_cost|formatingdata}}</td>
                            <td style="width: 110px; text-align: right; ">{{EntryInsurance_cost|formatingdata}}</td>
                            <td style="width: 110px; text-align: right; color: {{ varinceinsurancecoast|variance_color }};">
                                {{ varinceinsurancecoast|formatingdata }}
                            </td>
                    </tr>
                    <tr>
                        <td colspan="13"  style="background-color: #f3f3f3;"><strong>&nbsp;</strong></td>
                    </tr>
                  
                </thead>
            </table>
          
           
           
        </div>
    </div>

    <!-- Modal -->
<div class="modal fade bd-example-modal-sm" tabindex="-1" aria-labelledby="mySmallModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Select Report Sections</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- checkboxes here -->
                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="onRollCheckbox">
                    <label class="form-check-label" for="onRollCheckbox">
                        On Roll
                    </label>
                    <br>
                    <input class="form-check-input" type="checkbox" id="contractCheckbox">
                    <label class="form-check-label" for="contractCheckbox">
                        Contract
                    </label>
                    <br>
                    <input class="form-check-input" type="checkbox" id="sharedServicesCheckbox">
                    <label class="form-check-label" for="sharedServicesCheckbox">
                        Shared Services
                    </label>
                    <br>
                    <input class="form-check-input" type="checkbox" id="cafeteriaCheckbox">
                    <label class="form-check-label" for="cafeteriaCheckbox">
                        Cafeteria Meal Cost
                    </label>
                    <br>
                    <input class="form-check-input" type="checkbox" id="insuranceCheckbox">
                    <label class="form-check-label" for="insuranceCheckbox">
                        Employees Insurance Cost
                    </label>
                </div>
                <!-- Error message -->
                <div id="error-message" style="color: red; display: none; margin-top: 10px;">
                    Please tick at least one checkbox.
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <a href="#" id="exportLink" class="btn btn-primary">Export</a>
            </div>
        </div>
    </div>
</div>

{% comment %} <script>
    document.addEventListener("DOMContentLoaded", function () {
      const form = document.querySelector("#yourModalID form"); // Replace with actual modal ID or form selector
      if (form) {
        form.addEventListener("submit", function (e) {
          e.preventDefault();
          // Handle form via AJAX or other methods here
          console.log("Form submission prevented.");
        });
      }
    });
  </script>
   {% endcomment %}

<!-- Button -->
{% comment %} <button class="btn btn-primary btn-sm" style="margin-right: 10px; padding: 10px;" data-bs-toggle="modal" data-bs-target=".bd-example-modal-sm">
    Export
</button> {% endcomment %}


    <div class="modal fade bd-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Select Report Sections</h5>
                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="onRollCheckbox">
                        <label class="form-check-label" for="onRollCheckbox">
                            On Roll
                        </label>
                        <br>
                        <input class="form-check-input" type="checkbox" id="contractCheckbox">
                        <label class="form-check-label" for="contractCheckbox">
                            Contract
                        </label>
                        <br>
                        <input class="form-check-input" type="checkbox" id="sharedServicesCheckbox">
                        <label class="form-check-label" for="sharedServicesCheckbox">
                            Shared Services
                        </label>
                        <br>
                        <input class="form-check-input" type="checkbox" id="cafeteriaCheckbox">
                        <label class="form-check-label" for="cafeteriaCheckbox">
                            Cafeteria Meal Cost
                        </label>
                        <br>
                        <input class="form-check-input" type="checkbox" id="insuranceCheckbox">
                        <label class="form-check-label" for="insuranceCheckbox">
                            Employees Insurance Cost
                        </label>
                    </div>
                    <!-- Error message -->
                    <div id="error-message" style="color: red; display: none; margin-top: 10px;">
                        Please tick at least one checkbox.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <a href="#" id="exportLink" class="btn btn-primary">Export</a>
                </div>
            </div>
        </div>
    </div> 
{% comment %} </div> {% endcomment %}
    
    <script>
        
        const checkboxes = document.querySelectorAll('.form-check-input');
        const exportLink = document.getElementById('exportLink');
        const errorMessage = document.getElementById('error-message');
    
       
        function validateCheckboxes() {
            return Array.from(checkboxes).some(checkbox => checkbox.checked);
        }
    
        
        exportLink.addEventListener('click', function (e) {
            if (!validateCheckboxes()) {
                e.preventDefault(); 
                errorMessage.style.display = 'block'; // Show error message
            }
        });
    
        
        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', function () {
                if (validateCheckboxes()) {
                    errorMessage.style.display = 'none'; // Hide error message
                }
            });
        });
    </script>
    
    

{% comment %} <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script> {% endcomment %}
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.2/xlsx.full.min.js"></script>


<script>
    document.getElementById('exportBtn').addEventListener('click', function() {
        try {
            var wb = XLSX.utils.book_new(); 

            function applyStyles(ws, styles, numCols) {
                for (let col = 0; col < numCols; col++) {
                    const cellRef = XLSX.utils.encode_cell({ c: col, r: 0 });
                    if (!ws[cellRef]) ws[cellRef] = {};
                    ws[cellRef].s = styles.header;
                }

                let rowIndex = 1;
                $('#myTable tr, #myTable2 tr, #myTable3 tr, #myTable4 tr, #myTable5 tr').each(function() {
                    const divisionRow = $(this).find('strong').first();
                    if (divisionRow.length) {
                        for (let col = 0; col < numCols; col++) {
                            const cellRefRow = XLSX.utils.encode_cell({ c: col, r: rowIndex });
                            if (!ws[cellRefRow]) ws[cellRefRow] = {};
                            ws[cellRefRow].s = styles.division;
                        }
                    } else if ($(this).find('td').first().text().includes('Total')) {
                        for (let col = 0; col < numCols; col++) {
                            const cellRefRow = XLSX.utils.encode_cell({ c: col, r: rowIndex });
                            if (!ws[cellRefRow]) ws[cellRefRow] = {};
                            ws[cellRefRow].s = styles.totalRow;
                        }
                    }
                    rowIndex++;
                });
            }

            
            var ws1 = XLSX.utils.table_to_sheet(document.getElementById('myTable'));
            ws1['!cols'] = Array(12).fill({ wpx: 110 });
            applyStyles(ws1, {
                header: { fill: { fgColor: { rgb: "0AA485" } }, font: { bold: true, color: { rgb: "FFFFFF" } } },
                division: { fill: { fgColor: { rgb: "4B6650" } }, font: { bold: true, color: { rgb: "FFFFFF" } } },
                totalRow: { fill: { fgColor: { rgb: "95917E" } }, font: { bold: true, color: { rgb: "FFFFFF" } } }
            }, 13);
            XLSX.utils.book_append_sheet(wb, ws1, "ON ROLL MANNING");

            var ws2 = XLSX.utils.table_to_sheet(document.getElementById('myTable2'));
            ws1['!cols'] = Array(12).fill({ wpx: 110 });
            applyStyles(ws1, {
                header: { fill: { fgColor: { rgb: "0AA485" } }, font: { bold: true, color: { rgb: "FFFFFF" } } },
                division: { fill: { fgColor: { rgb: "4B6650" } }, font: { bold: true, color: { rgb: "FFFFFF" } } },
                totalRow: { fill: { fgColor: { rgb: "95917E" } }, font: { bold: true, color: { rgb: "FFFFFF" } } }
            }, 13);
            XLSX.utils.book_append_sheet(wb, ws2, "DEPARTMENT TOTAL");

            var ws3 = XLSX.utils.table_to_sheet(document.getElementById('myTable3'));
            ws1['!cols'] = Array(12).fill({ wpx: 110 });
            applyStyles(ws1, {
                header: { fill: { fgColor: { rgb: "0AA485" } }, font: { bold: true, color: { rgb: "FFFFFF" } } },
                division: { fill: { fgColor: { rgb: "4B6650" } }, font: { bold: true, color: { rgb: "FFFFFF" } } },
                totalRow: { fill: { fgColor: { rgb: "95917E" } }, font: { bold: true, color: { rgb: "FFFFFF" } } }
            }, 13);
            XLSX.utils.book_append_sheet(wb, ws3, "CONTRACT MANNING");

            var ws4 = XLSX.utils.table_to_sheet(document.getElementById('myTable4'));
            ws1['!cols'] = Array(12).fill({ wpx: 110 });
            applyStyles(ws1, {
                header: { fill: { fgColor: { rgb: "0AA485" } }, font: { bold: true, color: { rgb: "FFFFFF" } } },
                division: { fill: { fgColor: { rgb: "4B6650" } }, font: { bold: true, color: { rgb: "FFFFFF" } } },
                totalRow: { fill: { fgColor: { rgb: "95917E" } }, font: { bold: true, color: { rgb: "FFFFFF" } } }
            }, 13);
            XLSX.utils.book_append_sheet(wb, ws4, "SHARED SERVICES MANNING");

            var ws5 = XLSX.utils.table_to_sheet(document.getElementById('myTable5'));
            ws1['!cols'] = Array(12).fill({ wpx: 110 });
            applyStyles(ws1, {
                header: { fill: { fgColor: { rgb: "0AA485" } }, font: { bold: true, color: { rgb: "FFFFFF" } } },
                division: { fill: { fgColor: { rgb: "4B6650" } }, font: { bold: true, color: { rgb: "FFFFFF" } } },
                totalRow: { fill: { fgColor: { rgb: "95917E" } }, font: { bold: true, color: { rgb: "FFFFFF" } } }
            }, 13);
            XLSX.utils.book_append_sheet(wb, ws5, "TOTAL");


            
            XLSX.writeFile(wb, 'VarianceReport.xlsx');
            console.log('Exported successfully!');
        } catch (error) {
            console.error('Error exporting file:', error);
        }
    });
</script>






<script>
    $(document).ready(function () {
        var selectedOrganization = "{{ selectedOrganizationID }}";
        $("select[name='hotel_name']").val(selectedOrganization);
       
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const exportLink = document.getElementById('exportLink');
        const selectedOrganizationID = "{{ selectedOrganizationID }}";  
        const selectedDivision = "{{ selected_division }}";  
        const selectedDepartment = "{{ selected_department }}";  

        function updateExportLink() {
            const onRoll = document.getElementById('onRollCheckbox').checked;
            const contract = document.getElementById('contractCheckbox').checked;
            const sharedServices = document.getElementById('sharedServicesCheckbox').checked;
            const cafeteria = document.getElementById('cafeteriaCheckbox').checked;
            const insurance = document.getElementById('insuranceCheckbox').checked;

            let url = "{% url 'variancepdf' %}?";
            const params = [];

            if (onRoll) params.push('include_on_roll=true');
            else params.push('include_on_roll=false');

            if (contract) params.push('include_contract=true');
            else params.push('include_contract=false');

            if (sharedServices) params.push('include_shared_services=true');
            else params.push('include_shared_services=false');

            if (cafeteria) params.push('include_cafeteria=true');
            else params.push('include_cafeteria=false');

            if (insurance) params.push('include_insurance=true');
            else params.push('include_insurance=false');

            
            params.push(`hotel_name=${encodeURIComponent(selectedOrganizationID)}`);
            params.push(`divisionname=${encodeURIComponent(selectedDivision)}`);
            params.push(`departmentname=${encodeURIComponent(selectedDepartment)}`);

            exportLink.href = url + params.join('&');
        }

        
        document.querySelectorAll('.form-check-input').forEach(checkbox => {
            checkbox.addEventListener('change', updateExportLink);
        });

       




        updateExportLink();
    });
</script>



</html>
{% endblock content %}

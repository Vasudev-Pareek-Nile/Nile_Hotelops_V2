{% extends "OpenPositions/homebase.html" %} 
{% load openpostionfilter %}
{% block content %}


{% if messages %}
  {% for message in messages %}
  <div class="alert {% if message.tags %} alert-{{ message.tags }}{% endif %} mx-auto" role="alert" style="color: #5143d9; max-width: 1000px;">
    {{ message }}
  </div>
  <script>
    setTimeout(function() {
      document.querySelector('.alert').remove();
    }, 3000);
  </script>
  {% endfor %}
{% endif %}


<style>
  .TableFirstSr{
    max-width: 10px !important;
    text-align:center !important;
  }
  .HTL{
    max-width: 50px !important;
    /* text-align:center; */
  }
  .OpenedOn{
    max-width: 90px !important;
    /* text-align:center; */
  }
  .OpenedBy{
    max-width: 100px !important;
    /* text-align:center; */
  }
  .Since{
    max-width: 50px !important;
    /* text-align:center; */
  }
  .Lvl{
    max-width: 30px !important;
    text-align:center;
  }
  .ProposedDOJ{
    max-width: 100px !important;
    /* text-align:center; */
  }
  .Common{
    white-space: normal !important;
    word-break: break-word !important;
  }

  span.select2-selection.select2-selection--multiple {
      border: 1px solid #dedede !important;
      padding: 9px;
  }

  .select2-container--default .select2-selection--multiple .select2-selection__choice {
      margin-top: 1px !important;
  }

  .select2-container, .dropdown-menu {
      z-index: 1000 !important; /* Less than navbar */
  }


  .btn-primary {
      background: #3a4a93;
      border-color: #3a4a93;
      transition: all 0.5s ease;
      
  }

  .btn,.card,table,select{
    border-radius: 4px !important;
  }



  .select2-selection {
      border-radius: 4px !important;
  }

  li#example_previous {
      border-radius: 4px !important;
  }

  a.page-link {
      border-radius: 4px !important;
  }


  li.select2-selection__choice {
      border-radius: 4px !important;
  }

  /* .TableFirstSr:first-child, .Action:first-child{
    border-top-left-radius: 4px;
  } */
  #ActionId{
    border-top-right-radius: 4px;
  }
  #TableFirstSrId{
    border-top-left-radius: 4px;
  }

  .card-header {
    margin-bottom: -17px;
  }
  .card .card-body {
      padding-top: 0px !important;
  }

  #example_previous a{
      display: flex !important;
      align-items: center !important;
      height: 38px !important;
      width: 34.5px !important;
      justify-content: center !important;
  }

  #example_next a{
      display: flex !important;
      align-items: center !important;
      height: 38px !important;
      width: 34.5px !important;
      justify-content: center !important;
  }
  /* border: 1px solid #D3D3D4; */

  #example{
    border-left: 1px solid #D3D3D4 !important;  
    border-right: 1px solid #D3D3D4 !important;
    border-bottom: 1px solid #D3D3D4 !important;
  }
</style>


<body>

<div class="card">
  <div class="card-header">
      <div class="d-flex justify-content-between align-items-center">
          <h4 class="mb-0 text-uppercase">Open Position</h4>
          {% comment %} <a href="{% url 'OpenPositionAdd' %}" class="btn btn-primary"> Add New </a> {% endcomment %}
          <a href="{% url 'OpenPositionAdd' %}" class="btn btn-primary"> Add New </a>
      </div>
     
  </div>
  <div class="card-body">
     <form method="GET" class="g-2 mt-4" action="{% url 'OpenPositionList' %}">
        <div class="row mt-2">
                <div class="col-md-6">
                  <select name="OrganizationID" class="form-control select2">
                      {% for itm in memOrg %}
                        <option value="{{ itm.OrganizationID }}" {% if itm.OrganizationID == OrganizationID %}selected{% endif %}>
                          {{ itm.OrganizationName }}
                        </option>
                      {% endfor %}
                      <script>
                          $(document).ready(function () {
                              var selectedOrganization = "{{ OrganizationID }}";
                              $("select[name='OrganizationID']").val(selectedOrganization);
                              
                          });
                      </script>
                    </select>
              </div>
              <div class="col-md-3">
                <select id="department-select" name="OpenDepartment" class="form-control">
                    <option value="">All Department</option>
                    {% for Department in Departments %}
                      <option value="{{ Department.DepartmentName }}" {% if Department.DepartmentName == selected_department %}selected{% endif %}>
                        {{ Department.DepartmentName }}
                      </option>
                    {% endfor %}
                  </select>
            </div>
            <div class="col-md-3">
              <select id="status-select" name="Status" class="form-control select">
                  <option value="open" {% if selected_status == 'open' %}selected{% endif %}>Open</option>
                  <option value="close" {% if selected_status == 'close' %}selected{% endif %}>Close</option>
                </select>
          </div>
        </div>
        
        <div class="row mt-2" >
              <div class="col-md-6">
                <select id="designation-select" name="Position" class="form-control select2">
                    <option value="">All Designation</option>
                    {% for Designationdata in Designations %}
                      <option value="{{ Designationdata.designations }}" {% if Designationdata.designations == selected_positon %}selected{% endif %}>
                        {{ Designationdata.designations }}
                      </option>
                    {% endfor %}
                  </select>
              </div>

              <div class="col-md-3">
                <select class="form-control select" multiple="multiple" id="level_select" name="Level" data-placeholder="Levels">
                  {% for Lavelsdata in Lavelsdatas %}
                    <option value="{{ Lavelsdata.lavelname }}" {% if Lavelsdata.lavelname in selected_levels %}selected{% endif %}>
                      {{ Lavelsdata.lavelname }}
                    </option>
                  {% endfor %}
                </select>
              </div>

              <div class="col-md-3 text-end" >
                <button type="submit" class="btn mr-4 btn-primary"  id="toggleSpinners">
                    Filter 
                </button>

                <a href="{% url 'OpenPositionList' %}" class="btn btn-danger">
                    Clear
                </a>

                <a href="{% url 'ExportOpenPosition' %}?Locations={{ OrganizationID }}" class="btn btn-danger" id="exportButton">
                    Export
                </a>
            </div>
        </div>
     </form>  

  <table id="example" class="table table-striped table-bordered datatable dataTable no-footer">
        <thead class="thead">
          <tr class="">
            <th class="TableFirstSr Common" id="TableFirstSrId">SR</th>
            <th class="HTL Common">HTL</th>
            <th class="Position">Position</th>
            <th class="TableFirstSr Common text-center">#</th>
            <th class="Salary">Salary</th>
            <th class="OpenedOn Common">Opened</th>
            <th class="OpenedBy Common">Opened By</th>
            <th class="Since Common">Since</th>
            <th class="Lvl Common text-center">Lvl</th>
            <th class="ProposedDOJ">Prop. DOJ</th>
            <th class="Action" id="ActionId"></th>
          </tr>
        </thead>
        <tbody>
          {% for position in positions %}
            {% if not position.Status %}
              <tr style="background-color: #ffcccc;" >
            {% elif position.days_ago.is_red %}
              <tr style="background-color: #ffcccc; color: #ff0000">
            {% elif position.days_ago.1 == 'red' %}
              <tr style="background-color: #ffcccc; color: #ff0000">
            {% else %}
              <tr>
            {% endif %}
              <td class="TableFirstSr">{{ forloop.counter }}</td>
              <td class="HTL Common">{{ position.Locations|get_organization_name_by_location }}</td>
              <td style="width: 200px;">{{ position.Position }}</td>
              <td class="text-center" >{{ position.Number }}</td>
              <td style="width: 120px;">{{ position.Salary }}</td>
              <td class="OpenedOn Common" style="width: 170px;">{{ position.Opened_On|date:"d M. Y" }}</td>
              <td style="width: 100px;">{{ position.CreatedByUsername|first_and_middle }}</td>
              <td class="Since Common">
                    {{ position.days_ago.text }}
              </td>
              <td class="Lvl Common">{{ position.OpenLevel|default:"" }}</td>
              {% comment %} <td>
                {% for data in combined_data %}
                    {% if data.Position == position.Position and data.Location == position.Locations %}
                        <div>
                            <strong>{{ data.CandidateName|default:"&nbsp;" }}</strong><br>
                            <span>{{ data.ProposedDOJ|date:"d M. Y"|default:"&nbsp;" }}</span>
                        </div>
                    {% endif %}
                {% endfor %}
            </td>  {% endcomment %}
            <td>
              {{ position.get_ProposedDOJ_Name }}
              <!-- 05 NOV 2024 / Shiva Kumar -->
            </td> 
            {% comment %} <td>
                {{position.get_ProposedDOJ_Name}}
            </td>  {% endcomment %}
              
            <td class="text-center">
              <div class="dropdown">
                <button class="btn btn-light btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                  <i class="fa fa-ellipsis-v"></i> <!-- Three dots vertical -->
                </button>
                <ul class="dropdown-menu dropdown-menu-end" style="min-width: 200px; font-size: 13px;">
                  {% if request.session.UserID == '20201212178780' %}
                    <li>
                      <a class="dropdown-item text-danger" onclick="return confirm('Are you sure you want to delete?')" 
                        href="{% url 'OpenPositionDelete' %}?ID={{ position.id }}">
                        <i class="fa fa-archive me-2"></i> Delete
                      </a>
                    </li>
                  {% endif %}
                  <li>
                    <a class="dropdown-item" 
                      href="{% url 'ResumeShorting' %}?location={{ position.Locations|get_organization_name_by_locationfullnmee }}&department={{position.OpenDepartment}}&job_title={{position.Position }}">
                      <i class="fa fa-eye me-2"></i> View
                    </a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="{% url 'EditOpenPosition' position_id=position.id %}">
                      <i class="fa fa-edit me-2"></i> Edit
                    </a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="{% url 'toggle_position_status' position_id=position.id %}">
                      <i class="fa fa-power-off me-2"></i> {% if position.Status %}Deactivate{% else %}Activate{% endif %}
                    </a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="{% url 'Notification_Schedule' %}?ID={{ position.id }}">
                      <i class="fa fa-whatsapp me-2 text-success"></i> WhatsApp
                    </a>
                  </li>
                  <li><hr class="dropdown-divider"></li>
                  <li>
                    <a class="dropdown-item" href="https://www.facebook.com/sharer/sharer.php?https://careersatnile.com/jobshare.php/{{ position.slug_url }}?v={{ now|date:'Y-m-d' }}">
                      <i class="fa fa-facebook me-2"></i> Share on Facebook
                    </a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="https://www.linkedin.com/shareArticle?url=https://careersatnile.com/jobshare.php/{{ position.slug_url }}?v={{ now|date:'Y-m-d' }}&image=https://hotelopsdevstorage.blob.core.windows.net/data/{{ position.PositionImage }}" target="_blank">
                      <i class="fa fa-linkedin me-2"></i> Share on LinkedIn
                    </a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="javascript:void(0);" onclick="shareOnInstagram('{{ position.slug_url }}')">
                      <i class="fa fa-instagram me-2"></i> Share on Instagram
                    </a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="https://wa.me/?https://careersatnile.com/jobshare.php/{{ position.slug_url }}?v={{ now|date:'Y-m-d' }}">
                      <i class="fa fa-whatsapp me-2"></i> Share on WhatsApp
                    </a>
                  </li>
                  <li>
                    <a class="dropdown-item" href="https://careersatnile.com/jobshare.php/{{ position.slug_url }}">
                      <i class="fa fa-globe me-2"></i> Share on Career Site
                    </a>
                  </li>
                </ul>
              </div>
            </td>

            </tr>
          {% empty %}
          <tr>
            <td colspan="12" class="text-center"> 
              No Data Available In Records
            </td>
          </tr> 
          {% endfor %}
        </tbody>
        
      </table>  </div>
</div>

    
  </div>
</body>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const alert = document.getElementById('success-alert');
    if (alert) {
      setTimeout(() => {
        alert.style.display = 'none';
      }, 3000); // Hide after 3 seconds
    }
  });
</script>

<script>
  $(function(){
      $('#toggleSpinners').on('click', function(e){
          var form = document.querySelector('form');

          if (form.checkValidity()) {
              $('#ibox1').children('.ibox-content').toggleClass('sk-loading');
          } else {
              e.preventDefault(); 
              form.reportValidity(); 
          }
      });
  });
</script>

<script>
  function shareOnInstagram(slug) {
    const jobUrl = `https://careersatnile.com/jobshare.php/${slug}?v={{ now|date:'Y-m-d' }}`;

    const caption = `ðŸš€ Weâ€™re Hiring!

  Apply here ðŸ‘‡
  ${jobUrl}

  #Hiring #Careers #Jobs #NileHospitality`;

    // Copy caption + link
    navigator.clipboard.writeText(caption).then(() => {
      alert("Job details copied! Paste it on Instagram.");
      
      // Open Instagram
      window.open("https://www.instagram.com/", "_blank");
    });
  }
</script>


<script>
    $(document).ready(function () {
        $('select').select2();
    });
    $('#example').DataTable({
      columnDefs: [
        { orderable: false, targets: [0] } // Sr. No column index
      ]
    });
</script>

{% endblock content %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submit Resume</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    #loader {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 1000; /* Ensure it appears above other content */
}

</style>
</head>
<body>
    {% comment %} <h1>Submit Your Resume</h1>
    <form id="resumeForm" method="post" enctype="multipart/form-data">
        
        <label for="first_name">First Name:</label>
        <input type="text" id="first_name" name="first_name" required><br><br>
        <label for="last_name">Last Name:</label>
        <input type="text" id="last_name" name="last_name" required><br><br>
        <label for="phone">Phone:</label>
        <input type="text" id="phone" name="phone" required><br><br>
        <label for="job_title">Job Title:</label>
        <input type="text" id="job_title" name="job_title" required><br><br>
        <label for="location">Location:</label>
        <input type="text" id="location" name="location" required><br><br>
        <label for="resume">Upload Your Resume:</label>
        <input type="file" id="resume" name="resume" required><br><br>
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required><br><br>
        <button type="submit">Submit</button>
    </form> {% endcomment %}
    <div class="container mt-5">
        <div class="card">
            <div class="card-header">
                <h4>Submit Your Resume</h4>
            </div>
            <form id="resumeForm" method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
                <input type="hidden" id="campaign_source" name="campaign_source" value="">
                <div class="card-body">
                    <div class="row">
                        <!-- First Name -->
                        <div class="col-md-4 mb-3">
                            <label for="first_name" class="form-label">First Name:</label>
                            <input type="text" class="form-control" id="first_name" name="first_name" required>
                            <div class="invalid-feedback">First name is required.</div>
                        </div>
            
                        <!-- Last Name -->
                        <div class="col-md-4 mb-3">
                            <label for="last_name" class="form-label">Last Name:</label>
                            <input type="text" class="form-control" id="last_name" name="last_name" required>
                            <div class="invalid-feedback">Last name is required.</div>
                        </div>
            
                        <!-- Phone Number (with regex for Indian mobile numbers) -->
                        <div class="col-md-4 mb-3">
                            <label for="phone" class="form-label">Phone:</label>
                            <input type="text" class="form-control" id="phone" name="phone" pattern="^[6-9]\d{9}$" required>
                            <div class="invalid-feedback">Please enter a valid 10-digit Indian mobile number starting with 6-9.</div>
                        </div>
            
                        <!-- Email (with regex for valid email format) -->
                        <div class="col-md-4 mb-3">
                            <label for="email" class="form-label">Email:</label>
                            <input type="email" class="form-control" id="email" name="email" pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$" required>
                            <div class="invalid-feedback">Please enter a valid email address (e.g., user@example.com).</div>
                        </div>
            
                        <!-- Location -->
                        <div class="col-md-4 mb-3">
                            <label for="location" class="form-label">Location:</label>
                            <select class="form-control" id="location" name="location" required>
                                {% for org in orgs %}
                                    <option value="{{org.OrganizationName}}">{{org.OrganizationName}}</option>
                                {% endfor %}
                            </select>
                            <div class="invalid-feedback">Location is required.</div>
                        </div>
                    </div>
            
                    <!-- Job Title -->
                    <div class="mb-3">
                        <label for="job_title" class="form-label">Job Title:</label>
                        <select class="form-control" id="job_title" name="job_title" required>
                            <option value="">Select Position</option>
                            {% for Designation in Designations %}
                                <option value="{{ Designation.designations }}">{{ Designation.designations }}</option>
                            {% endfor %}
                        </select>
                        <div class="invalid-feedback">Job title is required.</div>
                    </div>
            
                    <!-- Resume Upload -->
                    <div class="mb-3">
                        <label for="resume" class="form-label">Upload Your Resume:</label>
                        <input type="file" class="form-control" id="resume" name="resume" required>
                        <div class="invalid-feedback">Resume is required.</div>
                    </div>
                </div>
                <div class="card-footer text-end">
                    <button type="submit" id="submitBtn" class="btn btn-primary" disabled>Submit</button>
                </div>
            </form>
            
        </div>
    
        <!-- Loader (hidden by default) -->
        <div id="loader" class="d-none">
            <div class="spinner-border" role="status">
                <span class="sr-only">Loading...</span>
            </div>
        </div>
    </div>
    

<!-- Bootstrap JS and dependencies -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

<script>
// JavaScript for Bootstrap validation and enabling submit button
(() => {
  'use strict'

  const form = document.getElementById('resumeForm');
  const submitBtn = document.getElementById('submitBtn');

  // Disable form submission if form is invalid
  form.addEventListener('submit', event => {
    if (!form.checkValidity()) {
      event.preventDefault();
      event.stopPropagation();
    }
    form.classList.add('was-validated');
  }, false);

  // Enable the submit button only when the form is valid
  const validateForm = () => {
    if (form.checkValidity()) {
      submitBtn.disabled = false;
    } else {
      submitBtn.disabled = true;
    }
  };

  // Add 'input' event listeners to all form fields to check for validity
  form.querySelectorAll('input').forEach(input => {
    input.addEventListener('input', validateForm);
  });

})();
</script>
<script>
    // Function to extract URL parameters dynamically
    function getCampaignSource() {
        const urlParams = new URLSearchParams(window.location.search);
        
        // Loop through all URL parameters
        for (let [key, value] of urlParams) {
            // Check if the parameter starts with 's-' and return the key
            if (key.startsWith('s-')) {
                return key;  // Return the key itself (e.g., 's-facebook')
            }
        }
        return '';  // Return an empty string if no 's-' parameter found
    }

    // When the DOM is fully loaded, set the hidden input field with the extracted URL parameter's key
    window.addEventListener('DOMContentLoaded', function () {
        const campaignSource = getCampaignSource();
        console.log(`Extracted Campaign Source Key: ${campaignSource}`);  // Debugging line to log the extracted key

        // Set the value of the hidden input field to the extracted key
        if (campaignSource) {
            document.getElementById('campaign_source').value = campaignSource;
        }

        // Enable submit button if the form is valid
        const form = document.getElementById('resumeForm');
        form.addEventListener('input', function () {
            const isValid = form.checkValidity();
            document.getElementById('submitBtn').disabled = !isValid;
        });
    });
</script>



{% comment %} 
    <script>
        document.getElementById('resumeForm').addEventListener('submit', function(e) {
            e.preventDefault();
        
            var formData = new FormData(this);
        
            // Get the CSRF token from the cookie
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
        
            const csrftoken = getCookie('csrftoken');
        
            fetch('http://127.0.0.1:8000/Open_position/api/submit-resume/', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': csrftoken
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data) {
                    alert('Resume submitted successfully!');
                    document.getElementById('resumeForm').reset();
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });
        
    </script> {% endcomment %}
    {% comment %} <script>
        document.getElementById('resumeForm').addEventListener('submit', function(e) {
            e.preventDefault(); // Prevent the default form submission behavior
    
            var formData = new FormData(this);
    
            // Get the CSRF token from the cookie
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
    
            const csrftoken = getCookie('csrftoken');
    
            fetch('http://127.0.0.1:8000/Open_position/api/submit-resume/', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': csrftoken
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data) {
                    alert('Resume submitted successfully!');
                    // Refresh the page after a short delay to show the success message
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);  // Refreshes the page after 1 second
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });
    </script> {% endcomment %}
    <script>
        document.getElementById('resumeForm').addEventListener('submit', function(e) {
            e.preventDefault(); // Prevent the default form submission behavior
    
            var formData = new FormData(this);
    
            // Show the loader
            document.getElementById('loader').classList.remove('d-none');
    
            // Get the CSRF token from the cookie
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
    
            const csrftoken = getCookie('csrftoken');
    
            fetch('/Open_position/api/submit-resume/', {
                method: 'POST',
                body: formData,
                headers: {
                    'X-CSRFToken': csrftoken
                }
            })
            .then(response => response.json())
            .then(data => {
                // Hide the loader
                document.getElementById('loader').classList.add('d-none');
                if (data) {
                    alert('Resume submitted successfully!');
                    // Refresh the page after a short delay to show the success message
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);  // Refreshes the page after 1 second
                }
            })
            .catch(error => {
                console.error('Error:', error);
                // Hide the loader
                document.getElementById('loader').classList.add('d-none');
            });
        });
    </script>
    
</body>
</html>

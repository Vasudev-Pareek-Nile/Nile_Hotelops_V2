{% extends "EMP_PAY\homebase.html" %}
{% block content %} 

{% comment %} {% extends 'EMP_PAY/NewHomeBase.html' %}
{% block NewHomeBase %} {% endcomment %}
<style>
    .LockColor{
        color: lightseagreen !important;
    }
    .LockedColor{
        color: red !important;
    }

  .table-wrapper {
    position: relative;
  }

  .table thead th {
    position: sticky;
    top: 0;
    background: white; /* or match your table header background */
    z-index: 2;
  }

  .table thead tr.filters th {
    top: 40px; /* height of the first header row */
    z-index: 1;
  }
</style>

{% for message in messages %}
<div class="cotainer mb-2">
    <div class="container text-center">
            {% if message.tags == 'success' %}
            <div class="alert alert-success" role="alert">{{ message|safe }}</div>
            {% else %}
            <div class="alert alert-danger" role="alert">{{ message|safe }}</div>
            {% endif %} 
        </div>
    </div>
{% endfor %}
<div class="card"> 
    {% comment %} <div class="card-header col-md-12 mb-3 "> Salary and Attendance Details of {{ current_month|date:"F Y" }}</div>

    <div class="row">
        <div class="col-md-6">
            <div class="row mb-3 ml-0">
                <a href="?year={{ previous_month.year }}&month_no={{ previous_month.month }}" class="btn btn-primary btn-sm">Previous Month</a>
                <a href="?year={{ next_month.year }}&month_no={{ next_month.month }}" class="btn btn-primary btn-sm ml-2">Next Month</a>
            </div>
        </div>
    </div> {% endcomment %}

    <div class="card-header col-md-12 text-uppercase fw-bold"> Salary and Attendance Details</div>

    <div class="card-body">
        <div class="row">
            <div class="col-md-2">
                <a href="?year={{ previous_month.year }}&month_no={{ previous_month.month }}" class="btn btn-primary btn-sm">Previous Month</a>
                {% comment %} <a href="?year={{ next_month.year }}&month_no={{ next_month.month }}" class="btn btn-primary btn-sm">Next Month</a> {% endcomment %}
            </div>
            <div class="col-md-8 text-center">
                <h1 style="display: inline;"> {{ current_month|date:"F Y" }}</h1>
            </div>
            <div class="text-end col-md-2">
                <a href="?year={{ next_month.year }}&month_no={{ next_month.month }}" class="btn btn-primary btn-sm">Next Month</a>
            </div>
        </div>
    </div>
</div> 



<div class="card">
    <div class="card-body">
            <div class="mb-3" style="text-align: right;">
                <input
                    type="text"
                    id="searchInput"
                    class="form-control"
                    placeholder="Search ..."
                    style="width: 200px; display: inline-block;"
                    onkeyup="searchTable()"
                >
        </div>
         <div class="table-wrapper" style="max-height: 500px; overflow-y: auto;">
  <table id="example" class="table table-striped custom-table mb-0 no-footer">
            <thead>
                <tr>
                     <th><input type="checkbox">Select</th>
                    <th>Emp Code</th>
                    <th>Emp Name</th>
                    <th>Emp Status</th>
                    <th>Attendance</th>
                    <th>Salary Verfication</th>
                    <th>Slip Generated</th>
                </tr>
                 <tr class="filters">
    
    <!-- <th><input type="checkbox">&nbsp;All</th> -->
    <!-- <th><select class="column-filter form-control form-control-sm" data-column="0"><option value="">All</option></select></th> -->
    <!-- <th><select class="column-filter form-control form-control-sm" data-column="1"><option value="">All</option></select></th>
    <th><select class="column-filter form-control form-control-sm" data-column="2"><option value="">All</option></select></th>
    
    <th><select class="column-filter form-control form-control-sm" data-column="3"><option value="">All</option></select></th>
    <th><select class="column-filter form-control form-control-sm" data-column="4"><option value="">All</option></select></th>
    
    <th><select class="column-filter form-control form-control-sm" data-column="5"><option value="">All</option></select></th>
    <th><select class="column-filter form-control form-control-sm" data-column="6"><option value="">All</option></select></th> -->

    
  </tr>
            </thead>
            <tbody id="tableBody">
                {% for emp in emps %}
                <tr>
                    <td><input type="checkbox"></td> 
                    <td>{{ emp.EmployeeCode }}</td>
                    <td>{{ emp.EmpName }}</td>
                    <td>{{ emp.EmpStatus }}</td>
                    <td>
                        {% if emp.IsLock %} <span class="LockedColor">Locked</span><br>

                        <a href="{% url 'AttendanceLockView'  %}?emp={{emp.EmployeeCode}}&year={{ year }}&month_no={{ month_no}}&IsLock={{emp.IsLock}}&lockid={{emp.lockid}}" class="LockColor">View</a>
                        <br/>
                                                <a href="{% url 'UnlockAttendanceLock'  %}?emp={{emp.EmployeeCode}}&year={{ year }}&month_no={{ month_no}}&IsLock={{emp.IsLock}}&lockid={{emp.lockid}}" class="LockColor">Un Lock </a>
                        {% else %} Saved  <br>
                        <a href="{% url 'AttendanceLockView'  %}?emp={{emp.EmployeeCode}}&year={{ year }}&month_no={{ month_no}}&IsLock={{emp.IsLock}}&lockid={{emp.lockid}}" class="LockColor">Lock </a>
                        
                        {% endif %}

                    </td>
                    <td>

                        {{emp.get_approval_status_html|safe}}
                    </td>
                    <td>
                        
                      {% if emp.generated %} 
                          Generated 

                          <br>
                          <a href="{% url 'View_Emmployee_Salary_Details'  %}?emp={{emp.EmployeeCode}}&year={{ year }}&month_no={{ month_no}}&ID={{emp.id}}"  class="LockColor">View Slip </a>
                            {% if emp.status == "Approved" %}
                              <!-- <br> -->
                              <!-- <br> -->

                              <a href="{% url 'Generate_Salary_Slip' %}?HR=Hr&Emp={{ emp.EmployeeCode }}&year={{ year }}&month_no={{ month_no }}" class="btn-primary p-1"  target="_blank"
                              >Download <i class="fa-solid fa-file-arrow-down"></i></a> 

                              {% if  emp.IsLock %}
                                <!-- <a href="{% url 'View_Emmployee_Salary_Details'  %}?emp={{emp.EmployeeCode}}&year={{ year }}&month_no={{ month_no}}&ID={{emp.id}}" class="LockColor">View Slip </a> -->
                              {% endif %} 
                            {% else %}

                            {% endif %} 
                    
                      {% else %} 
                        Not Generated <br>
                        
                        {% if  emp.IsLock %}
                            
                        <a href="{% url 'View_Emmployee_Salary_Details'  %}?emp={{emp.EmployeeCode}}&year={{ year }}&month_no={{ month_no}}&ID={{emp.id}}" class="LockColor">View Slip </a>
                        {% endif %}
                    
                      {% endif %}


                    </td>

                </tr>
                {% endfor %}
            </tbody>
        </table>
        </div>

    </div>
</div>

     <script>
  $(document).ready(function () {
    // Populate dropdowns with unique values
    $('.column-filter').each(function () {
      let colIndex = $(this).data('column');
      let values = new Set();

      $('#example tbody tr').each(function () {
        let cellText = $(this).find('td').eq(colIndex).text().trim();
        if (cellText) {
          values.add(cellText);
        }
      });

      values = Array.from(values).sort();
      for (let val of values) {
        $(this).append(`<option value="${val}">${val}</option>`);
      }
    });

    // Filter rows when dropdown changes
    $('.column-filter').on('change', function () {
      let filters = {};
      $('.column-filter').each(function () {
        let col = $(this).data('column');
        let val = $(this).val();
        if (val) {
          filters[col] = val;
        }
      });

      $('#example tbody tr').each(function () {
        let show = true;
        for (let col in filters) {
          let cellText = $(this).find('td').eq(col).text().trim();
          if (cellText !== filters[col]) {
            show = false;
            break;
          }
        }
        $(this).toggle(show);
      });
    });
  });
    function searchTable() {
        // Get the search input value
        const input = document.getElementById("searchInput").value.toLowerCase();
        const tableBody = document.getElementById("tableBody");
        const rows = tableBody.getElementsByTagName("tr");
   
        // Loop through all table rows
        for (let i = 0; i < rows.length; i++) {
            let isMatch = false;
            const cells = rows[i].getElementsByTagName("td");
   
            // Check each cell in the row
            for (let j = 0; j < cells.length; j++) {
                if (cells[j]) {
                    const cellContent = cells[j].textContent || cells[j].innerText;
                    if (cellContent.toLowerCase().indexOf(input) > -1) {
                        isMatch = true;
                        break;
                    }
                }
            }
   
            // Show or hide the row based on the match
            rows[i].style.display = isMatch ? "" : "none";
        }
    }
</script>

{% endblock content %} 
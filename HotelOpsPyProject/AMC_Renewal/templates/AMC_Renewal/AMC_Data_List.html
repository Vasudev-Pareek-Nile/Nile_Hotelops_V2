{% extends 'AMC_Renewal/AMCHomeBase.html' %}
{% block content %} 
{% load custom_filters %}
{% load static %}



<style>
    .description-column {
        width: 300px !important; 
        max-width: 300px; 
        word-wrap: break-word;
        white-space: normal;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .AcceptCircle {
        border-radius: 50px;
        display: inline-block;
        width: 20px;
        height: 20px
    }

    .Approve {
        background-color: #36ba45;
    }


    .Pending {
        background-color: #ffa500;
    }

    .Return {
        background-color: #9368E9;
    }

    .Reject {
        background-color: #FC133D;
    }

    /* Style the DataTable export buttons */
    .dt-buttons {
        margin-bottom: 10px; /* Add some spacing below the buttons */
    }

    .dt-button {
        background-color: #007bff !important; /* Change button background color */
        color: white !important; /* Change text color */
        border: none !important; /* Remove border */
        padding: 8px 15px !important; /* Adjust padding */
        border-radius: 5px !important; /* Add rounded corners */
        font-weight: bold !important; /* Make text bold */
        margin-right: 5px !important; /* Add spacing between buttons */
        cursor: pointer !important;
    }

    /* Hover effect for buttons */
    .dt-button:hover {
        background-color: #0056b3 !important;
    }

    /* Style for specific buttons */
    .buttons-copy {
        background-color: #17a2b8 !important;
    }

    .buttons-csv {
        background-color: #28a745 !important;
    }

    .buttons-excel {
        background-color: #ffc107 !important;
        color: black !important;
    }

    .buttons-pdf {
        background-color: #dc3545 !important;
    }

    .buttons-print {
        background-color: #6c757d !important;
    }
    .card-header{
        margin-bottom: -15px;
    }
    .form-control{
    border-radius: 5px !important;
    } 
    table{
        font-size: 13px !important;
    }
    table tbody tr td{
        font-size: 13px !important;
    }
</style>


{% if messages %}
    {% for message in messages %}
        {% if message.tags == 'success' %}
        <div class="card-body mb-3">
            <div class="alert alert-success d-flex align-items-center" role="alert">
                <i class="feather-check-circle flex-shrink-0 me-2"></i>
                <div>
                    {{ message }}
                </div>
            </div>
        </div>
        {% endif %}
        {% if message.tags == 'error' %}
        <div class="card-body mb-3">
            <div class="alert alert-success d-flex align-items-center" role="alert">
                <i class="feather-check-circle flex-shrink-0 me-2"></i>
                <div>
                    {{ message }}
                </div>
            </div>
        </div>
        {% endif %}
    {% endfor %}
{% endif %}

<div class="card">
    <div class="card-header text-uppercase">
        <h5 class="text-uppercase fw-bold">AMC Data list</h5>
    </div>
    <div class="card-body">
        <form method="GET" class="row g-4 mb-1">
            <div class="col-md-4">
                <!-- <label for="hotel_name" class="form-label">Organizations</label> -->
                <select name="hotel_name" class="form-control">
                    <option value="" selected>Select Organizations</option>
                    {% for org in OrganizationNameDetail %}
                        <option value="{{ org.OrganizationID }}" {% if org.OrganizationID == selected_organization %}selected{% endif %}>
                            {{ org.OrganizationName }}
                        </option>
                    {% endfor %}
                </select>      
            </div> 


            <div class="col-md-2">
                <!-- <label for="status" class="form-label">Status</label> -->
                <select name="status" id="status" class="form-control">
                    <option value="">All</option>
                    <option value="Pending" {% if request.GET.status == "Pending" %}selected{% endif %}>Pending</option>
                    <option value="Approved" {% if request.GET.status == "Approved" %}selected{% endif %}>Approved</option>
                    <option value="Rejected" {% if request.GET.status == "Rejected" %}selected{% endif %}>Rejected</option>
                    <option value="Return" {% if request.GET.status == "Return" %}selected{% endif %}>Returned</option>
                </select>
            </div>

            <div class="col-md-3 d-flex justify-items-start align-items-center gap-1">
                <button type="submit" class="btn btn-primary" id="filter">Search</button>
                <a href="{% url 'AMC_Data_List' %}" class="btn btn-danger" id="clear">Clear</a>
            </div>
        </form>


        <div class="row mt-4">
            <div class="col-md-12">
                <div class="table-responsive">
                    <table id="example" class="table table-striped custom-table mb-0 datatable display nowrap" style="width:100%" >
                        <thead>
                            <tr>
                                <th class="text-center">#</th>  <!-- Added Serial Number Column -->
                                <th class="text-center">HTL</th>
                                <th class="description-column">Description | Sr.No | Capacity</th>
                                <th>Make | Model</th>
                                <th class="text-center">AMC Date</th>
                                <th class="text-center">Rate</th>
                                <th class="text-center">FC</th>
                                <th class="text-center">GM</th>
                                <th class="text-center">CEO</th>
                                <th class="text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for profile in equipment_data %}
                                <tr>
                                    <td class="text-center">{{ forloop.counter }}</td>  <!-- Sr. No. -->
                                    <td class="text-center">{{ profile.HTL }}</td>
                                    <td class="description-column">{{ profile.Descriptions }}<br>{{ profile.SerailNumber }} |&nbsp; {{ profile.Capacity }}</td>
                                    <td >{{ profile.Make }} <br>| {{ profile.ModelNumber }}</td>
                                    <td class="text-center">
                                        {{ profile.AMC_Start_Date }}<br>
                                        {{ profile.AMC_End_Date }}
                                    </td>

                                    <td class="text-center">{{ profile.AMC_Amount }}</td>

                                    <td class="text-center">
                                        <div class="dropdown action-label">
                                                {% if profile.FC_Status == "Pending" %}
                                                    <span class="AcceptCircle Pending" ></span>
                                                {% elif profile.FC_Status == "Approved" %}
                                                    <span class="AcceptCircle Approve" ></span>
                                                {% elif profile.FC_Status == "Rejected" %}
                                                    <span class="AcceptCircle Reject" ></span> 
                                                {% elif profile.FC_Status == "Return" %}
                                                    <span class="AcceptCircle Return" ></span>
                                                {% else%}
                                                    <span class="AcceptCircle Pending" ></span>
                                                {% endif %}
                                        </div>
                                    </td>

                                    <td class="text-center">
                                        <div class="dropdown action-label">
                                                {% if profile.GM_Status == "Pending" %}
                                                    <span class="AcceptCircle Pending" ></span>
                                                {% elif profile.GM_Status == "Approved" %}
                                                    <span class="AcceptCircle Approve" ></span>
                                                {% elif profile.GM_Status == "Rejected" %}
                                                    <span class="AcceptCircle Reject" ></span>
                                                {% elif profile.GM_Status == "Return" %}
                                                    <span class="AcceptCircle Return" ></span>
                                                {% else%}
                                                    <span class="AcceptCircle Pending" ></span>
                                                {% endif %}
                                        </div>
                                    </td>

                                    <td class="text-center">
                                        <div class="dropdown action-label">
                                                {% if profile.CEO_Status == "Pending" %}
                                                    <span class="AcceptCircle Pending" ></span>
                                                {% elif profile.CEO_Status == "Approved" %}
                                                    <span class="AcceptCircle Approve" ></span>
                                                {% elif profile.CEO_Status == "Rejected" %}
                                                    <span class="AcceptCircle Reject" ></span>
                                                {% elif profile.CEO_Status == "Return" %}
                                                    <span class="AcceptCircle Return" ></span>
                                                {% else%}
                                                    <span class="AcceptCircle Pending" ></span>
                                                {% endif %}
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        <a class="btn btn-sm btn-primary" href="{% url "AMC_View_Data" profile.EquipmentID %}">View</a>
                                        <a class="btn btn-sm btn-primary" href="{% url "AMC_Renewal_Dashboard_With_ID" profile.EquipmentID %}?Mode=Update">Edit</a>
                                        <!-- <a class="btn btn-sm btn-danger text-white" id="EquipmentDelete" data-EquipmentID="{{profile.EquipmentID}}" data-OID="{{profile.OrganizationID}}" data-UserID="{{UserID}}" >Delete</a> -->
                                        <a href="javascript:void(0)"
                                            class="btn btn-sm btn-danger text-white EquipmentDelete"
                                            data-equipmentid="{{ profile.EquipmentID }}"
                                            data-oid="{{ profile.OrganizationID }}"
                                            data-userid="{{ UserID }}">
                                            Delete
                                        </a>
                                    </td>
                                    
                                </tr>
                            {% empty %}
                                <tr>
                                    <td colspan="10"><p style="color: red; text-align: center;">No Records Found</p></td>
                                    
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div> 
    </div>
</div>



<script>
    function fetchEquipmentProfile(id) {
        $.ajax({
            url: `/AMC_Renewal/AMC_List_equipment_view/`,
            type: "GET",
            dataType: "json",
            success: function(data) {
                if (data.length > 0) {
                    let equipment = data[0];  // Assuming the API returns an array
                    
                    $('#description').text(equipment.Descriptions);
                    $("#model").text(equipment.ModelNumber);
                    $("#amc_Make").text(equipment.Make);
                    $("#Serial").text(equipment.SerailNumber);
                    $("#Capacity").text(equipment.Capacity);
                    $("#CommissioningDate").text(equipment.CommissioningDate);
                    $("#UnitAmount").text(equipment.UnitAmount);
                    $("#Department").text(equipment.Department);
                    $("#Location").text(equipment.Area);
                    $("#Scheduleofservicing").text(equipment.Scheduleofservicing);
                    $("#ResponsiblePerson").text(equipment.ResponsiblePerson);
                    $("#YearlyExpense").text(equipment.YearlyExpense);
                    $("#WarrantyEndDate").text(equipment.WarrantyEndDate);
                    $("#WarrantyStatus").text(equipment.Status);
                }
            },
            error: function(error) {
                console.log("Error fetching data", error);
            }
        });
    }
</script>


<script>
    $(document).on("click", ".EquipmentDelete", function () {

        if (!confirm("Are you sure you want to delete this AMC record?")) {
            return;
        }

        const EquipmentID = $(this).data("equipmentid");
        const OrganizationID = $(this).data("oid");
        const UserID = $(this).data("userid");

        $.ajax({
            url: "{% url 'delete_amc_entry' %}",
            type: "POST",   
            data: {
                EquipmentID: EquipmentID,
                OrganizationID: OrganizationID,
                UserID: UserID,
                csrfmiddlewaretoken: "{{ csrf_token }}"
            },
            success: function (response) {
                if (response.status === true) {
                    alert(response.message);
                    location.reload();   
                } else {
                    alert(response.message);
                    location.reload();   
                }
            },
            error: function () {
                alert("Something went wrong while deleting!");
            }
        });
    });
</script>

{% endblock content %}
{% extends "ceodashboard/homebase.html" %}
{% block content %}
{% load static %}

<style>
  .employee-dashboard-container {
    display: flex;
    gap: 20px;
    margin-top: 20px;
    flex-wrap: wrap;
    width: 100%;
  }


    .employee-dashboard-container .card {
        width: 100%;
    }

  .employee-welcome-card {
    flex: 0 0 40%;
    background-color: #f8f9fa;
    border-radius: 10px;
  }

  .employee-details {
    flex: 0 0 58%;
    background-color: #ffffff;
    border-radius: 10px;
    padding: 15px;
    box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
  }

  .welcome-info {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .Profile-Img {
    width: 50px;
    height: 50px;
    /* overflow: hidden; */
    flex-shrink: 0;
  }

  .Profile-Img img{
    width: 80px !important;
    height: 80px !important;
    object-fit: cover;
    border-radius: 50%;
  }

  .info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 15px;
    flex: 3;
  }

  .info-item {
    font-size: 14px;
  }

  .info-item span {
    font-weight: 600;
    display: block;
  }

  .dashboard-bottom-section {
    display: flex;
    gap: 20px;
    /* margin-top: 20px; */
    flex-wrap: wrap;
  }

  .AllLeaves-Container {
    flex: 0 0 20%;
  }

  .Calendar-Container {
    flex: 0 0 54%;
  }

  .LeaveAction-Container {
    flex: 0 0 23%;
  }



  @media (max-width: 768px) {
    .employee-welcome-card, .employee-details {
      flex: 0 0 100%;
    }

    .AllLeaves-Container,
    .Calendar-Container,
    .LeaveAction-Container {
      flex: 0 0 100%;
    }
  }

  /* all leaves */
  .card-bodyAllLeaves{
    padding: 0px 24px !important;
    /* border-bottom: 0.5px solid #222; */
  }

    .page-wrapper .content {
        padding: 0px 24px !important;
    }

    .LeaveAction-Cards{
        display: flex;
        justify-content: space-between;
        gap: 10px;
        
    }
    .LeaveAction-Cards div {
        display: flex;
        flex-direction: column;
        text-align: center;
    }

    .LeaveAction-Cards div span:first-child{
        color: green;
    }
    .LeaveAction-Cards div:nth-child(2) span:first-child{
        color: orange;
    }
    .LeaveAction-Cards div:nth-child(3) span:first-child{
        /* color: #958c7d; */
        color: red;
    }

    /* profile image */
    .profile-img-wrap {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
    }

    .welcome-btn {
        margin-top: 10px;
    }

    .welcome-btn .btn {
        padding: 4px 12px;
        font-size: 14px;
        border-radius: 20px;
    }

    /* .profile-view .profile-img-wrap { */
        /* height: 200px; */
        /* width: 120px; */
        /* position: absolute; */
    /* } */

    .profile-view .profile-img-wrap img{
        border-radius: 50%;
        height: 80px;
        width: 80px;
    }

    #ViewProfile:hover{
        background-color:transparent;
        border-color: #3a4a93;
        color: #3a4a93 !important;
    }


    /* Latest Notification */
    .employee-notification-list{
        display: flex;
        flex-direction: column;
        gap: 5px;
        margin-top: 25px;
        height: 390px;
        max-height: 390px;
        overflow-y: scroll;
    }

    .employee-noti-content .employee-notification-list .employee-notification-grid {
        display: -webkit-box;
        display: -ms-flexbox;
        display: flex;
        align-items: center;
        -webkit-box-align: center;
        -ms-flex-align: center;
        box-shadow: none  !important;
        padding: 12px;
        margin-bottom: 5px;
    }


    /* .LeaveAction-Cards{
        margin-top: ;
    } */

    /* View Attendence */
    .view-attendance a {
        color: #373B3E;
        font-weight: 500;
        display: -webkit-inline-box;
        display: -ms-inline-flexbox;
        display: inline-flex;
        align-items: center;
        -webkit-box-align: center;
        -ms-flex-align: center;
    }
</style>

<style>
  #calendar {
    max-width: 900px;
    height: 450px;
    margin: 0 auto;
  }

  .fc-daygrid-day-number {
    color: #3a4a93; /* Change to any color like red, blue, etc. */
    font-weight: bold;
  }

  /* Change date numbers in each cell */
    .fc-daygrid-day-number {
        color: #3a4a93; /* black or any color */
        font-weight: bold;
    }

    /* Change month title (OCTOBER 2024) */
    .fc-toolbar-title {
        font-size: 20px !important;
        color: #333;
        font-weight: 600;
    }

    /* Change weekday header colors (SUN, MON, etc.) */
    .fc-col-header-cell-cushion {
        color: #3a4a93;
        font-weight: bold;
        font-size: 14px;
    }

    /* Optional: Style header buttons */
    .fc-button {
        background-color: #007bff;
        color: #fff;
        border: none;
        padding: 5px 10px;
        font-size: 13px !important;
    }

    .fc-button:hover {
        background-color: #0056b3;
    }

</style>


<style>
    .card-loader {
        display: none;
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #ffffffcc;
        z-index: 10;
        justify-content: center;
        align-items: center;
    }

    .text-primary-spinner{
        color: #3a4a93;
    }

    #HR_DashboardBtn{
        position:absolute;
        top: 0px;
        right: 10px;
    }
</style>

<div class="employee-dashboard-container">
    <div class="col-sm-12" >
    <div class="card">
        <div class="card-body" id="HRDashboardBtn_Container">

            <div class="row" >
                <!-- Loader -->
                <div class="profile-view" style="position: relative;" id="profile-card">
                    {% if  request.session.Department_Name|lower == "hr" %} 
                        <div id="HR_DashboardBtn">
                            <a href="{% url 'HR_Dashboard' %}"  class="btn btn-sm btn-primary " id="ViewProfile">HR Dashboard</a>
                        </div>
                    {% endif %}
                    <!-- ðŸ‘‡ LOADER INSIDE profile-view -->
                    <div class="card-loader">
                        <div>
                            <div class="spinner-border text-primary-spinner" role="status" style="width: 2.5rem; height: 2.5rem;"></div>
                            <div style="margin-top: 0.5rem; font-weight: bold; color: #3a4a93;">Loading...</div>
                        </div>
                    </div>

                    <div class="profile-img-wrap">
                            <div class="profile-img">
                                <a>
                                    <img id="emp-profile-image" src="/static/Images/avatarimg.webp" alt="Profile Image Preview">
                                </a>
                                {% comment %} <a href="{% url 'Employee_Personal_Dashboard' %}"  class="btn btn-sm btn-primary mt-2 rounded-2" id="ViewProfile">Dashboard</a> {% endcomment %}
                            </div>
                        </div>
                        <div class="profile-basic">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="profile-info-left">
                                        <h3 class="user-name m-t-0 mb-0" id="emp-full-name"></h3>
                                        <ul class="personal-info mt-2">
                                            <li>
                                                <div class="title">Designation:</div>
                                                <div class="text" id="emp-designation"></div>
                                            </li>
                                            <li>
                                                <div class="title">Department:</div>
                                                <div class="text" id="emp-department"></div>
                                            </li>
                                            <li>
                                                <div class="title">Reports to:</div>
                                                <div class="text" id="emp-reporting-to"></div>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="col-sm-4">
                                    <ul class="personal-info" style="border-right: 2px dashed #D3D3D4;">
                                        <li>
                                            <div class="title">Code:</div>
                                            <div class="text" id="emp-code"></div>
                                        </li>
                                        <li class="d-flex align-items-center">
                                            <div class="title">Status:</div>
                                            <div class="text" id="emp-status"></div>
                                        </li>
                                        <li>
                                            <div class="title">DOJ:</div>
                                            <div class="text" id="emp-doj"></div>
                                        </li>
                                        <li>
                                            <div class="title">Tenure:</div>
                                            <div class="text" id="emp-tenure"></div>
                                        </li>
                                    </ul>
                                </div>
                                <div class="col-md-4">
                                    <ul class="personal-info">
                                    <li>
                                        <div class="title">Phone:</div>
                                        <div class="text" id="emp-phone"></div>
                                    </li>
                                    <li>
                                        <div class="title">Email:</div>
                                        <div class="text" id="emp-email"></div>
                                    </li>
                                    <li>
                                        <div class="title">Birthday:</div>
                                        <div class="text" id="emp-birthday"></div>
                                    </li>

                                    <li>
                                        <div class="title">Gender:</div>
                                        <div class="text" id="emp-gender"></div>
                                    </li>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div> 
</div>

<div class="dashboard-bottom-section border-bottom">
  <div class="card AllLeaves-Container border-bottom">
    <div class="card-header border-bottom  d-flex justify-content-between align-items-center">
        <span class="card-title fw-bold fs-5">All Leaves</span>
        <div class="view-attendance">
            <a href="{% url "Leave_Application" %}?Page=Employee_Personal_Dashboard">
                Apply Leave <i class="fas fa-arrow-circle-right"></i>
            </a>
        </div>
    </div>
      <!-- <hr> -->
    <div class="card-body card-bodyAllLeaves mt-2">
      <div id="LeavesContainer"></div>
    </div>
  </div>

  <div class="card Calendar-Container">
     <div class="card-header border-bottom d-flex justify-content-between align-items-center">
        <span class="card-title fw-bold fs-5">Attendance</span>
        <div class="d-flex flex-row gap-3 mt-2">
            <span class="text-success"><span class="fw-bold">A - </span>Approved</span>|
            <span class="text-warning"><span class="fw-bold">P - </span>Pending</span>|
            <span class="text-danger"><span class="fw-bold">R - </span>Rejected</span>|
        </div>
    </div>
    <div class="card-body">
       <div id="calendar"></div>
      <!-- Your calendar or upcoming events go here -->
    </div>
  </div>

  <div class="card LeaveAction-Container">
    <div class="card-header border-bottom"><span class="card-title fw-bold fs-5">Leave Summery</span></div>
    <div class="card-body">
      <!-- <h4>Leave Actions</h4> -->
      <!-- Apply Leave, View History, etc. -->
       <div class="LeaveAction-Cards">
        <div>
            <span id="ApprovedCount"></span>
            <span>Approved</span>
        </div>
        <div>
            <span id="PendingCount"></span>
            <span>Pending</span>
        </div>
        <div>
            <span id="RejectedCount"></span>
            <span>Rejected</span>
        </div>
       </div>
       <!-- <div class="TopLatest"> -->
        <div class="">
            <div class="tab-pane active" id="notification_tab" role="tabpanel">
                <div class="employee-noti-content">
                    <ul  class="employee-notification-list" id="leave-notifications"></ul>
                    </div>
                </div>
            </div>
       </div>
    <!-- </div> -->
  </div>
</div>



<!-- Modal For Attendance View-->
<div id="add_leave" class="modal custom-modal fade" role="dialog">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Details</h5>
                <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body d-flex flex-column gap-3">
                <!-- Attendance Details -->
                <div id="attendanceDetails">
                    <div id="attendanceDetails" class="d-flex gap-5 mb-2">
                        <div class="d-flex flex-column">
                            <p><strong>In-Time:</strong> <span id="modalInTime"></span></p>
                            <p><strong>S-In-Time:</strong> <span id="modalSecondInTime"></span></p>
                            <p><strong>Duty Hours:</strong> <span id="modalDutyHours"></span></p>
                        </div>
                        <div class="d-flex flex-column">
                            <p><strong>Out-Time:</strong> <span id="modalOutTime"></span></p>
                            <p><strong>S-Out-Time:</strong> <span id="modalSecondOutTime"></span></p>
                            <p><strong>Status:</strong> <span id="modalStatus"></span></p>
                        </div>
                    </div>
                </div>

                <!-- Leave Details (Initially Hidden) -->
                <div  id="leaveDetails" style="display: none;">
                    <div class="d-flex flex-column">
                        <div class="d-flex gap-5 mb-2">
                            <div class="d-flex flex-column w-50">
                                <p><strong>Status:</strong> <span id="modalLeavestatus"></span></p>
                                <p><strong>Start Date:</strong> <span id="modalStartDate"></span></p>
                                <p><strong>Total days:</strong> <span id="modalTotalCredit"></span></p>
                            </div>
                            <div class="d-flex flex-column">
                                <p><strong>Leave:</strong> <span id="modalTitle" style="color:#3498db"></span></p>
                                <p><strong>End Date:</strong> <span id="modalEndDate"></span></p>
                                <p><strong>Remark:</strong> <span id="modalRemark"></span></p>
                            </div>
                        </div>
                        <div class="d-flex flex-column mt-2">
                            <p><strong>Reporting To:</strong> <span id="modalReporting"></span></p>
                            <p><strong>Reason:</strong> <span id="modalReason"></span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div> 

{% comment %} <div id="loader" style="display: flex; justify-content: center; align-items: center; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.7); z-index: 9999;">
  <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
    <span class="visually-hidden">Loading...</span>
  </div>
</div> {% endcomment %}

<style>
    .text-primary-spinner{
        color: #3a4a93;
    }
</style>

<div id="loader" style="display: flex; flex-direction: column; justify-content: center; align-items: center; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #3a4a932b; z-index: 9999;">
  <div class="spinner-border text-primary-spinner" role="status" style="width: 3rem; height: 3rem;"></div>
  <div style="margin-top: 1rem; font-weight: bold; font-size: 1.2rem; color: #3a4a93;">
    Loading...
  </div>
</div> 



<!-- FullCalendar CSS -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet" />

<!-- FullCalendar JS -->
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>

<!-- Optional: Moment.js (if you're using it for date formatting) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>


<script>
    function showLoader(cardId) {
        const card = document.getElementById(cardId);
        const loader = card.querySelector(".card-loader");
        loader.style.display = "flex";
    }

    function hideLoader(cardId) {
        const card = document.getElementById(cardId);
        const loader = card.querySelector(".card-loader");
        loader.style.display = "none";
    }
</script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
    // const loader = document.getElementById("profile-card-loader");
    // loader.style.display = "flex"; // Show loader

    showLoader("profile-card");

    // fetch("/HR_Dashboard/api/Employee_Card_Details_Api/")
    fetch("/dashboard/api/Employee_Card_Details_Api/")
        .then(response => response.json())
        .then(data => {
        const emp = data.Emobj;

        document.getElementById("emp-full-name").textContent = `${emp.FullName || ''}`;
        document.getElementById("emp-designation").textContent = `${emp.Designation || ''} (${emp.Level || ''})`;
        document.getElementById("emp-department").textContent = emp.Department || '';
        document.getElementById("emp-reporting-to").textContent = emp.ReportingtoDesignation || '';
        document.getElementById("emp-code").textContent = emp.EmployeeCode || '';
        document.getElementById("emp-status").textContent = emp.EmpStatus || '';
        document.getElementById("emp-doj").textContent = formatDate(emp.DateofJoining);
        document.getElementById("emp-tenure").textContent = emp.TenureTillToday || '';
        document.getElementById("emp-phone").textContent = emp.MobileNumber || '';
        document.getElementById("emp-email").textContent = emp.EmailAddress || '';
        document.getElementById("emp-birthday").textContent = formatBirthday(emp.DateofBirth);
        document.getElementById("emp-gender").textContent = emp.Gender || '';

        const profileImg = document.getElementById("emp-profile-image");
        if (emp.ProfileImageFileName) {
            profileImg.src = `/HumanResources/Humanview_file/?ID=${emp.EmpID}&model=EmployeePersonalDetails`;
        }

        // loader.style.display = "none"; // âœ… Hide loader after data loads
        // Hide loader after data loads
        hideLoader("profile-card");
        })
        .catch(error => {
            console.error("Failed to load employee data:", error);
            // loader.innerHTML = `
            //     <div style="text-align:center; color:red; font-size:18px;">
            //     Failed to load data. Please try again later. <br><br>
            //     Contact <strong>support@hotelops.in</strong>
            //     </div>`;
            // setTimeout(() => loader.style.display = "none", 3000);

            hideLoader("profile-card");
        });

    function formatDate(dateStr) {
        if (!dateStr) return "";
        const date = new Date(dateStr);
        return date.toLocaleDateString('en-IN', { year: 'numeric', month: 'long', day: 'numeric' });
    }

    function formatBirthday(dateStr) {
        if (!dateStr) return "";
        const date = new Date(dateStr);
        return date.toLocaleDateString('en-IN', { month: 'long', day: 'numeric' });
    }
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {

    // Show loader initially
    const loader = document.getElementById("loader");
    loader.style.display = "flex";



    fetch('/dashboard/api/employee-dashboard/')
        .then(response => response.json())
        .then(data => {
            // ========== Section 1: Calendar Setup ==========
            let employee_data = data["employee_data"];
            const firstKey = Object.keys(employee_data)[0];
            let attendanceData = employee_data[firstKey]["Attendance"];

            let events = attendanceData.map(item => {
                if (item.type === 'attendance') {
                const eventDate = convertToIsoDate(item.DateFormatted || item.Date);
                if (!eventDate) return null;

                return {
                    title: item.title || item.status,
                    start: eventDate,
                    allDay: true,
                    type: 'attendance',
                    in_time: item.in_time,
                    out_time: item.out_time,
                    s_in_time: item.s_in_time,
                    s_out_time: item.s_out_time,
                    duty_hours: item.duty_hours,
                    status: item.status,
                    backgroundColor: item.status === "Present" ? "#A5D6A7" :
                                    item.status === "Absent" ? "#EF9A9A" :
                                    item.title === "Weekly Off" ? "#90CAF9" :
                                    "#7986CB",
                    textColor: "#000"
                };

                } else if (item.type === 'leave' || (item.start && item.end)) {
                const parseDate = d => d.split("-").reverse().join("-");

                const leaveStatusMap = {
                    0: { code: 'P', color: '#FFA726' },
                    1: { code: 'A', color: '#66BB6A' },
                    "-1": { code: 'R', color: '#EF5350' }
                };

                const statusInfo = leaveStatusMap[String(item.Leavestatus)] || { code: 'U', color: '#BDBDBD' };

                return {
                    title: `${item.title} -- ${statusInfo.code}`,
                    titleValue: item.title,
                    start: parseDate(item.start),
                    end: moment(parseDate(item.end)).add(1, "days").format("YYYY-MM-DD"),
                    allDay: true,
                    type: 'leave',
                    Reason: item.Reason,
                    Remark: item.Remark,
                    ReportingtoDesigantion: item.ReportingtoDesigantion,
                    Total_credit: item.Total_credit,
                    Leavestatus: item.Leavestatus,
                    backgroundColor: statusInfo.color,
                    textColor: "#fff"
                };
                }
            }).filter(Boolean);

            const calendarEl = document.getElementById("calendar");
            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: "dayGridMonth",
                headerToolbar: {
                left: "prev,next today",
                center: "title",
                right: "dayGridMonth"
                },
                events: events,
                eventDidMount: function (info) {
                info.el.style.color = "#000";
                info.el.style.fontWeight = "bold";
                info.el.style.fontSize = "12px";
                info.el.style.padding = "2px";
                info.el.style.borderRadius = "4px";
                },
                eventClick: function (info) {
                const event = info.event.extendedProps;
                const modal = new bootstrap.Modal(document.getElementById('add_leave'));
                modal.show();

                if (event.type === 'leave') {
                    document.getElementById('leaveDetails').style.display = 'block';
                    document.getElementById('attendanceDetails').style.display = 'none';

                    document.getElementById('modalTitle').innerHTML = event.titleValue || '';
                    document.getElementById('modalStartDate').innerText = info.event.startStr || '';
                    document.getElementById('modalEndDate').innerText = info.event.endStr || '';
                    document.getElementById('modalReason').innerText = event.Reason || '';
                    document.getElementById('modalRemark').innerText = event.Remark || '';
                    document.getElementById('modalReporting').innerText = event.ReportingtoDesigantion || '';
                    document.getElementById('modalTotalCredit').innerText = event.Total_credit || '';

                    const leaveStatusEl = document.getElementById('modalLeavestatus');
                    leaveStatusEl.innerText = getStatusLabel(event.Leavestatus);
                    leaveStatusEl.classList.remove("text-warning", "text-success", "text-danger");
                    leaveStatusEl.classList.add(statusClassMap[event.Leavestatus] || "text-dark");

                } else {
                    document.getElementById('leaveDetails').style.display = 'none';
                    document.getElementById('attendanceDetails').style.display = 'block';

                    document.getElementById('modalInTime').innerText = event.in_time || '';
                    document.getElementById('modalOutTime').innerText = event.out_time || '';
                    document.getElementById('modalSecondInTime').innerText = event.s_in_time || '';
                    document.getElementById('modalSecondOutTime').innerText = event.s_out_time || '';
                    document.getElementById('modalDutyHours').innerText = event.duty_hours || '';

                    const AttendanceStatusEl = document.getElementById('modalStatus');
                    AttendanceStatusEl.innerText = event.status;
                    AttendanceStatusEl.classList.remove("text-success", "text-danger");
                    AttendanceStatusEl.classList.add(statusClassAttendence[event.status] || "text-dark");
                }
                }
            });
            calendar.render();

            // ========== Section 2: Employee Info ==========
            // const emp = data.Emobj;
            // document.getElementById("emp-full-name").textContent = `${emp.FullName || ''}`;
            // document.getElementById("emp-designation").textContent = `${emp.Designation || ''} (${emp.Level || ''})`;
            // document.getElementById("emp-department").textContent = emp.Department || '';
            // document.getElementById("emp-reporting-to").textContent = emp.ReportingtoDesignation || '';
            // document.getElementById("emp-code").textContent = emp.EmployeeCode || '';
            // document.getElementById("emp-status").textContent = emp.EmpStatus || '';
            // document.getElementById("emp-doj").textContent = formatDate(emp.DateofJoining);
            // document.getElementById("emp-tenure").textContent = emp.TenureTillToday || '';
            // document.getElementById("emp-phone").textContent = emp.MobileNumber || '';
            // document.getElementById("emp-email").textContent = emp.EmailAddress || '';
            // document.getElementById("emp-birthday").textContent = formatBirthday(emp.DateofBirth);
            // document.getElementById("emp-gender").textContent = emp.Gender || '';

            // const profileImg = document.getElementById("emp-profile-image");
            // if (emp.ProfileImageFileName) {
            //     profileImg.src = `/HumanResources/Humanview_file/?ID=${emp.EmpID}&model=EmployeePersonalDetails`;
            // }

            // ========== Section 3: Leave Notification ==========
            const leave_Action_Cards = data.Selected_Leave_Application;
            const leaveList = document.getElementById("leave-notifications");
            const statusMap = { '0': "Is Pending", '1': "Is Approved", '-1': "Is Rejected" };
            const statusColorMap = { '0': "badge-soft-danger", '1': "badge-soft-success", '-1': "badge-soft-secondary" };
            const textColorClassMap = { '0': "text-danger", '1': "text-success", '-1': "text-secondary" };

            leave_Action_Cards.forEach((leave) => {
                const statusText = statusMap[leave.Status] || "has Unknown Status";
                const badgeClass = statusColorMap[leave.Status] || "badge-soft-light";
                const textClass = textColorClassMap[leave.Status] || "text-muted";

                const li = document.createElement("li");
                li.className = "employee-notification-grid";
                li.innerHTML = `
                <div class="employee-notification-icon">
                    <a>
                    <span class="${badgeClass} rounded-circle">${leave.Leave_Type_Master.Type}</span>
                    </a>
                </div>
                <div class="employee-notification-content">
                    <h6><a class="${textClass}">Your ${leave.Leave_Type_Master.Type} Request ${statusText}</a></h6>
                    <ul class="nav">
                    <li>${leave.Start_Date}</li>
                    <li>${leave.End_Date}</li>
                    </ul>
                </div>
                `;
                leaveList.appendChild(li);
            });

            // ========== Section 4: Leave Balance ==========
            const Leave_Balance = data.leave_balance;
            const LeavesContainer = document.getElementById("LeavesContainer");

            Leave_Balance.forEach((leave) => {
                const li = document.createElement("div");
                li.className = "d-flex justify-content-between border-bottom p-1 pt-2";
                li.innerHTML = `<p>${leave.Leave_Type_Master.Type}</p><p>${leave.Balance}</p>`;
                LeavesContainer.appendChild(li);
            });

            // ========== Section 5: Status Count ==========
            document.getElementById("ApprovedCount").innerHTML = data.leave_requset_appr_count;
            document.getElementById("PendingCount").innerHTML = data.leave_requset_Pending_count;
            document.getElementById("RejectedCount").innerHTML = data.leave_requset_rejected_count;

            // HIDE the loader after all rendering
            // document.getElementById("loader").style.display = "none";

            // Hide loader when successful
            loader.style.display = "none";
        })
        .catch(error => {
            console.error("Failed to load employee data:", error);

            //loader.innerHTML = `
            //    <div style="text-align:center; color:red; font-size:18px;">
            //        Failed to load data. Please try again later. 
            //        <br>
            //        <br>
            //        kindly Connect With us on <strong>support@hotelops.in</strong>
            //    </div>
            //`;

            // Wait 3 seconds, then hide loader
            //setTimeout(() => {
            //    loader.style.display = "none";
            //}, 2000);
            loader.style.display = "none";
        });

    // ========== Utility Functions ==========
    function convertToIsoDate(dateStr) {
        if (!dateStr) return null;
        const [dd, mm, yyyy] = dateStr.split("-");
        return `${yyyy}-${mm}-${dd}`;
    }

    function formatDate(dateStr) {
        if (!dateStr) return "";
        const date = new Date(dateStr);
        return date.toLocaleDateString('en-IN', { year: 'numeric', month: 'long', day: 'numeric' });
    }

    function formatBirthday(dateStr) {
        if (!dateStr) return "";
        const date = new Date(dateStr);
        return date.toLocaleDateString('en-IN', { month: 'long', day: 'numeric' });
    }

    function getStatusLabel(code) {
        switch (code) {
        case 0: return "Pending";
        case 1: return "Approved";
        case -1: return "Rejected";
        default: return "Unknown";
        }
    }

    const statusClassMap = {
        0: "text-warning",
        1: "text-success",
        "-1": "text-danger"
    };

    const statusClassAttendence = {
        'Half Day Present': "text-success",
        'Present': "text-success",
        'Absent': "text-danger"
    };
    });
</script>





{% endblock content %}

{% extends 'EmpAbscondingTemp/homebase.html' %}
{% load static %}

{% block content %}
 
<style>
  label{
    padding-top: 14px;
    margin-bottom:5px;
  }
</style>


<div class="card">
  <div class="card-header"><strong>Employee Absconding Form</strong></div>

  <form action="" method="post">
    
    <div class="card-body">
      <div class="col-md-12">
        <div class="row">
          <!-- Employee Code -->
          <div class="col-md-4">
            <div class="form-group">
              <label for="emp_code">Employee Code:</label>
              <input type="text" name="emp_code" id="emp_code" class="form-control" value="{{ Abscondingobj.Emp_Code|default_if_none:'' }}" readonly>
            </div>
          </div>
          
          <!-- Employee Name -->
          <div class="col-md-4">
            <div class="form-group">
              <label for="name">Employee Name:</label>
              <input type="text" name="name" id="name" class="form-control" value="{{ Abscondingobj.Name|default_if_none:'' }}" readonly>
            </div>
          </div>

          <!-- Date of Joining -->
          <div class="col-md-4">
            <div class="form-group">
              <label for="doj">Date of Joining:</label>
              <input type="date" name="doj" id="doj" class="form-control" value="{{ Abscondingobj.DOJ|date:'Y-m-d' }}" readonly>
            </div>
          </div>

          <!-- Department -->
          <div class="col-md-4">
            <div class="form-group">
              <label for="dept">Department:</label>
              <input type="text" name="dept" id="dept" class="form-control" value="{{ Abscondingobj.Dept|default_if_none:'' }}" readonly>
            </div>
          </div>

          <!-- Designation -->
          <div class="col-md-4">
            <div class="form-group">
              <label for="designation">Designation:</label>
              <input type="text" name="designation" id="designation" class="form-control" value="{{ Abscondingobj.Designation|default_if_none:'' }}" readonly>
            </div>
          </div>
          
          <!-- Date of Absconding -->
          <div class="col-md-4">
            <div class="form-group">
              <label for="date_of_absconding">Date of Absconding:</label>
              <input type="date" name="date_of_absconding" id="date_of_absconding" class="form-control" value="{% if  Abscondingobj.Date_Of_Absconding %}{{ Abscondingobj.Date_Of_Absconding|date:'Y-m-d' }}{% else %}{% now "Y-m-d" %}{% endif %}">
            </div>
          </div>
             <!-- Issuing Manager Name -->
             <div class="col-md-4">
              <div class="form-group">
                  <label for="Issuing_designation">Issuing Designation</label> {{Abscondingobj.Issuing_designation}}
                  <select class="form-control" name="Issuing_designation" id="Issuing_designation" required>
                      <option value="">Select</option>
                      {% for ManagerName in ManagerNames %}
                          <option value="{{ ManagerName.designations }}" {% if Abscondingobj.Issuing_designation == ManagerName.designations %} selected {% endif %} data-fullname="{{ ManagerName.EmployeeName }}">
                              {{ ManagerName.designations }}
                          </option>
                      {% endfor %}
                  </select>
              </div>
          </div>
          
          <!-- Issuing Manager Name -->
          <div class="col-md-4">
              <div class="form-group">
                  <label for="Issuing_manager_name">Issuing Manager Name</label>
                  <input type="text" class="form-control" name="Issuing_manager_name" id="Issuing_manager_name" value="{{ Abscondingobj.Issuing_manager_name }}" required readonly>
              </div>
          </div>


        <div class="col-md-2">
          <div class="form-group">
              <label for="Issuing_designation">Show Cause Notice:</label>
              <input type="checkbox"  name="showcause" value="C"  class="ml-2 mt-3" id="showcause" {% if  Abscondingobj.showcause %}checked{% endif %}>
          </div>
        </div>
          
       <div class="col-md-4">
          <div class="form-group">
            {% comment %} <label for="LastEmpStatus">Last Employee Status:</label> {% endcomment %}
            <input type="hidden" name="LastEmpStatus" id="LastEmpStatus" readonly class="form-control" value="{{ Abscondingobj.LastEmpStatus|default_if_none:'' }}">
          </div>
        </div>   

        {% comment %} <div class="col-md-2">
          <div class="form-group">
            <label for="AbscondingRevoke">Absconding Revoke:</label>
            <input type="checkbox" name="AbscondingRevoke" id="AbscondingRevoke" value="Revoke" class="ml-2 mt-3" {% if Abscondingobj.AbscondingRevoke %}checked{% endif %}>
          </div>
        </div> {% endcomment %}

          <!-- Remarks -->
          <!-- <div class="col-md-12">
            <div class="form-group">
              <label for="remarks">Remarks:</label>
              <textarea name="remarks" id="remarks" class="form-control" rows="3">{{ Abscondingobj.Remarks|default_if_none:'' }}</textarea>
            </div>
          </div> -->

          <div class="col-md-12">
            <div class="form-group">
              <label for="remarks">Remarks:</label>
              <textarea name="remarks" id="remarks" class="form-control" maxlength="1500" rows="3"
                  placeholder="Enter remarks (max 1500 characters)"
                  title="Enter Less Than 1500 characters">{{ Abscondingobj.Remarks|default_if_none:'' }}</textarea>
              <small id="charWarning" class="text-danger d-none">⚠️ Max limit of 1500 characters reached!</small>
            </div>
          </div>

        </div>
      </div>
    </div>

    {% csrf_token %}
    <div class="CustomFooter">
      <input type="submit" class="btn btn-primary" value="Submit">
    </div>
  </form>
</div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
      const textarea = document.getElementById("remarks");
      const warning = document.getElementById("charWarning");

      textarea.addEventListener("input", function () {
          const remaining = 1500 - textarea.value.length;

          if (remaining <= 0) {
              warning.classList.remove("d-none");
          } else {
              warning.classList.add("d-none");
          }
      });
  });
</script>

<script>
  function updateManagerName() {
      const select = document.getElementById("Issuing_designation");
      const selectedOption = select.options[select.selectedIndex];
      const fullName = selectedOption.getAttribute("data-fullname");
      document.getElementById("Issuing_manager_name").value = fullName ? fullName : '';
  }

  document.addEventListener("DOMContentLoaded", function() {
      updateManagerName();
  });

  document.getElementById("Issuing_designation").addEventListener("change", updateManagerName);
</script>


{% endblock %}

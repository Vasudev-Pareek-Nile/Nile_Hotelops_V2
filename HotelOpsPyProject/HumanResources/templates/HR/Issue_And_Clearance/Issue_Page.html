{% extends "HR/homebase.html" %}
{% load static %}
{% load encryption_filters %}

{% block content %}

<style>
    table{
        border: 1px solid #E9E9EA;
    }
    table, tr td, th{
        border: 1px solid #afafb0;
    }

    #employeeTable thead tr th{
        text-transform: uppercase;
        font-weight: bold;
    }

    .btn-warning, .btn-success{
        border-radius: 5px !important;
    }

    .card .card-body {
        padding: 16px !important;
    }

    .card .card-header {
        margin-bottom: -20px !important;
    }

    #employeeTable_previous a{
        display: flex !important;
        align-items: center !important;
        height: 38px !important;
        width: 34.5px !important;
        justify-content: center !important;
    }

    #employeeTable_next a{
        display: flex !important;
        align-items: center !important;
        height: 38px !important;
        width: 34.5px !important;
        justify-content: center !important;
    }
</style>

<div class="card">
    <div class="card-header mb-2">
        <span class="mb-0 fw-bold text-uppercase">Issue</h3>
    </div>

    <div class="card-body ">
        <div class="col-md-12">
            <form method="GET" class="row g-2">
                <div class="col-md-3">
                    {% comment %} <label for="organizationSelect" class="form-label">Select Organizations</label> {% endcomment %}
                    <select name="OID" id="organizationSelect" class="form-control">
                        {% for itm in memOrg %}
                        <option value="{{ itm.OrganizationID }}" {% if itm.OrganizationID == OID %}selected{% endif %}>{{ itm.OrganizationName }}</option>
                        {% endfor %}
                    </select>
                      <script>
                          $(document).ready(function () {
                              var selectedOrganization = "{{ OID }}";
                              $("select[name='OID']").val(selectedOrganization);
                              
                          });
                      </script>
                </div>
            
                <div class="col-md-4 d-flex justify-items-start align-items-center gap-2" >
                    <button type="submit" class="btn mr-4 btn-primary" id="filter">
                        Filter
                    </button>
                
                    <a href="{% url 'Issue_view' %}" class="btn btn-danger" id="Clear">
                        Clear
                    </a>
                </div>
            </form>  
        </div>

        <table id="employeeTable" class="table table-striped table-bordered datatable dataTable no-footer">
            <thead>
                <tr>
                    <th>Sr#</th>
                    <th>Code</th>
                    
                    <th>Name</th>
                    <th>Department</th>
                    <th>HOD</th>
                    <th>HK</th> 
                    <th>IT</th>
                    <th>HR</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                {% for al in merged_qs %}
                <tr>
                    <td>{{ forloop.counter }}</td>

                    <td>{{ al.emp_code }}</td>

                    <td>{{ al.first_name }}</td>

                    <td>{{ al.department }}</td>


                    <td>
                        {% if al.DEPT %}
                            <span class="btn btn-sm btn-secondary">Approved</span>
                            <!-- <span class="badge bg-success p-2">Approved</span> -->
                        {% else %}
                            {% if request.session.Department_Name == al.department and request.session.UserType|lower == "hod" %}
                                <a href="{% url 'Hod_Approve_Request' %}?id={{ al.id }}" 
                                    class="btn btn-sm btn-primary">
                                    Approve
                                </a>
                            {% else %}
                                <span class="btn btn-sm btn-secondary">Waiting for HOD</span>
                             {% endif %}
                            {% comment %} <a href="{% url 'Hod_Approve_Request' %}?id={{ al.id }}" 
                                class="btn btn-sm btn-primary">
                                Approve
                            </a> {% endcomment %}
                            {% comment %} <a class="btn btn-sm btn-secondary disabled text-white">
                                On Hold
                            </a> {% endcomment %}
                        {% endif %}
                    </td>

                    <td>
                        {% if not al.DEPT %}
                            <button class="btn btn-sm btn-secondary" disabled>Waiting for HOD</button>
                        {% else %}
                            {% if al.HK %}
                                <a href="{% url 'HouseKeepingRequest' %}?EC={{ al.emp_code }}&OID={{ al.OrganizationID }}&ID={{al.uniform_info_id}}&Hide=True" 
                                class="btn btn-sm btn-Secondary text-white" >
                                    Issued 
                                </a>

                                <a 
                                    {% if request.session.UserID|stringformat:"s" != al.HKCreatedBy|stringformat:"s" %}href="#" class="btn btn-sm btn-secondary disabled text-white" tabindex="-1" aria-disabled="true"{% else %}
                                    href="{% url 'HouseKeepingRequest' %}?EC={{ al.emp_code }}&OID={{ al.OrganizationID }}&ID={{al.uniform_info_id}}" 
                                    class="btn btn-sm btn-secondary text-white"
                                    
                                    {% endif %}
                                    >
                                    Edit  
                                </a>
                            {% else %}
                                <a href="{% url 'HouseKeepingRequest' %}?EC={{ al.emp_code }}&OID={{ al.OrganizationID }}" 
                                    class="btn btn-sm btn-primary" >
                                    Issue 
                                </a>
                            {% endif %}
                        {% endif %}
                    </td>
                    <td>
                        {% if not al.DEPT %}
                            <button class="btn btn-sm btn-secondary" disabled>Waiting for HOD</button>
                        {% else %}
                            {% if al.IT %}
                                <a href="{% url 'ITRequest' %}?EC={{ al.emp_code }}&OID={{ al.OrganizationID }}&ID={{al.it_info_id}}&Hide=True" 
                                    class="btn btn-sm btn-Secondary text-white" >
                                    Issued
                                </a>

                                <a 
                                    {% if request.session.UserID|stringformat:"s" != al.ITCreatedBy|stringformat:"s" %}href="#" class="btn btn-sm btn-secondary disabled text-white" tabindex="-1" aria-disabled="true"{% else %}
                                    href="{% url 'ITRequest' %}?EC={{ al.emp_code }}&OID={{ al.OrganizationID }}&ID={{al.it_info_id}}"
                                    class="btn btn-sm btn-secondary text-white"
                                    
                                    {% endif %}
                                    >
                                    Edit  
                                </a>
                            {% else %}
                                <a href="{% url 'ITRequest' %}?EC={{ al.emp_code }}&OID={{ al.OrganizationID }}" 
                                    class="btn btn-sm btn-primary" >
                                    Issue 
                                </a>
                            {% endif %}
                        {% endif %}
                    </td>

                    <td>
                        {% if not al.DEPT %}
                            <button class="btn btn-sm btn-secondary" disabled>Waiting for HOD</button>
                        {% else %}
                            {% if al.HR %}
                                <a href="{% url 'HR_Inventory_Request' %}?EC={{ al.emp_code }}&OID={{ al.OrganizationID }}&ID={{al.hr_info_id}}&Hide=True" 
                                    class="btn btn-sm btn-Secondary text-white" >
                                    Issued
                                </a>
                                <a 
                                    {% if request.session.UserID|stringformat:"s" != al.HRCreatedBy|stringformat:"s" %}href="#" class="btn btn-sm btn-secondary disabled text-white" tabindex="-1" aria-disabled="true"{% else %}
                                    href="{% url 'HR_Inventory_Request' %}?EC={{ al.emp_code }}&OID={{ al.OrganizationID }}&ID={{al.hr_info_id}}" 
                                    class="btn btn-sm btn-secondary text-white"
                                    
                                    {% endif %}
                                    >
                                    Edit  
                                </a>
                            {% else %}
                                <a href="{% url 'HR_Inventory_Request' %}?EC={{ al.emp_code }}&OID={{ al.OrganizationID }}" 
                                    class="btn btn-sm btn-primary" >
                                    Issue
                                </a>
                            {% endif %}
                        {% endif %}
                    </td>

                    {% comment %} Hod Apporval {% endcomment %}
                </tr>
                {% endfor %}

            </tbody>
        </table>
    </div>
</div>
  


{% endblock content %}

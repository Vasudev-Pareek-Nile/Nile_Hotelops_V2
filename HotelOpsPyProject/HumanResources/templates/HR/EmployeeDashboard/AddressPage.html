{% extends "HR/EmployeeDashboard/EditEmployee.html" %}
 {% load static %} 
{% block content %}
<link href="{% static 'css/plugins/sweetalert/sweetalert.css' %}" rel="stylesheet">

<style>
    
    #ProfileImagePreview {
        border-radius: 50%;
        border: 2px solid #ddd;     
        margin-top: 10px;
        max-width: 150px; 
        height: 150px;    
        object-fit: cover; 
    } .strike{
        color: red;
    }

    .card {
        border-radius: 5px;
        border: 1px solid #0000004f;
    }
    
    .card-header{
        margin-bottom: -20px !important;
    }
</style>

<form id="AddressInfoForm" method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
        <span class=" text-uppercase fw-bold"> Address Information </span>

            <button type="button" id="editButton" class="btn btn-primary btn-sm float-right">Edit</button>
        </div>
        
        <div class="main">
            <div class="card-header">
                <h4>Permanent Address</h4>
            </div>
            <div class="row m-1">
                <div class="col-md-3 mt-2">
                    <div class="form-group">
                        <label>Address <span class="strike">*</span></label>
                        <textarea id="Permanent_Address" rows="4" name="Permanent_Address" class="form-control" required>{{Addressinfo.Permanent_Address}}</textarea>
                    </div>
                </div>

                <div class="col-md-9">
                    <div class="row">
                        <div class="col-md-4 mt-2">
                            <div class="form-group">
                                <label>Pincode <span class="strike">*</span></label>
                                <input type="text" id="Permanent_Pincode" name="Permanent_Pincode" class="form-control" value="{{Addressinfo.Permanent_Pincode}}" required>
                            </div>
                        </div>
                        <div class="col-md-4 mt-2">
                            <div class="form-group">
                                <label>City <span class="strike">*</span></label>
                                <input type="text" id="Permanent_City" name="Permanent_City" class="form-control" value="{{Addressinfo.Permanent_City}}" required>
                            </div>
                        </div>
                        <div class="col-md-4 mt-2">
                            <div class="form-group">
                                <label>State <span class="strike">*</span></label>
                                <input type="text" id="Permanent_State" name="Permanent_State" class="form-control" value="{{Addressinfo.Permanent_State}}" required>
                            </div>
                        </div>
                    </div>
            
                <div class="row">
                    <div class="col-md-6 mt-3">
                        <label>House Phone Number <span class="strike">*</span></label>
                        <input type="text" id="Permanent_HousePhoneNumber" name="Permanent_HousePhoneNumber" class="form-control" value="{{Addressinfo.Permanent_HousePhoneNumber}}" required>
                        <span id="Permanent_HousePhoneNumberError" style="color:red;"></span>
                    </div>
            
                    <div class="col-md-6 mt-3 mb-2">
                        <label>Landline Number</label>
                        <input type="text" id="Permanent_LandlineNumber" name="Permanent_LandlineNumber" class="form-control" value="{{Addressinfo.Permanent_Landline}}" >
                        <span id="Permanent_LandlineNumberError" style="color:red;"></span>
                    </div>

                </div>
            </div>
            <div class="mt-3 mb-2">
                <input type="checkbox" id="copyAddressCheckbox" onclick="copyAddress()"> 
                <label for="copyAddressCheckbox">Copy Permanent Address to Temporary Address</label>
            </div>
        </div>
    </div>
    </div>
    
        <!-- Checkbox to copy data -->
    <div class="card">
        <div class="main">

            <div class="card-header">
                <h4>Temporary Address</h4>
            </div>

            <div class="row m-1">
                <!-- Address spanning two rows -->
                <div class="col-md-3 mt-2">
                    <label>Address <span class="strike">*</span></label>
                    <textarea class="form-control"  id="Temporary_Address" name="Temporary_Address" rows="4">{{Addressinfo.Temporary_Address}}</textarea>
                </div>

                <!-- Right side - top row -->
                <div class="col-md-9">
                    <div class="row">

                        <div class="col-md-4 mt-2">
                            <label>Pincode *</label>
                            <input type="text" id="Temporary_Pincode" name="Temporary_Pincode" class="form-control" value="{{Addressinfo.Temporary_Pincode}}">
                        </div>

                        <div class="col-md-4 mt-2">
                            <label>City *</label>
                            <input type="text" class="form-control" id="Temporary_City" name="Temporary_City" value="{{Addressinfo.Temporary_City}}">
                        </div>

                        <div class="col-md-4 mt-2">
                            <label>State *</label>
                            <input type="text" class="form-control" id="Temporary_State" name="Temporary_State" value="{{Addressinfo.Temporary_State}}">
                        </div>

                    </div>

                    <!-- Right side - bottom row -->
                    <div class="row">

                        <div class="col-md-6 mt-3">
                            <label>House Phone Number *</label>
                            <input type="text" class="form-control" id="Temporary_HousePhoneNumber" name="Temporary_HousePhoneNumber" value="{{Addressinfo.Temporary_HousePhoneNumber}}">
                        </div>

                        <div class="col-md-6 mt-3">
                            <label>Landline Number</label>
                            <input type="text" class="form-control" id="Temporary_LandlineNumber" name="Temporary_LandlineNumber" value="{{Addressinfo.Permanent_Landline}}">
                        </div>

                    </div>
                </div>

            </div>

        </div>
            <div class="CustomFooter m-3">
                <button type="submit" id="saveButton" class="btn btn-primary Successpopup" style="display: none;">Save</button>
            </div>
    </div>
</form>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        const editButton = document.getElementById('editButton');
        const saveButton = document.getElementById('saveButton');
        const inputs = document.querySelectorAll('#AddressInfoForm input, #AddressInfoForm select, #AddressInfoForm textarea');
        
        function toggleInputs(disabled) {
            inputs.forEach(input => {
                if (disabled) {
                    input.setAttribute('readonly', 'readonly');
                    input.setAttribute('disabled', 'disabled');
                } else {
                    input.removeAttribute('readonly');
                    input.removeAttribute('disabled');
                }
            });
        }
    
        editButton.addEventListener('click', function() {
            if (editButton.textContent.trim() === 'Edit') {
                editButton.textContent = 'Cancel';
                saveButton.style.display = 'inline-block';
                toggleInputs(false);
            } else {
                editButton.textContent = 'Edit';
                saveButton.style.display = 'none';
                toggleInputs(true);
            }
        });
    
       
        toggleInputs(true);
    });
    
</script>

<script>
    $(document).ready(function () {
        const urlParams = new URLSearchParams(window.location.search);
        const success = urlParams.get('Success');
        
        if (success === 'True') {
            showSuccess();
            removeSuccessParam();
        }
        if (success === 'Deleted') {
            showDelete();
            removeSuccessParam();
        }
        if (success === 'Uploaded') {
            showUploaded();
            removeSuccessParam();
        }

        function removeSuccessParam() {
            urlParams.delete('Success'); 
            const newUrl = window.location.pathname + '?' + urlParams.toString();
            window.history.replaceState(null, '', newUrl);
        }
    });
</script>


<script>

    document.getElementById('Temporary_HousePhoneNumber').addEventListener('input', function () {
        const mobile = this.value;
        const regex = /^[6-9]\d{9}$/;
        const mobileError = document.getElementById('Temporary_HousePhoneNumberError');

        if (!regex.test(mobile)) {
            mobileError.textContent = "Invalid mobile number";
        } else {
            mobileError.textContent = "";
        }
    });

    document.getElementById('Permanent_HousePhoneNumber').addEventListener('input', function () {
        const mobile = this.value;
        const regex = /^[6-9]\d{9}$/;
        const mobileError = document.getElementById('Permanent_HousePhoneNumberError');

        if (!regex.test(mobile)) {
            mobileError.textContent = "Invalid mobile number";
        } else {
            mobileError.textContent = "";
        }
    });


    function copyAddress() {
        if (document.getElementById('copyAddressCheckbox').checked) {
            document.getElementById('Temporary_Address').value = document.getElementById('Permanent_Address').value;
            document.getElementById('Temporary_Pincode').value = document.getElementById('Permanent_Pincode').value;
            document.getElementById('Temporary_City').value = document.getElementById('Permanent_City').value;
            document.getElementById('Temporary_State').value = document.getElementById('Permanent_State').value;
            document.getElementById('Temporary_HousePhoneNumber').value = document.getElementById('Permanent_HousePhoneNumber').value;
            document.getElementById('Temporary_LandlineNumber').value = document.getElementById('Permanent_LandlineNumber').value;

        } else {
            document.getElementById('Temporary_Address').value = '';
            document.getElementById('Temporary_Pincode').value = '';
            document.getElementById('Temporary_City').value = '';
            document.getElementById('Temporary_State').value = '';
            document.getElementById('Temporary_HousePhoneNumber').value = '';
            document.getElementById('Temporary_LandlineNumber').value = '';

        }
    }
    
    $(document).ready(function() {
        $('#Permanent_Pincode').on('keyup', function() {
            updateAddressFields('Permanent_Pincode', 'Permanent');
        });

        $('#Temporary_Pincode').on('keyup', function() {
            updateAddressFields('Temporary_Pincode', 'Temporary');
        });

        function updateAddressFields(pincodeInputId, addressType) {
            const pincode = $(`#${pincodeInputId}`).val();

            if (pincode.length >= 6) {  
                $.ajax({
                    url: '/InterviewAssessment/get_location/',
                    type: 'GET',
                    data: {
                        pincode: pincode
                    },
                    success: function(data) {
                        if (data.error) {
                            alert(data.error);
                        } else {
                            $(`#${addressType}_City`).val(data.city);
                            $(`#${addressType}_State`).val(data.state);
                            
                        }
                    },
                    error: function(xhr, status, error) {
                        console.error('Error:', error);
                    }
                });
            }
        }
    });
</script>

{% endblock content %}






{% extends "HR/EmployeeDashboard/EditEmployee.html" %}
 {% load static %} 
{% block content %}
<link href="{% static 'css/plugins/sweetalert/sweetalert.css' %}" rel="stylesheet">

<style>
    
    #ProfileImagePreview {
        border-radius: 50%;
        border: 2px solid #ddd;     
        margin-top: 10px;
        max-width: 150px; 
        height: 150px;    
        object-fit: cover; 
    }
    .strike{
        color: red;
    }

    label{
        padding-top: 14px;
    }

    .card {
        border-radius: 5px;
        border: 1px solid #0000004f;
    }
    
    .card-header{
        margin-bottom: -20px !important;
    }

</style>

<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <span class="text-uppercase fw-bold">Emergency Information</span>
        <button id="editButton" class="btn btn-primary btn-sm float-right">Edit</button>
    </div>
    <form id="EmergencyInfoForm" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="main">
            <div class="row m-1">
                <div class="col-md-3">
                    <div class="form-group">
                        <label>First Name <span class="strike">*</span></label>
                        <input id="EmergencyFirstName" name="EmergencyFirstName" type="text" class="form-control" value="{{Emergencyobj.FirstName}}"  required>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label>Middle Name</label>
                        <input id="EmergencyMiddleName" name="EmergencyMiddleName" type="text" class="form-control" value="{{Emergencyobj.MiddleName}}" >
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label>Last Name <span class="strike">*</span></label>
                        <input id="EmergencyLastName" name="EmergencyLastName" type="text" class="form-control" value="{{Emergencyobj.LastName}}" required>
                    </div>
                </div>
                <div class="col-md-2">
                    <div class="form-group">
                        <label>Relation <span class="strike">*</span></label>
                  
                        <select class="form-control" id="Relation" name="Relation" required>
                            <option value="" {% if Emergencyobj.Relation == "" %}selected {% endif %}>Select</option>
                            <option value="Mother" {% if Emergencyobj.Relation == "Mother" %} selected {% endif %} >Mother</option>
                            <option value="Father" {% if Emergencyobj.Relation == "Father" %}selected {% endif %}  >Father</option>
                            <option value="Sibling" {% if Emergencyobj.Relation == "Sibling" %} selected {% endif %} >Sibling</option>
                            <option value="Spouse" {% if Emergencyobj.Relation == "Spouse" %} selected {% endif %} >Spouse</option>
                            <option value="Friend" {% if Emergencyobj.Relation == "Friend" %}selected {% endif %}  >Friend</option>
                            <option value="Relative" {% if Emergencyobj.Relation == "Relative" %}selected {% endif %}  >Relative</option>
                            <option value="Other" {% if Emergencyobj.Relation == "Other" %} selected {% endif %} >Other</option>
                          </select>
                    </div>
                </div>

                <div class="col-md-1">
                    <div class="form-group">
                        <label>Blood<span class="strike">*</span></label>
                        <select name="BloodGroup" id="BloodGroup" class="form-control" required>
                            <option value="" >Select</option>
                            <option value="O+" {% if Emergencyobj.BloodGroup == "O+" %}selected{% endif %}>O+</option>
                            <option value="O-" {% if Emergencyobj.BloodGroup == "O-" %}selected{% endif %}>O-</option>
                            <option value="A+" {% if Emergencyobj.BloodGroup == "A+" %}selected{% endif %}>A+</option>
                            <option value="A-" {% if Emergencyobj.BloodGroup == "A-" %}selected{% endif %}>A-</option>
                            <option value="B+" {% if Emergencyobj.BloodGroup == "B+" %}selected{% endif %}>B+</option>
                            <option value="B-" {% if Emergencyobj.BloodGroup == "B-" %}selected{% endif %}>B-</option>
                            <option value="AB+" {% if Emergencyobj.BloodGroup == "AB+" %}selected{% endif %}>AB+</option>
                            <option value="AB-" {% if Emergencyobj.BloodGroup == "AB-" %}selected{% endif %}>AB-</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label> Emergency Contact Number Primary<span class="strike">*</span></label>
                        <input id="EmergencyContactNumber_1" name="EmergencyContactNumber_1" type="text" class="form-control" value="{{Emergencyobj.EmergencyContactNumber_1}}" required>
                        <span id="EmergencyContactNumber_1Error" style="color:red;"></span>
    
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label> Emergency Contact Number Secondary<span class="strike">*</span></label>
                        <input id="EmergencyContactNumber_2" name="EmergencyContactNumber_2" type="text" class="form-control" value="{{Emergencyobj.EmergencyContactNumber_2}}" required>
                        <span id="EmergencyContactNumber_2Error" style="color:red;"></span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label> Provident Fund Number<span class="strike">*</span></label>
                        <input id="ProvidentFundNumber" name="ProvidentFundNumber" type="text" class="form-control" value="{{Emergencyobj.ProvidentFundNumber}}" required>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="form-group">
                        <label> ESI Number</label>
                        <input id="ESINumber" name="ESINumber" type="text" class="form-control" value="{{Emergencyobj.ESINumber}}" >
                    </div>
                </div>
            </div>
        </div>
        <div class="CustomFooter m-3">
            <button type="submit" id="saveButton" class="btn btn-primary Successpopup" style="display: none;">Save</button>
        </div>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const editButton = document.getElementById('editButton');
        const saveButton = document.getElementById('saveButton');
        const inputs = document.querySelectorAll('#EmergencyInfoForm input, #EmergencyInfoForm select, #EmergencyInfoForm textarea');
        
        function toggleInputs(disabled) {
            inputs.forEach(input => {
                if (disabled) {
                    input.setAttribute('readonly', 'readonly');
                    input.setAttribute('disabled', 'disabled');
                } else {
                    input.removeAttribute('readonly');
                    input.removeAttribute('disabled');
                }
            });
        }
    
        editButton.addEventListener('click', function() {
            if (editButton.textContent.trim() === 'Edit') {
                editButton.textContent = 'Cancel';
                saveButton.style.display = 'inline-block';
                toggleInputs(false);
            } else {
                editButton.textContent = 'Edit';
                saveButton.style.display = 'none';
                toggleInputs(true);
            }
        });
    
       
        toggleInputs(true);
    });
    
</script>

<script>
    $(document).ready(function () {
        const urlParams = new URLSearchParams(window.location.search);
        const success = urlParams.get('Success');
        
        if (success === 'True') {
            showSuccess();
            removeSuccessParam();
        }
        if (success === 'Deleted') {
            showDelete();
            removeSuccessParam();
        }
        if (success === 'Uploaded') {
            showUploaded();
            removeSuccessParam();
        }

        function removeSuccessParam() {
            urlParams.delete('Success'); 
            const newUrl = window.location.pathname + '?' + urlParams.toString();
            window.history.replaceState(null, '', newUrl);
        }
    });
</script>

<script>
    document.getElementById('EmergencyContactNumber_1').addEventListener('input', function () {
       const mobile = this.value;
       const regex = /^[6-9]\d{9}$/;
       const mobileError = document.getElementById('EmergencyContactNumber_1Error');

       if (!regex.test(mobile)) {
           mobileError.textContent = "Invalid mobile number";
       } else {
           mobileError.textContent = "";
       }
   });
   document.getElementById('EmergencyContactNumber_2').addEventListener('input', function () {
       const mobile = this.value;
       const regex = /^[6-9]\d{9}$/;
       const mobileError = document.getElementById('EmergencyContactNumber_2Error');

       if (!regex.test(mobile)) {
           mobileError.textContent = "Invalid mobile number";
       } else {
           mobileError.textContent = "";
       }
   });
</script>
{% endblock content %}






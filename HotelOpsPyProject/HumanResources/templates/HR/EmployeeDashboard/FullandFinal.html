{% extends "HR/EmployeeDashboard/EditEmployee.html" %}
 {% load static %} 
{% block content %}
<link href="{% static 'css/plugins/sweetalert/sweetalert.css' %}" rel="stylesheet">
<style>
    .modal#statusSuccessModal .modal-content, 
    .modal#statusErrorsModal .modal-content {
        border-radius: 30px;
    }
    .modal#statusSuccessModal .modal-content svg, 
    .modal#statusErrorsModal .modal-content svg {
        width: 100px; 
        display: block; 
        margin: 0 auto;
    }
    .modal#statusSuccessModal .modal-content .path, 
    .modal#statusErrorsModal .modal-content .path {
        stroke-dasharray: 1000; 
        stroke-dashoffset: 0;
    }
    .modal#statusSuccessModal .modal-content .path.circle, 
    .modal#statusErrorsModal .modal-content .path.circle {
        -webkit-animation: dash 0.9s ease-in-out; 
        animation: dash 0.9s ease-in-out;
    }
    .modal#statusSuccessModal .modal-content .path.line, 
    .modal#statusErrorsModal .modal-content .path.line {
        stroke-dashoffset: 1000; 
        -webkit-animation: dash 0.95s 0.35s ease-in-out forwards; 
        animation: dash 0.95s 0.35s ease-in-out forwards;
    }
    .modal#statusSuccessModal .modal-content .path.check, 
    .modal#statusErrorsModal .modal-content .path.check {
        stroke-dashoffset: -100; 
        -webkit-animation: dash-check 0.95s 0.35s ease-in-out forwards; 
        animation: dash-check 0.95s 0.35s ease-in-out forwards;
    }

    @-webkit-keyframes dash { 
        0% {
            stroke-dashoffset: 1000;
        }
        100% {
            stroke-dashoffset: 0;
        }
    }
    @keyframes dash { 
        0% {
            stroke-dashoffset: 1000;
        }
        100%{
            stroke-dashoffset: 0;
        }
    }
    @-webkit-keyframes dash { 
        0% {
            stroke-dashoffset: 1000;
        }
        100% {
            stroke-dashoffset: 0;
        }
    }
    @keyframes dash { 
        0% {
            stroke-dashoffset: 1000;}
        100% {
            stroke-dashoffset: 0;
        }
    }
    @-webkit-keyframes dash-check { 
        0% {
            stroke-dashoffset: -100;
        }
        100% {
            stroke-dashoffset: 900;
        }
    }
    @keyframes dash-check {
        0% {
            stroke-dashoffset: -100;
        }
        100% {
            stroke-dashoffset: 900;
        }
    }
    .box00{
        width: 100px;
        height: 100px;
        border-radius: 50%;
    }
</style>
<style>
    #ProfileImagePreview {
        border-radius: 50%;
        border: 2px solid #ddd;     
        margin-top: 10px;
        max-width: 150px; 
        height: 150px;    
        object-fit: cover; 
    }

    .card {
        border-radius: 5px;
        border: 1px solid #0000004f;
    }

    .card-header{
        margin-bottom: -20px !important;
    }

    .card .card-body {
        padding: 18px !important;
    }
</style>


<div class="card">
    <div class="card-header">
      <span class=" text-uppercase fw-bold">   Full and Final Settlement </span> 
        {% if not FIN %}
        <a href="{% url 'FullandFinalEntry' %}?EC={{EC}}&EmpID={{EmpID}}&OID={{OrganizationID}}" class="btn btn-sm btn-primary" style="float:right">New Full and Final</a>
        {% endif %}        
    
    
        </div>
        <div class="card-body">
            <table class="table table-bordered table-condensed display table-sm compact" style="font-size:11px">
                <thead>
                    <tr style="background-color: #bbbbbb;">
                        <th class="EmpCode">Emp Code</th>
                        <th class="Name">Name</th>
                        <th class="Department">Desi / Dept</th>
                        {% comment %} <th class="HRHODIT">Notice Days Served</th> {% endcomment %}
                        <th class="HRHODIT">Resignation</th>
                        <th class="HRHODIT">Deduction from salary PL</th>
                        {% comment %} <th class="HRHODIT">Current Salary</th> {% endcomment %}
                        {% comment %} <th class="HRHODIT">Laid Off</th> {% endcomment %}
                        <th class="Action">Action</th>
                    </tr>
                </thead>
                <tbody>
                    {% for i in FIN %}
                    <tr>
                        <td class="EmpCode">{{i.Emp_Code}}</td>
                        <td class="Name">{{i.Name}}</td>
                        <td class="Department">{{i.Designation}} <br/>{{i.Dept}}</td>
                        <td class="HRHODIT">{{i.Resignation}}</td>
                        <td class="HRHODIT">{{i.Deduction_from_salary_PL|default:""}}</td>
                        {% comment %} <td class="HRHODIT">{{i.Current_Salary}}</td> {% endcomment %}
                        {% comment %} <td class="HRHODIT">{{i.Laid_Off}}</td> {% endcomment %}
                        <td class="Action">
                            <div class="btn-group gap-2">
                                <a href="{% url 'FullandFinalEntry' %}?EC={{EC}}&EmpID={{EmpID}}&FID={{i.id}}&OID={{OrganizationID}}" class="btn btn-primary btn-sm">Edit</a>
                                {% comment %} <a href="{% url 'FullandFinalDelete' %}?EC={{EC}}&EmpID={{EmpID}}&FID={{i.id}}&OID={{OrganizationID}}" onclick="javascript:return confirm('Do you want to delete?')" class="btn btn-danger btn-sm">Delete</a> {% endcomment %}
                                <a href="{% url 'FullandFinalPdfView' %}?EC={{EC}}&EmpID={{EmpID}}&FID={{i.id}}&OID={{OrganizationID}}" class="btn btn-secondary text-white btn-sm" target="_blank">View</a>
                            </div>
                        </td> 
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>  
    
<!-- Modals For Success and Error -->
<div class="container  p-5">
	<div class="row">
		<div class="modal fade" id="statusErrorsModal" tabindex="-1" role="dialog" data-bs-backdrop="static" data-bs-keyboard="false"> 
			<div class="modal-dialog modal-dialog-centered modal-sm" role="document"> 
				<div class="modal-content"> 
					<div class="modal-body text-center p-lg-4"> 
						<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 130.2 130.2">
							<circle class="path circle" fill="none" stroke="#3a4a93" stroke-width="6" stroke-miterlimit="10" cx="65.1" cy="65.1" r="62.1" /> 
							<line class="path line" fill="none" stroke="#3a4a93" stroke-width="6" stroke-linecap="round" stroke-miterlimit="10" x1="34.4" y1="37.9" x2="95.8" y2="92.3" />
							<line class="path line" fill="none" stroke="#3a4a93" stroke-width="6" stroke-linecap="round" stroke-miterlimit="10" x1="95.8" y1="38" x2="34.4" y2="92.2" /> 
						</svg> 
						<h4 class="text-danger mt-3">Error !!</h4> 
						{% comment %} <p class="mt-3" id="errorMessageText">Something went wrong while submitting the form.</p> {% endcomment %}
                        <p class="mt-3" id="errorMessageText">
                            {{ error_message|default:"Something went wrong while submitting the form." }}
                        </p>
						<button type="button" class="btn btn-sm mt-3 btn-danger" data-bs-dismiss="modal">Ok</button> 
					</div> 
				</div> 
			</div> 
		</div>

		<div class="modal fade" id="statusSuccessModal" tabindex="-1" role="dialog" data-bs-backdrop="static" data-bs-keyboard="false"> 
			<div class="modal-dialog modal-dialog-centered modal-sm" role="document"> 
				<div class="modal-content"> 
					<div class="modal-body text-center p-lg-4"> 
						<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 130.2 130.2">
							<circle class="path circle" fill="none" stroke="{% if 'deleted' in success_message|lower %}#ff0000{% else %}#3a4a93{% endif %}" stroke-width="6" stroke-miterlimit="10" cx="65.1" cy="65.1" r="62.1" />
							<polyline class="path check" fill="none" stroke="{% if 'deleted' in success_message|lower %}#ff0000{% else %}#3a4a93{% endif %}" stroke-width="6" stroke-linecap="round" stroke-miterlimit="10" points="100.2,40.2 51.5,88.8 29.8,67.5 " /> 
						</svg> 
						<h4 class="mt-3" style="color:{% if 'deleted' in success_message|lower %}#ff0000{% else %}#3a4a93{% endif %}">Congrats!</h4> 
						{% comment %} <p class="mt-3" id="successMessageText">Travel Details submitted successfully.</p> {% endcomment %}
                        <p class="mt-3 {% if 'deleted' in success_message|lower %}text-danger{% endif %}" id="successMessageText">
                            {{ success_message|default:"Details submitted successfully." }}
                        </p>
						<button type="button" class="btn btn-sm mt-3 {% if 'deleted' in success_message|lower %}btn-danger{% else %}btn-primary{% endif %}" data-bs-dismiss="modal">Ok</button> 
					</div> 
				</div> 
			</div> 
		</div>
	</div>
</div>

   
<script>
    $(document).ready(function () {
        const urlParams = new URLSearchParams(window.location.search);
        const success = urlParams.get('Success');
        
        if (success === 'True') {
            showSuccess();
            removeSuccessParam();
        }
        if (success === 'Deleted') {
            showDelete();
            removeSuccessParam();
        }
        if (success === 'Uploaded') {
            showUploaded();
            removeSuccessParam();
        }

        function removeSuccessParam() {
            urlParams.delete('Success'); 
            const newUrl = window.location.pathname + '?' + urlParams.toString();
            window.history.replaceState(null, '', newUrl);
        }
    });
</script>


{% comment %} Modal Show {% endcomment %}
<script>
    window.addEventListener("load", function () {
        const urlParams = new URLSearchParams(window.location.search);
        const isSuccess = urlParams.get("Success"); // Note: 'Success' is capitalized in your URL
        const message = urlParams.get("message");
        const action = urlParams.get("action");

        if (isSuccess && ['true', '1', 'yes'].includes(isSuccess.toLowerCase())) {
            const successModalElement = document.getElementById("statusSuccessModal");
            const successText = document.getElementById("successMessageText");

            if (successModalElement) {
                if (successText && message) {
                    successText.textContent = decodeURIComponent(message);

                    // Optional style adjustment
                    // if (action === 'edit') {
                    //     successText.classList.add('text-primary');
                    // } else if (action === 'submit') {
                    //     successText.classList.add('text-success');
                    // }
                }

                const successModal = new bootstrap.Modal(successModalElement);
                successModal.show();
            }

            // âœ… Remove only specific params from URL
            urlParams.delete("Success");
            urlParams.delete("success");  // optional, covers both cases
            urlParams.delete("message");
            urlParams.delete("action");
    
            const newQuery = urlParams.toString();
            const newUrl = window.location.pathname + (newQuery ? "?" + newQuery : "");
            window.history.replaceState({}, document.title, newUrl);
        }
    });
</script>





{% endblock content %}






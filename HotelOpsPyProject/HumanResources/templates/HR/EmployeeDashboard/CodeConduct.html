{% extends "HR/EmployeeDashboard/EditEmployee.html" %}
{% load encryption_filters %}
 {% load static %} 
{% block content %}
<link href="{% static 'css/plugins/sweetalert/sweetalert.css' %}" rel="stylesheet">

<style>
    
    #ProfileImagePreview {
        border-radius: 50%;
        border: 2px solid #ddd;     
        margin-top: 10px;
        max-width: 150px; 
        height: 150px;    
        object-fit: cover; 
    }

.Name
{
    width: 200px;
}

.Date
{
    width: 140px;
}

.Designation
{
    width: 150px;
}

.Department
{
    width: 150px;
}
.EmpCode
{
    width: 80px;
}
.Signed
{
    width: 250px;
}
.Action 
{
    width : 200px
}

.card {
    border-radius: 5px;
    border: 1px solid #0000004f;
}

.card-header{
    margin-bottom: -20px !important;
}
</style>




     <!-- Letter of Appointment -->
    
    <div class="card card-primary">
        <div class="card-header ">
           <span class=" text-uppercase fw-bold">Code Of Conduct</span> 
            {% comment %} <a href="{% url 'Checklistadd' %}?EC={{EC}}&EmpID={{EmpID}}" class="btn btn-sm btn-primary" style="float:right">New Checklist From  </a> {% endcomment %}
            
            <a href="{% url 'Employee_Details_Cover_Page_View' %}?EmpID={{EmpID}}&OID={{OrganizationID}}" class="btn btn-secondary btn-sm text-white text-right" style="float:right; margin-right: 10px;">Cover Page</a>
            {% if codeconductsadd == 'Show'  %}
                <a href="#" class="btn btn-primary btn-sm text-white text-right" data-bs-toggle="modal" data-bs-target="#addEmpModal" style="float:right; margin-right: 10px;">Add New Emp</a>
            {% endif %}
            {% for doc in docs %}
                <a href="{% url 'download_sample_file' doc.id %}" class="btn btn-secondary btn-sm text-white text-right" style="float:right; margin-right: 10px;">Download Sample DOC</a>
                <a href="{% url 'download_sample_pdf_file' doc.id %}" class="btn btn-secondary btn-sm text-white text-right" style="float:right; margin-right: 10px;">Download Sample PDF</a>
            {% endfor %}
            
        </div>
        <div class="m-3">
                <table class="table table-bordered table-condensed  display table-sm compact" style="font-size:11px">
                     <thead>
            <tr>
                <th>Emp Code</th>
                <th>Code of Conduct Date</th>
                <th>Employee File</th>                
            </tr>
        </thead>
        <tbody>
            {% for conduct in codeconducts %}
            <tr>
                <td>{{ conduct.Empcode }}</td>
                <td>{{ conduct.Conductdate }}</td>
                <td>
                    <a href="{% url 'download_codeconduct_file' conduct.id %}" class="btn btn-sm btn-primary">Download</a>
                </td>
            </tr>
            {% endfor %}
    
        </tbody>
                </table>
        </div>
    </div>
    
    
   
    <!-- Modal -->
<div class="modal fade" id="addEmpModal" tabindex="-1" aria-labelledby="addEmpModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addEmpModalLabel">Add New Employee</h5>
            </div>
            <div class="modal-body">
               
                <form id="addEmpForm" method="POST" enctype="multipart/form-data" action="{% url 'submit_emp_code_of_conduct' %}?EC={{EC}}&EmpID={{EmpID}}&OID={{OrganizationID}}">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="conductDate" class="form-label">Code of Conduct Date</label>
                        <input type="date" class="form-control" id="conductDate" name="Conductdate" required>
                    </div>
                    <div class="mb-3">
                        <label for="empFile" class="form-label">Employee File</label>
                        <input type="file" class="form-control" id="empFile" name="FileName" required>
                    </div>
                     <input type="hidden" id="Empcode" name="Empcode" value="">
                </form>
            </div>
            <div class="CustomFooter m-3 mt-0 d-flex gap-2  align-items-end justify-content-end">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="submit" class="btn btn-primary" form="addEmpForm">Submit</button>
            </div>
        </div>
    </div>
  </div>
  <!-- Your Bootstrap Modal -->
  <div class="modal fade" id="editConductModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editModalLabel">Edit Code of Conduct</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="editConductForm" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
            <input type="hidden" id="emp-id" name="id">
  
            <div class="mb-3">
              <label for="empcode" class="form-label">Employee Code</label>
              <input type="text" class="form-control" id="empcode" name="Empcode" readonly>
            </div>
  
            <div class="mb-3">
              <label for="FileName" class="form-label">Upload Document</label>
              <input type="file" class="form-control" id="FileName" name="FileName">
            </div>
  
            <div class="mb-3">
              <label for="conductdate" class="form-label">Conduct Date</label>
              <input type="date" class="form-control" id="conductdate" name="Conductdate">
            </div>
  
            <button type="submit" class="btn btn-primary">Save changes</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    $(document).ready(function() {
        $('.edit-btn').on('click', function() {
            var empId = $(this).data('id');  // Get the employee ID from the data attribute
            
            // Make the AJAX request to fetch employee data
            $.ajax({
                url: '{% url "submit_emp_code_of_conduct" %}?EC={{EC}}&EmpID={{EmpID}}',  
                data: {
                    'id': empId,  
                },
                dataType: 'json',
                success: function(data) {
                    // Populate the form with the fetched data
                    $('#emp-id').val(data.id);
                    $('#empcode').val(data.Empcode);
                    $('#conductdate').val(data.Conductdate);
                    
                    if (data.FileName) {
                        $('#FileName').val('');  // Clear the existing file input (if needed)
                    }
    
                    // Show the modal for editing
                    $('#editConductModal').modal('show');
                }
            });
        });
    
        // Handle the form submission
        $('#editConductForm').on('submit', function(event) {
            event.preventDefault();  // Prevent default form submission
    
            var formData = new FormData(this);  // Get the form data including file input
            
            // Include the CSRF token in the request headers
            formData.append('csrfmiddlewaretoken', $('[name="csrfmiddlewaretoken"]').val());
    
            // Make the AJAX request to submit the form data
            $.ajax({
                url: '{% url "submit_emp_code_of_conduct" %}?EC={{EC}}&EmpID={{EmpID}}',
                type: 'POST',
                data: formData,
                processData: false,  // Don't process the data
                contentType: false,  // Don't set content type
                success: function(response) {
                    if (response.success) {
                        // Handle success (maybe show a success message)
                        $('#editConductModal').modal('hide');
                        alert("Data saved successfully!");
                        
                        // Reload the page to reflect the changes
                        location.reload();
                    } else {
                        // Handle failure
                        alert("Failed to save data!");
                    }
                },
                error: function(xhr, status, error) {
                    // Handle any errors
                    alert("An error occurred while saving the data.");
                }
            });
        });
    });
</script>



 
    
   
     



    <script>
        $(document).ready(function () {
            const urlParams = new URLSearchParams(window.location.search);
            const success = urlParams.get('Success');
            
            if (success === 'True') {
                showSuccess();
                removeSuccessParam();
            }
            if (success === 'Deleted') {
                showDelete();
                removeSuccessParam();
            }
            if (success === 'Uploaded') {
                showUploaded();
                removeSuccessParam();
            }
    
            function removeSuccessParam() {
                urlParams.delete('Success'); 
                const newUrl = window.location.pathname + '?' + urlParams.toString();
                window.history.replaceState(null, '', newUrl);
            }
        });
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>   



{% endblock content %}






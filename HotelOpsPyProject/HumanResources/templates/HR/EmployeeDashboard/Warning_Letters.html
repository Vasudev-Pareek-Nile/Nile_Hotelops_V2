{% extends "HR/EmployeeDashboard/EditEmployee.html" %}
 {% load static %} 
{% block content %}
<link href="{% static 'css/plugins/sweetalert/sweetalert.css' %}" rel="stylesheet">

<style>

    #ProfileImagePreview {
        border-radius: 50%;
        border: 2px solid #ddd;     
        margin-top: 10px;
        max-width: 150px; 
        height: 150px;    
        object-fit: cover; 
    }
    .common{
    white-space: normal !important;
    word-wrap: break-word !important;
    word-break: break-word !important;
    }


    .EmpCode{
        min-width: 80px !important;
    max-width: 80px !important;
    }
    .Name{
        min-width: 100px !important;
    max-width: 100px !important;
    }
    /* .Department{
        min-width: 100px !important;
    max-width: 100px !important;
    }
    .Designation{
        min-width: 100px !important;
    max-width: 100px !important;
    } */
    .Problems{
        min-width: 120px !important;
        max-width: 120px !important;
    }
    /* .Improvements{
        min-width: 100px !important;
    max-width: 100px !important;
    } */
    /* .From{
        min-width: 100px !important;
    max-width: 100px !important;
    }
    .To{
        min-width: 100px !important;
    max-width: 100px !important;
    } */
    .Period {
        min-width: 100px !important;
        max-width: 100px !important;
        text-align: center;
    }
    .WarnDate{
        min-width: 90px !important;
    max-width: 90px !important;
    }
    .Actions{
        min-width: 100px !important;
        max-width: 100px !important;
    }
    table{
        font-size:14px;
    }
    table th{
        font-size:14px;
        text-align: center;
    }
</style>

<style>
    .card {
        border-radius: 5px;
        border: 1px solid #0000004f;
    }

    .card-header{
        margin-bottom: -20px !important;
    }

    .card .card-body {
        padding: 18px !important;
    }
</style>

<div class="card">
    <div class="card-header">
       <span class=" text-uppercase fw-bold">  Warning Letters </span> 
        {% if FinalWarning == 'Show'  %}
        <a class="btn btn-primary btn-sm text-white" data-bs-toggle="modal" data-bs-target="#warningModal" style="float:right">New Warning</a>
        {% endif %}
    </div>

    <div class="card-body">
        <table  class="table table-bordered">
            <thead>
                <tr>
                    <th class="WarnType common">Warn. Type</th>
                    <th class="EmpCode common">Code</th>
                    <th class="Name common">Name</th>
                    <!-- <th class="Department common">Department</th> -->
                    <!-- <th class="Designation common">Designation</th> -->
                    <th class="Problems common">Problems</th>
                    <!-- <th class="Improvements common">Improvements</th> -->
                    <!-- <th class="From common">From</th>
                    <th class="To common">To</th> -->
                    <th class="To common">Priod</th>
                    <th class="WarnDate common">Warn. Date</th>
                    <th class="Actions common">Actions</th>
                    
                </tr>
            </thead>
            <tbody>
                {% for warning in warnings %}
                    <tr>
                        <td  class="WarnType common">
                            {% if warning.type == 'Written' %}
                                Written-{{ warning.data.warnings|capfirst }}
                            {% else %}
                                {{ warning.type }}
                            {% endif %}
                        </td>
            
                        {% if warning.type == 'Verbal' %}
                            <td class="EmpCode common">{{ warning.data.emp_code }}</td>
                            <td class="Name common">{{ warning.data.emp_name }}</td>
                            <!-- <td class="Department common">{{ warning.data.department }}</td> -->
                            <!-- <td class="Designation common">{{ warning.data.designation }}</td> -->
                            <td class="Problems common">{{ warning.data.problems }}</td>
                            <!-- <td class="Improvements common">{{ warning.data.improvements }}</td> -->
                            <!-- <td class="From common">{{ warning.data.from_date |date:"d M. Y" }}</td>
                            <td class="To common">{{ warning.data.to_date |date:"d M. Y" }}</td> -->
                            <td class="Period  common">
                                {{ warning.data.from_date |date:"d M. Y" }}
                                            <br>    To <br>
                                {{ warning.data.to_date |date:"d M. Y" }}
                            </td>
                            <td class="WarnDate common">{{ warning.data.verbally_warned |date:"d M. Y" }}</td>
                        {% elif warning.type == 'Written' %}
                            <td class="EmpCode common">{{ warning.data.employee_no }}</td>
                            <td class="Name common">{{ warning.data.name }}</td>
                            <!-- <td class="Department common">{{ warning.data.department }}</td> -->
                            <!-- <td class="Designation common">{{ warning.data.designation }}</td> -->
                            <td class="Problems common">{{ warning.data.problems }}</td>
                            <!-- <td class="Improvements common">{{ warning.data.written_warning }}</td> -->
                            <!-- <td class="From common">{{ warning.data.period_from |date:"d M. Y" }}</td>
                            <td class="To common">{{ warning.data.period_to |date:"d M. Y" }}</td> -->
                            <td class="Period  common">
                                {{ warning.data.period_from |date:"d M. Y" }}
                                            <br>  To <br>
                                {{ warning.data.period_to |date:"d M. Y" }}
                            </td>
                            <td class="WarnDate common">{{ warning.data.warning_date |date:"d M. Y" }}</td>
                        {% elif warning.type == 'Final' %}
                            <td class="EmpCode common">{{ warning.data.employee_no }}</td>
                            <td class="Name common">{{ warning.data.name }}</td>
                            <!-- <td class="Department common">{{ warning.data.department }}</td> -->
                            <!-- <td class="Designation common">{{ warning.data.designation }}</td> -->
                            <td class="Problems common">{{ warning.data.employee_problem }}</td>
                            <!-- <td class="Improvements common">{{ warning.data.written_warning }}</td> -->
                            <!-- <td class="From common">{{ warning.data.improvement_period_from |date:"d M. Y" }}</td>
                            <td class="To common">{{ warning.data.improvement_period_to |date:"d M. Y" }}</td> -->
                            <td class="Period  common">
                                {{ warning.data.improvement_period_from |date:"d M. Y" }}
                                                <br>    To <br>
                                {{ warning.data.improvement_period_to |date:"d M. Y" }}
                            </td>
                            <td class="WarnDate common">{{ warning.data.warning_date |date:"d M. Y" }}</td>
                        {% endif %}
            
                        <td class="Actions common">
                            {% if warning.type == 'Verbal' %} 
                            <a href="{% url 'VerbalWarning' %}?ID={{  warning.data.id }}&EmpID={{EmpID}}&DepartmentName={{  warning.data.department  }}&OID={{OrganizationID}}" class="btn btn-primary btn-sm " title="Edit">&nbsp;Edit</a>    
                                {% comment %} <a target="_blank" href="{% url 'verbal_warning_pdf' warning.data.id %}?OID={{OrganizationID}}" class="btn btn-primary btn-sm" title="Verbal Warning PDF">PDF</a> {% endcomment %}
                            <a target="_blank" href="{% url 'verbal_warning_pdf'  %}?id={{warning.data.id}}&OID={{warning.data.OrganizationID}}" class="btn btn-primary btn-sm" title="Verbal Warning PDF">PDF</a>

                            {% elif warning.type == 'Written' %}
                                <a href="{% url 'Written_Warning' %}?ID={{  warning.data.id }}&EmpID={{EmpID}}&DepartmentName={{  warning.data.department  }}&OID={{OrganizationID}}" class="btn btn-primary btn-sm " title="Edit">&nbsp;Edit</a>
                                {% comment %} <a target="_blank" href="{% url 'written_warning_pdf' warning.data.id %}?OID={{OrganizationID}}" class="btn btn-primary btn-sm" title="Written Warning PDF">PDF</a> {% endcomment %}
                            <a target="_blank" href="{% url 'written_warning_pdf' %}?id={{warning.data.id}}&OID={{warning.data.OrganizationID}}" class="btn btn-primary btn-sm" title="Written Warning PDF">PDF</a>

                            {% elif warning.type == 'Final' %}
                            <a href="{% url 'FinalWarning' %}?ID={{  warning.data.id }}&EmpID={{EmpID}}&DepartmentName={{  warning.data.department  }}&OID={{OrganizationID}}" class="btn btn-primary btn-sm " title="Edit">&nbsp;Edit</a>
                                {% comment %} <a target="_blank" href="{% url 'final_warning_pdf' warning.data.id %}?OID={{OrganizationID}}" class="btn btn-primary btn-sm" title="Final Warning PDF">PDF</a> {% endcomment %}
                            <a target="_blank" href="{% url 'final_warning_pdf'  %}?id={{warning.data.id}}&OID={{warning.data.OrganizationID}}" class="btn btn-primary btn-sm" title="Final Warning PDF">PDF</a>

                            {% endif %}
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="11">No warnings found</td>
                    </tr>
                {% endfor %}
            </tbody>
            
        </table>
    </div>
</div>

    
   

    
  

<div class="modal fade" id="warningModal" tabindex="-1" role="dialog" aria-labelledby="warningModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header d-flex justify-content-between">
                <h5 class="modal-title" id="warningModalLabel">Select Warning Type</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">Ã—</span>
                </button>
            </div>
            <div class="modal-body d-flex justify-content-between">
                <a href="{% url 'VerbalWarning' %}?EC={{EC}}&EmpID={{EmpID}}&DepartmentName={{ Emobj.Department }}&OID={{OrganizationID}}" class="btn btn-secondary mb-2" >Verbal Warning</a>
                <a href="{% url 'Written_Warning' %}?EC={{EC}}&EmpID={{EmpID}}&DepartmentName={{ Emobj.Department }}&OID={{OrganizationID}}" class="btn btn-warning mb-2">Written Warning</a>
                <a href="{% url 'FinalWarning' %}?EC={{EC}}&EmpID={{EmpID}}&DepartmentName={{ Emobj.Department }}&OID={{OrganizationID}}" class="btn btn-danger mb-2">Final Warning</a>
            </div>
            <div class="CustomFooter  m-3">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
 
    
      {% comment %} {% if not has_final_warning %}
      <a href="{% url 'FinalWarning' %}?EC={{EC}}&EmpID={{EmpID}}&DepartmentName={{ Emobj.Department }}" class="btn btn-danger mb-2">Final Warning</a>
{% endif %} {% endcomment %}


<script>
    $(document).ready(function () {
        const urlParams = new URLSearchParams(window.location.search);
        const success = urlParams.get('Success');
        
        if (success === 'True') {
            showSuccess();
            removeSuccessParam();
        }
        if (success === 'Deleted') {
            showDelete();
            removeSuccessParam();
        }
        if (success === 'Uploaded') {
            showUploaded();
            removeSuccessParam();
        }

        function removeSuccessParam() {
            urlParams.delete('Success'); 
            const newUrl = window.location.pathname + '?' + urlParams.toString();
            window.history.replaceState(null, '', newUrl);
        }
    });
</script>




{% endblock content %}






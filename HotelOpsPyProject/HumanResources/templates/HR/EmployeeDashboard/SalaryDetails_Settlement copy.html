{% extends "HR/EmployeeDashboard/EditEmployee.html" %}
 {% load static %} 
{% block content %}

<div class="card">
    <div class="card-header d-flex justify-content-between">
       <span class=" text-uppercase fw-bold">Salary Information {{current_date}}</span> 
    </div>

    <form id="SalaryInfoForm" method="post" enctype="multipart/form-data">

        {% csrf_token %}
        <div class="main">
            <div class="row m-1">
                
                <div class="col-sm-12 col-md-3 ml-3">
                    <div id="employeeTable_filter" class="dataTables_filter">
                    <label>Effective From:
                        <input type="date" class="form-control" value="{{current_date}}" name="EffectiveFrom" required>
                    </label>
                    </div>
                </div>

                <table class="table table-bordered m-3">
                    <thead>
                        <tr>
                            <th>Components</th>
                            <th>Per Month</th>
                            <th>Per Annum</th>
                        </tr>
                    </thead>
                    <tbody id="salaryTable">
                        {% for SalaryTitle in SalaryTitles %}
                        <tr>
                            <td>
                                {% if SalaryTitle.IsBold %}
                                <span style="font-weight: bold;">
                                    {{SalaryTitle.Title}}
                                </span>
                                {% else %}
                                <span>
                                    {{SalaryTitle.Title}} 
                                </span>
                                {% endif %}
                                <input type="hidden" name="TitleID_{{forloop.counter0}}" value="{{SalaryTitle.id}}">
                            </td>
                            <td>
                               
                                <input type="number" name="Permonth_{{forloop.counter0}}" 
                                value="0" 
                                class="form-control perm-month"
                                data-index="{{forloop.counter0}}"
                                data-type="{% if SalaryTitle.Title == 'Gross (A)' %}A{% elif SalaryTitle.Title == 'Total Employee Deduction (B)' %}B{% elif SalaryTitle.Title == 'Total Company Contribution (C)' %}C{% endif %}"
                                data-title-permonth="{{SalaryTitle.Title}}_Permonth" >
                            </td>
                            <td>
                                <input type="number" name="Perannum_{{forloop.counter0}}" 
                                       value="0" 
                                       class="form-control per-annum"
                                       data-title-perannum="{{SalaryTitle.Title}}_Perannum"  
                                     
                                       readonly>
                            </td>
                        </tr>
                        {% if forloop.last %}
                        <input type="hidden" name="Total_Title" value="{{ forloop.counter0 }}"/>
                        {% endif %}
                        {% endfor %}
                    </tbody>
                </table>


                <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        function updatePerAnnum() {
                            let grossPerMonth = 0;
                            let grossPerAnnum = 0;
                            let deductionsPerMonth = 0;
                            let deductionsPerAnnum = 0;
                            let contributionPerMonth = 0;
                            let contributionPerAnnum = 0;
                
                            document.querySelectorAll('.perm-month').forEach(function(element) {
                                let index = element.getAttribute('data-index');
                                let type = element.getAttribute('data-type');
                                let permMonth = parseFloat(element.value) || 0;
                                let perAnnum = permMonth * 12;
                                document.querySelector(`input[name="Perannum_${index}"]`).value = perAnnum.toFixed(2);
                
                                if (type === 'A') {
                                    grossPerMonth += permMonth;
                                    grossPerAnnum += perAnnum;
                                } else if (type === 'B') {
                                    deductionsPerMonth += permMonth;
                                    deductionsPerAnnum += perAnnum;
                                } else if (type === 'C') {
                                    contributionPerMonth += permMonth;
                                    contributionPerAnnum += perAnnum;
                                }
                            });
                
                            // Update Gross
                            document.querySelector('input[data-title-permonth="Gross (A)_Permonth"]').value = grossPerMonth.toFixed(2);
                            document.querySelector('input[data-title-perannum="Gross (A)_Perannum"]').value = grossPerAnnum.toFixed(2);
                
                            // Update Employee Deductions
                            document.querySelector('input[data-title-permonth="Total Employee Deduction (B)_Permonth"]').value = deductionsPerMonth.toFixed(2);
                            document.querySelector('input[data-title-perannum="Total Employee Deduction (B)_Perannum"]').value = deductionsPerAnnum.toFixed(2);
                
                            // Update Company Contributions
                            document.querySelector('input[data-title-permonth="Total Company Contribution (C)_Permonth"]').value = contributionPerMonth.toFixed(2);
                            document.querySelector('input[data-title-perannum="Total Company Contribution (C)_Perannum"]').value = contributionPerAnnum.toFixed(2);
                
                        
                            // Update CTC
                            let ctcPerMonth = grossPerMonth + contributionPerMonth;
                            let ctcPerAnnum = grossPerAnnum + contributionPerAnnum;
                            document.querySelector('input[data-title-permonth="CTC (A+C)_Permonth"]').value = ctcPerMonth.toFixed(2);
                            document.querySelector('input[data-title-perannum="CTC (A+C)_Perannum"]').value = ctcPerAnnum.toFixed(2);
                        }
                
                        // Add event listeners for the input elements
                        document.querySelectorAll('.perm-month').forEach(function(element) {
                            element.addEventListener('input', updatePerAnnum);
                        });
                
                        // Initial calculation on page load
                        updatePerAnnum();
                    });
                </script>
            </div>
    
        
        </div>
        <div class="card-footer text-right">
            <button type="submit" id="saveButton" class="btn btn-primary Successpopup">Save</button>
        </div>
    </form>
</div>

{% comment %} 

<script>
    document.addEventListener('DOMContentLoaded', function() {
        function updatePerAnnum() {
            let grossPerMonth = 0;
            let grossPerAnnum = 0;
            let deductionsPerMonth = 0;
            let deductionsPerAnnum = 0;
            let contributionPerMonth = 0;
            let contributionPerAnnum = 0;

            document.querySelectorAll('.perm-month').forEach(function(element) {
                let index = element.getAttribute('data-index');
                let type = element.getAttribute('data-type');
                let permMonth = parseFloat(element.value) || 0;
                let perAnnum = permMonth * 12;
                document.querySelector(`input[name="Perannum_${index}"]`).value = perAnnum.toFixed(2);

                if (type === 'A') {
                    grossPerMonth += permMonth;
                    grossPerAnnum += perAnnum;
                } else if (type === 'B') {
                    deductionsPerMonth += permMonth;
                    deductionsPerAnnum += perAnnum;
                } else if (type === 'C') {
                    contributionPerMonth += permMonth;
                    contributionPerAnnum += perAnnum;
                }
            });

            // Update Gross
           // document.querySelector('input[data-title-permonth="Gross (A) _Permonth"]').value = grossPerMonth.toFixed(2);
            document.querySelector('input[data-title-perannum="Gross (A)_Perannum"]').value = grossPerAnnum.toFixed(2);

            // Update Employee Deductions
            document.querySelector('input[data-title-permonth="Total Employee Deduction (B)_Permonth"]').value = deductionsPerMonth.toFixed(2);
            document.querySelector('input[data-title-perannum="Total Employee Deduction (B)_Perannum"]').value = deductionsPerAnnum.toFixed(2);

            // Update Company Contributions
            document.querySelector('input[data-title-permonth="Total Company Contribution (C)_Permonth"]').value = contributionPerMonth.toFixed(2);
            document.querySelector('input[data-title-perannum="Total Company Contribution (C)_Perannum"]').value = contributionPerAnnum.toFixed(2);

            
            // Update CTC
            let ctcPerMonth = grossPerMonth + contributionPerMonth;
            let ctcPerAnnum = grossPerAnnum + contributionPerAnnum;
            document.querySelector('input[data-title-permonth="CTC (A+C)_Permonth"]').value = ctcPerMonth.toFixed(2);
            document.querySelector('input[data-title-perannum="CTC (A+C)_Perannum"]').value = ctcPerAnnum.toFixed(2);
        }

        // Add event listeners for the input elements
        document.querySelectorAll('.perm-month').forEach(function(element) {
            element.addEventListener('input', updatePerAnnum);
        });

        // Initial calculation on page load
        updatePerAnnum();
    });
</script> {% endcomment %}
    

{% endblock content %}






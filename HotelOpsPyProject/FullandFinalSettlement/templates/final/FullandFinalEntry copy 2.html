{% extends 'final/homebase.html' %}
{% load static %}

{% block content %}
<style>
    table {
        border-collapse: collapse;
        width: 100%;
        font-size: 14px;
    }
    th, td {
        border: 1px solid rgba(0, 0, 0, 0.295);
        padding: 4px;
        text-align: left;
    }
    th {
        background-color: #f2f2f2;
    }
    .section-title {
        /* background-color: #edf0fb !important; */
        padding: 8px;
        font-weight: bold;
        text-align: center;
    }
    .no-border {
        border: none !important;
    }


/* HeaderReplaced*/
    .input-small {
        /* height: 30px; */
        height: 40px;
        /* text-align: center; */
    }
    .fixedwidth{
        width: 120px !important;
    }

    .Select-Input{
        /* height: 30px; */
        height: 40px;
        padding-inline: 10px;
        padding-block: 0px;
    }
    
    .Period{
        height: 40px;
    }
    .PeriodTd{
        width: 250px;
    }
    .Input-Type1{
        height: 40px;
    }
    .Input-Type1-TD{
        width: 200px;
    }

    .PLPAYMENT tr td{
        width: 300px;
    }

    .PLPAYMENT tr td input, .Section-7 input, .Section-8 input{
       height: 40px;
    }

    .PARTICULAR{
        width: 400px !important;
    } 

    .AMOUNT{
        width: 250px !important;
    } 

</style>

<div class="container">
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header">
                    <h4 class="card-title fw-bold text-center">FULL AND FINAL SETTLEMENT OF DUES STATEMENT</h4> 
                </div>
                <div class="card-body">
                    <form action="" method="post" id="FullandFinalSettlement">
                {% csrf_token %}
                        <!-- <h2 style="text-align:center;">HOWARD JOHNSON BY WYNDHAM UDAIPUR</h2>-->

                        <table class="custom-table table-striped">
                            <tr>
                                <td colspan="1"><label for="employeeName">Employee Name</label></td><td colspan="3"><input type="text" class="form-control input-small" style="width: 250px;" name="Name" id="employeeName"  value="{{ Fobj.Name }}" required readonly> </td>
                                <td  colspan="1"><label for="employeeCode">Employee Code</label></td><td  colspan="3"><input type="text" class="form-control input-small" style="width: 250px;" name="Emp_Code" id="employeeCode"  value="{{ Fobj.Emp_Code }}" required readonly></td>
                            </tr>
                            <tr>
                                <td colspan="1"><label for="joiningDate">Date of Joining</label></td><td colspan="3"><input type="date" class="form-control input-small" name="DOJ" id="joiningDate" style="width: 250px;" value="{{ Fobj.DOJ|date:'Y-m-d' }}" required readonly></td>
                                <td colspan="1"><label for="LeavingDate">Date of Leaving</label></td><td colspan="3"><input type="date" class="form-control input-small" name="Date_Of_Leaving" id="LeavingDate" style="width: 250px;" value="{{ LastWorkingDaysDate|date:'Y-m-d' }}" required> </td> 
                            </tr>
                            <tr>
                                <td colspan="1"><label for="department">Department</label></td><td colspan="3"><input type="text" class="form-control input-small" name="Dept" id="department" style="width: 250px;" value="{{ Fobj.Dept }}" required readonly> </td>
                                <td colspan="1"><label for="designation">Designation</label></td><td colspan="3"><input type="text" class="form-control  input-small" name="Designation" style="width: 250px;" id="designation" value="{{ Fobj.Designation }}" required readonly> </td>
                            </tr>
                            <tr>
                                <td><label for="absconding">Absconding</label></td><td> 
                                    <select name="Absconding" id="absconding" class="form-control Select-Input" required>
                                        <option value="No" {% if Fobj.Absconding == "No" %}selected{% endif %}>No</option>
                                        <option value="Yes" {% if Fobj.Absconding == "Yes" %}selected{% endif %}>Yes</option>
                                    </select>
                                </td>
                                <td><label for="resignation">Resignation</label></td>
                                <td>
                                    <select name="Resignation" id="resignation" class="form-control  Select-Input" required>
                                        <option value="No" {% if Fobj.Resignation == "No" %}selected{% endif %}>No</option>
                                        <option value="Yes" {% if Fobj.Resignation == "Yes" %}selected{% endif %}>Yes</option>
                                    </select>
                                </td>
                                <td><label for="NoticeDaysServed">Notice Days Served</label></td>
                                <td>
                                    <select name="Notice_Days_Served" id="NoticeDaysServed" class="form-control  Select-Input" required>
                                        <option value="No" {% if Fobj.Notice_Days_Served == "No" %}selected{% endif %}>No</option>
                                        <option value="Yes" {% if Fobj.Notice_Days_Served == "Yes" %}selected{% endif %}>Yes</option>
                                    </select>
                                </td>
                                <td><label for="confirmed">Confirmed</label></td>
                                <td>
                                    <select name="Confirmed" id="confirmed" class="form-control Select-Input" style="width: 150px;"  required>
                                        <option value="No" {% if Fobj.Confirmed == "No" %}selected{% endif %}>No</option>
                                        <option value="Yes" {% if Fobj.Confirmed == "Yes" %}selected{% endif %}>Yes</option>
                                    </select>
                                </td>
                            </tr>
                            <!-- try -->
                            <tr>
                                <td><label for="terminated">Terminated</label></td><td> 
                                    <select name="Terminated" id="terminated" class="form-control Select-Input" required>
                                        <option value="No" {% if Fobj.Terminated == "No" %}selected{% endif %}>No</option>
                                        <option value="Yes" {% if Fobj.Terminated == "Yes" %}selected{% endif %}>Yes</option>
                                    </select>
                                </td>
                                <td><label for="laidOff">Laid Off</label></td>
                                <td>
                                    <select name="Laid_Off" id="laidOff" class="form-control  Select-Input" required>
                                        <option value="No" {% if Fobj.Laid_Off == "No" %}selected{% endif %}>No</option>
                                        <option value="Yes" {% if Fobj.Laid_Off == "Yes" %}selected{% endif %}>Yes</option>
                                        <option value="Na" {% if Fobj.Laid_Off == "Na" %}selected{% endif %}>NA</option>
                                        <option value="Transfer" {% if Fobj.Laid_Off == "Transfer" %}selected{% endif %}>Transfer</option>
                                    </select>
                                </td>
                                <td><label for="deductionFromSalary">Deduction from salary PL</label></td>
                                <td>
                                    <select name="Deduction_from_salary_PL" id="deductionFromSalary" class="form-control" required>
                                        <option value="No" {% if Fobj.Deduction_from_salary_PL == "No" %}selected{% endif %}>No</option>
                                        <option value="Yes" {% if Fobj.Deduction_from_salary_PL == "Yes" %}selected{% endif %}>Yes</option>
                                    </select>
                                </td>
                                <td><label for="currentSalary">Current Salary</label></td>
                                <td>
                                    <input type="number" class="form-control input-small"  style="width: 150px;" name="Current_Salary" id="currentSalary" value="{{ Fobj.Current_Salary }}" required>
                                </td>
                            </tr>

                            <!-- try 2-->
                            <tr>
                                <td><label for="BasicSalary">Basic Salary</label></td>
                                <td colspan="3">
                                    <input type="number" class="form-control input-small" style="width: 200px;" value="{{ BasicSalary }}" readonly>
                                    <!-- <input type="number" class="form-control input-small" style="width: 200px;" name="PL_Basic_Salary" id="BasicSalary" value="{{ BasicSalary }}" readonly> -->
                                </td>
                                <td><label for="Gross">Gross Salary</label></td>
                                <td colspan="3">
                                    <input type="number" class="form-control input-small" style="width: 200px;"  value="{{ GrossSalary }}" readonly>
                                    <!-- <input type="number" class="form-control input-small" name="NPP_Gross" style="width: 200px;"  id="GrossSalary" value="{{ GrossSalary }}" readonly> -->
                                </td>
                            </tr>
                        </table>

                        <!-- Section: 2 LEAVE SUMMARY -->
                        <br><div class="section-title HeaderWithColor">LEAVE SUMMARY</div>
                        <table class="custom-table table-striped">
                            <tr>
                                <td class="PeriodTd"><label for="LS_Period">From</label></td>
                                <td class="PeriodTd"><label for="To_Date">To</label></td>
                                <td class="Input-Type1-TD"><label for="OpeningBalance">Opening Balance</label></td>
                                <td class="Input-Type1-TD"><label for="leaveEarned">Leave Earned</label></td>
                                <td class="Input-Type1-TD"><label for="leaveAvailed">Leave Availed</label></td>
                                <td class="Input-Type1-TD"><label for="plBal">PL Balance</label></td>
                            </tr>
                            <tr>
                                <td><input type="date" class="form-control Period" name="LS_Period" id="FromDate" value="{{ DateOfJoining|date:'Y-m-d' }}" ></td>
                                <td><input type="date" class="form-control Period" name="To_Date" id="ToDate" value="{{ LastWorkingDaysDate|date:'Y-m-d' }}"></td>
                                <!-- <td><input type="date" class="form-control Period" name="To_Date" id="ToDate" value="{{ LastWorkingDaysDate|date:'Y-m-d' }}"></td> -->
                                <td><input type="number" class="form-control Input-Type1" name="LS_Opening_Balance" id="OpeningBalance" value="{{ LeaveBalance }}" ></td>
                                <td><input type="number" class="form-control" name="LS_Leaved_Earned" id="leaveEarned" value=""></td>
                                <td><input type="number" class="form-control" name="LS_Leaved_Availed" id="leaveAvailed" value="{{ total_credit }}"></td>
                                <td><input type="number" class="form-control" name="LS_PL_Bal" id="plBal" value="" readonly></td>

                            </tr>
                        </table>

                        <!-- Section: 3 -- PL PAYMENT  -->
                        <br><div class="section-title">PL PAYMENT</div>
                        <table class="PLPAYMENT custom-table table-striped">
                            <tr>
                                <td><label for="TotalPL">Total PL</label></td>
                                <td><label for="BasicSalary">Basic Salary</label></td>
                                <td><label for="PlRate">Rate</label></td>
                                <td><label for="PLAmount">Amount</label></td>
                            </tr>
                            <tr>
                                <td><input type="number" class="form-control" name="PL_Total_PL" id="TotalPL" value="" readonly></td>
                                <td><input type="number" class="form-control" name="PL_Basic_Salary" id="BasicSalary" value="{{ BasicSalary }}" readonly></td>
                                <td><input type="number" class="form-control" name="PL_Rate" id="PlRate" value="" readonly></td>
                                <td><input type="number" class="form-control" name="PL_Amount" id="PLAmount" value="" readonly></td>
                            </tr>
                        </table>

                        <!-- Section: 4 -- NOTICE PERIOD PAY -->
                        <br><div class="section-title">NOTICE PERIOD PAY</div>
                        <table class="PLPAYMENT custom-table table-striped">
                            <tr>
                                <td><label for="TotalNoticeServed">Total Notice served</label></td>
                                <td><label for="TotalNoticePayDays">Total Notice Pay Days</label></td>
                                <td><label for="Gross">Gross Salary</label></td>
                                <td><label for="NPPRate">Rate</label></td>
                                <td><label for="NPPAmount">Net Amount Paid</label></td>
                            </tr>
                            <tr>
                                <td><input type="number" class="form-control" name="TotalNoticeServed" id="TotalNoticeServed" value="{{ NoticePeriodDays }}" readonly></td> 
                                <td><input type="number" class="form-control" name="NPP_Total_Notice_Pay_Days" id="TotalNoticePayDays" value="0"></td>
                                <td><input type="number" class="form-control"  name="NPP_Gross" id="GrossSalary" value="{{ GrossSalary }}" readonly></td>
                                <td><input type="number" class="form-control" name="NPP_Rate" id="NPPRate" value="" readonly></td>
                                <td><input type="number" class="form-control" name="NPP_Net_Amount_Paid" id="NPPAmount" value="" readonly></td>
                            </tr>
                        </table>

                        <!--  Section: 5 -- LEAVE TRAVEL ENTITLEMENT -->
                        <br><div class="section-title">LEAVE TRAVEL ENTITLEMENT</div>
                        <table class="PLPAYMENT custom-table table-striped">
                            <tr>
                                <td><label for="TOTALMONTHSWORKED">TOTAL MONTHS WORKED</label></td>
                                <td><label for="LTARATE">LTA RATE</label></td>
                                <td><label for="TOTALDAYSWORKED">TOTAL DAYS WORKED</label></td>
                                <td><label for="PRORATABASISPAYMENT">PRO RATA BASIS PAYMENT (LTA Amount)</label></td>
                            </tr>
                            <tr>
                                <td><input type="number" class="form-control" name="TOTALMONTHSWORKED" id="TOTALMONTHSWORKED" value="0"></td>
                                <td><input type="number" class="form-control" name="LTARATE" id="LTARATE" value="0"></td>
                                <td><input type="number" class="form-control" name="TOTALDAYSWORKED" id="TOTALDAYSWORKED" value="0"></td>
                                <td><input type="number" class="form-control" name="PRORATABASISPAYMENT" id="PRORATABASISPAYMENT" value="0"></td>
                            </tr>
                        </table>

                        <!--  Section: 6 -- GRATUITY PAYMENT -->
                        <br><div class="section-title">GRATUITY PAYMENT</div>
                        <table class="PLPAYMENT custom-table table-striped">
                            <tr>
                                <td><label for="NoOfYears">No Of Years</label></td>
                                <td><label for="LastBasics">Last Basics</label></td>
                                <td><label for="GraturityDaysPeryear">Graturity Days / Per year</label></td>
                                <td><label for="GraturityPayments">Graturity Payments</label></td>
                            </tr>
                            <tr>
                                <td><input type="number" class="form-control" name="GP_No_Of_Years" id="NoOfYears" value="{{ TenureYears }}"></td>
                                <td><input type="number" class="form-control" name="GP_Last_Basics" id="LastBasics" value="{{ BasicSalary }}" readonly></td>
                                <td><input type="number" class="form-control" name="GraturityDaysPeryear" id="GraturityDaysPeryear" value="15" readonly></td>
                                <td><input type="number" class="form-control" name="GP_Graturity_Payments" id="GraturityPayments" value="" readonly></td>
                            </tr>
                        </table>

                        <!--  Section: 7 -- GRATUITY PAYMENT -->
                        <br><div class="section-title">Advance Salary</div>
                        <table class="PLPAYMENT custom-table table-striped">
                            <tr>
                                <td><label for="TotalAdvanceTaken">Total Advance Taken</label></td>
                                <td><label for="TotalAdvancePaid">Total Advance Paid</label></td>
                                <td><label for="RemainingAmount">Remaining Amount</label></td>
                            </tr>
                            <tr>
                                <td><input type="text" class="form-control" name="TotalAdvanceTaken" id="TotalAdvanceTaken" value="{{TotalAdvancePayment}}"></td>
                                <td><input type="text" class="form-control" name="TotalAdvancePaid" id="TotalAdvancePaid" value="{{TotalAmountPaid}}"></td>
                                <td><input type="text" class="form-control" name="RemainingAmount" id="RemainingAmount" value="" readonly></td>
                            </tr>
                        </table>

                        <!--  Section: 7 -- GRATUITY PAYMENT -->
                        <br><div class="section-title">Bank Details</div>
                        <table class="PLPAYMENT custom-table table-striped">
                            <tr>
                                <td><label for="BankName">Bank Name</label></td>
                                <td><label for="BranchName">Branch Name</label></td>
                                <td><label for="AccountsNumber">Accounts Number</label></td>
                                <td><label for="IFSCCode">IFSC Code</label></td>
                            </tr>
                            <tr>
                                <td><input type="text" class="form-control" name="BankName" id="BankName" value="{{BankName}}" readonly></td>
                                <td><input type="text" class="form-control" name="BranchName" id="BranchName" value="{{BankBranch}}" readonly></td>
                                <td><input type="text" class="form-control" name="AccountsNumber" id="AccountsNumber" value="{{BankAccountNumber}}" readonly></td>
                                <td><input type="text" class="form-control" name="IFSCCode" id="IFSCCode" value="{{BankIFSCCode}}" readonly></td>
                            </tr>
                        </table>

                        <!--  Section: 8 -- FULL AND FINAL PAYMENT SUMMARY -->
                        <br><div class="section-title">FULL AND FINAL PAYMENT SUMMARY</div>
                        <table class="custom-table table-striped">
                            <tr>
                                <td colspan="1" class="text-center PARTICULAR"><b>PARTICULAR</b></td>
                                <td colspan="1" class="text-center AMOUNT"><b>AMOUNT</b></td>
                                <td colspan="3" class="text-center"><b>REMARKS</b></td>
                            </tr>

                            <!-- Earnings -->
                            <tr>
                                <td colspan="1" class="fw-bolder text-center">Earnings</td>
                                <td colspan="1">&nbsp;</td>
                                <td colspan="3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td colspan="1"><label for="LTAAmount">LTA Amount</label></td>
                                <td colspan="1"><input type="number" class="form-control" name="LTAAmount" id="LTAAmount" value="0" readonly></td>
                                <td colspan="3"><input type="text" class="form-control" name="LTARemarks" id="LTARemarks" title="Remarks For LTA"  placeholder="Enter Remarks For LTA"></td>
                            </tr>
                            <tr>
                                <td colspan="1"><label for="FinalPLPaymentAmount">PL Payment</label></td>
                                <td colspan="1"><input type="number" class="form-control" name="FinalPLPaymentAmount" id="FinalPLPaymentAmount" value="0" readonly></td>
                                <td colspan="3"><input type="text" class="form-control" name="PLPaymentRemarks" id="PLPaymentRemarks" placeholder="Remarks For PL Payment"></td>
                            </tr>
                            <tr>
                                <td colspan="1"><label for="GraturityPaymentsEarning">Graturity Payments</label></td>
                                <td colspan="1"><input type="number" class="form-control" name="GraturityPaymentsEarning" id="GraturityPaymentsEarning" value="0" readonly></td>
                                <td colspan="3"><input type="text" class="form-control" name="GraturityPaymentsEarningRemarks" id="GraturityPaymentsEarningRemarks" placeholder="Remarks For Graturity Payments"></td>
                            </tr>
                            <tr>
                                <td colspan="1"><label for="OtherEarnings">Other Earnings</label></td>
                                <td colspan="1"><input type="number" class="form-control" name="OtherEarnings" id="OtherEarnings" value="0"></td>
                                <td colspan="3"><input type="text" class="form-control" name="OtherEarningsRemarks" id="OtherEarningsRemarks" placeholder="Remarks For Other Earnings"></td>
                            </tr>
                            <tr>
                                <td colspan="1"><label for="PendingSalary">Pending Salary</label></td>
                                <td colspan="1"><input type="number" class="form-control" name="FFPS_Pending_Salary" id="PendingSalary" value="0"> </td>
                                <td colspan="3"><input type="text" class="form-control" name="PendingSalaryRemarks" id="PendingSalaryRemarks" placeholder="Remarks For Pending Salary"> </td>
                            </tr>                            
                            <tr>
                                <td colspan="1" class="fw-bold fst-italic"><label for="TOTALEARNING">TOTAL EARNING</label></td>
                                <td colspan="1" class="fw-bold"><input type="number" class="form-control" name="TOTALEARNING" id="TOTALEARNING" value="0" readonly></td>
                                <td colspan="3"><input type="text" class="form-control" name="TOTALEARNINGRemarks" id="TOTALEARNINGRemarks" placeholder="Remarks For Total Earning"></td>
                            </tr>

                            <!-- DEDUCTION -->
                            <tr>
                                <td colspan="1" class="fw-bolder text-center">DEDUCTION</td>
                                <td colspan="1">&nbsp;</td>
                                <td colspan="3">&nbsp;</td>
                            </tr>
                            <tr>
                                <td colspan="1"><label for="UniformDeductions">Uniform Deductions</label></td>
                                <td colspan="1"><input type="number" class="form-control" name="FFPS_Uniform_Deductions" id="UniformDeductions" value="{% if UniformDeductions %}{{ UniformDeductions }}{% else %}{% endif %}"></td>
                                {% comment %} <td colspan="1"><input type="number" class="form-control" name="FFPS_Uniform_Deductions" id="UniformDeductions" value=""></td> {% endcomment %}
                                <td colspan="2"><input type="text" class="form-control" name="UniformDeductionsRemarks" id="UniformDeductionsRemarks" placeholder="Remarks For Uniform Deductions"> </td>
                            </tr>
                            <tr>
                                <td colspan="1"><label for="OtherDeductions">Other Deductions</label></td>
                                <td colspan="1"><input type="number" class="form-control" name="OtherDeductions" id="OtherDeductions" value="0"></td>
                                <td colspan="2"><input type="text" class="form-control" name="DeductionsRemarks" id="DeductionsRemarks" placeholder="Remarks For Other Deductions"></td>
                            </tr>
                            <tr>
                                <td colspan="1"><label for="NOTICEPERIODDeductions">Notice Period</label></td>
                                <td colspan="1"><input type="number" class="form-control" name="NOTICEPERIODDeductions" id="NOTICEPERIODDeductions" value="0" readonly></td>
                                <td colspan="3"><input type="text" class="form-control" name="NOTICEPERIODDeductionsRemarks" id="NOTICEPERIODDeductionsRemarks" placeholder="Remarks For Notice Period"> </td>
                            </tr>
                            <tr>
                                <td colspan="1"><label for="AdvanceSalary">Advance Salary</label></td>
                                <td colspan="1"><input type="number" class="form-control" name="AdvanceSalary" id="AdvanceSalary" value="0" readonly></td>
                                <td colspan="3"><input type="text" class="form-control" name="AdvanceSalaryRemarks" id="AdvanceSalaryRemarks" placeholder="Remarks For Advance Salary"> </td>
                            </tr>
                            <tr>
                                <td colspan="1" class="fw-bold fst-italic"><label for="TotalDeductionsRemarks">TOTAL DEDUCTION</label></td>
                                <td colspan="1" class="fw-bold"><input type="number" class="form-control" name="TotalDeductions" id="TotalDeductions" value="0" readonly></td>
                                <td colspan="3"><input type="text" class="form-control" name="TotalDeductionsRemarks" id="TotalDeductionsRemarks" placeholder="Remarks For Total Deductions"></td>
                            </tr>
                            <!-- <tr>
                                <td colspan="1" class="fw-bold fst-italic"><label for="PayableAmount">Payable Amount</label></td>
                                <td colspan="1" class="fw-bold"><input type="number" class="form-control" name="FFPS_Payable_Amount" id="PayableAmount" value="0"></td>
                                <td colspan="3"><input type="text" class="form-control" name="PayableAmountRemarks" id="PayableAmountRemarks" placeholder="Remarks For Payable Amount"> </td>
                            </tr> -->
                        </table>

                        <br>
                        <!--  Section: 9 -- Final Payable Amount -->
                        <table class="custom-table table-striped">
                            <tr>
                                <td colspan="1" class="text-center PARTICULAR fs-5"><b><label for="PayableAmount">Final Payable Amount</label></b></td>
                                <td colspan="1" class="text-center AMOUNT"><b><input type="number" class="form-control" name="FFPS_Payable_Amount" id="PayableAmount" value="0" readonly></b></td>
                                <td colspan="1" class="text-end"><input type="submit" class="btn btn-primary"></td>
                            </tr>
                        </table>
                    </form> 
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Dropdown Disabled and Enable Control -->
<script>
    const absconding = document.getElementById("absconding");
    const resignation = document.getElementById("resignation");
    const terminated = document.getElementById("terminated");
    const NoticeDaysServed = document.getElementById("NoticeDaysServed");
    const form = document.getElementById("FullandFinalSettlement");

    function toggleFormFieldsBasedOnAbsconding() {

        if (absconding.value === "Yes") {
            // Disable all inputs except absconding itself
            Array.from(form.elements).forEach(el => {
                if (el.id !== "absconding") {
                    el.disabled = true;
                }
            });
        } else {
            // Re-enable inputs if not Yes
            Array.from(form.elements).forEach(el => {
                el.disabled = false;
            });
        }
    }

    function toggleFormFieldsBasedOnResignation() {
        if (resignation.value === "Yes" || terminated.value === "Yes") {
            // Disable all inputs except absconding itself
            absconding.disabled = true
        } else {
            // Re-enable inputs if not Yes
            absconding.disabled = false
        }
    }

    // Run on page load
    document.addEventListener("DOMContentLoaded", () => {
        toggleFormFieldsBasedOnAbsconding();
        toggleFormFieldsBasedOnResignation();
    });

    // Run when absconding value changes
    document.getElementById("absconding").addEventListener("change", toggleFormFieldsBasedOnAbsconding);
    document.getElementById("resignation").addEventListener("change", toggleFormFieldsBasedOnResignation);
    document.getElementById("terminated").addEventListener("change", toggleFormFieldsBasedOnResignation);
</script>


<!-- <script>
    var ParseFloatCustom = function (obj) {
        try {
            var a = $(obj).val();
            a = parseFloat(a);
            return isNaN(a) ? 0 : a;
        } catch (e) {}
        return 0;
    }

    var EntryCalculations = function () {
        // First, calculate leave earned
        calculateLeaveEarned();

        // Fetch values
        var OpeningBalanceInput = ParseFloatCustom("#OpeningBalance");
        var LeaveEarnedInput = ParseFloatCustom("#leaveEarned");
        var LeaveAvailedInput = ParseFloatCustom("#leaveAvailed");

        var BasicSalaryInput = ParseFloatCustom("#BasicSalary");
        var GrossSalaryInput = ParseFloatCustom("#GrossSalary");
        var TotalNoticePayDaysInput = ParseFloatCustom("#TotalNoticePayDays");

        // Gratuity Section
        var NoOfYearsinput = ParseFloatCustom("#NoOfYears");
        var LastBasicsInput = ParseFloatCustom("#LastBasics");
        var GraturityDaysPeryearInput = ParseFloatCustom("#GraturityDaysPeryear");

        var GraturityDivideDays = 26;
        var GraturityTotalPayments = 0;

        if (NoOfYearsinput >= 5) {
            var GraturityPayments = (GraturityDaysPeryearInput * LastBasicsInput * NoOfYearsinput) / GraturityDivideDays;
            GraturityTotalPayments = parseFloat(GraturityPayments.toFixed(2));
        }

        // PL Balance & Payment
        var PLBalance = (OpeningBalanceInput + LeaveEarnedInput) - LeaveAvailedInput;
        var PLPaymentRate = parseFloat(((BasicSalaryInput * 12) / 365).toFixed(2));
        var PLPaymentAmount = parseFloat((PLPaymentRate * PLBalance).toFixed(2));

        // Notice Pay
        var TotalNoticeRate = parseFloat(((BasicSalaryInput * 12) / 365).toFixed(2));
        var TotalNoticeAmount = parseFloat((TotalNoticePayDaysInput * TotalNoticeRate).toFixed(2));

        // Deductions
        debugger
        // var UniformDeductionsInput = 10;
        var UniformDeductionsInput = ParseFloatCustom("#UniformDeductions");
        // console.log("the value of float UniformDeductionsInput", UniformDeductionsInput)
        // console.log("the type value of float UniformDeductionsInput", typeof(UniformDeductionsInput))
        var OtherDeductionsInput = ParseFloatCustom("#OtherDeductions");
        var NOTICEPERIODDeductionsInput = ParseFloatCustom("#NOTICEPERIODDeductions");
        var PendingSalaryInput = ParseFloatCustom("#PendingSalary");
        var AdvanceSalaryInput = ParseFloatCustom("#AdvanceSalary");

        
        var AdvanceSalaryInput = TotalRemainingAmount;
        var TotalDeductions = parseFloat((UniformDeductionsInput + OtherDeductionsInput + NOTICEPERIODDeductionsInput + AdvanceSalaryInput).toFixed(2));
       debugger
        // Earnings
        var LTAAmount = ParseFloatCustom("#PRORATABASISPAYMENT");
        var OtherEarningsValue = ParseFloatCustom("#OtherEarnings");

        var TOTALEARNINGValue = parseFloat((
            LTAAmount +
            PLPaymentAmount +
            OtherEarningsValue +
            PendingSalaryInput +
            GraturityTotalPayments
        ).toFixed(2));

        // Payable Amount
        var TotalPayableAmount = parseFloat((TOTALEARNINGValue - TotalDeductions).toFixed(2));

        // Advance
        var TotalAdvanceTaken = ParseFloatCustom("#TotalAdvanceTaken");
        var TotalAdvancePaid = ParseFloatCustom("#TotalAdvancePaid");
        var TotalRemainingAmount = parseFloat((TotalAdvanceTaken - TotalAdvancePaid).toFixed(2));

        $("#RemainingAmount").val(TotalRemainingAmount);
        $("#AdvanceSalary").val(TotalRemainingAmount); // set value for next read


        // Set values to fields
        $("#leaveEarned").val(LeaveEarnedInput.toFixed(2));
        $("#plBal").val(PLBalance.toFixed(2));
        $("#TotalPL").val(PLBalance.toFixed(2));
        $("#PlRate").val(PLPaymentRate);
        $("#PLAmount").val(PLPaymentAmount);
        $("#FinalPLPaymentAmount").val(PLPaymentAmount);

        $("#NPPRate").val(TotalNoticeRate);
        $("#NPPAmount").val(TotalNoticeAmount);
        $("#NOTICEPERIODDeductions").val(TotalNoticeAmount);

        $("#GraturityPayments").val(GraturityTotalPayments);
        $("#GraturityPaymentsEarning").val(GraturityTotalPayments);

        $("#LTAAmount").val(LTAAmount.toFixed(2));
        $("#TOTALEARNING").val(TOTALEARNINGValue);
        $("#TotalDeductions").val(TotalDeductions);

        $("#RemainingAmount").val(TotalRemainingAmount);
        $("#AdvanceSalary").val(TotalRemainingAmount);

        $("#PayableAmount").val(TotalPayableAmount);

        console.log("TotalDeductions:", TotalDeductions);
        console.log("TOTALEARNINGValue:", TOTALEARNINGValue);
        console.log("PayableAmount:", TotalPayableAmount);

    };

    function calculateLeaveEarned() {
        var fromDateValue = $("#FromDate").val();
        var toDateValue = $("#ToDate").val();

        if (fromDateValue && toDateValue) {
            var fromDate = new Date(fromDateValue);
            var toDate = new Date(toDateValue);

            var yearDiff = toDate.getFullYear() - fromDate.getFullYear();
            var monthDiff = toDate.getMonth() - fromDate.getMonth();
            var totalMonths = yearDiff * 12 + monthDiff;

            if (toDate.getDate() >= fromDate.getDate()) {
                totalMonths += 1;
            }

            totalMonths = Math.max(0, totalMonths);
            var leaveEarned = (totalMonths * 1.75).toFixed(2);
            $("#leaveEarned").val(leaveEarned);
        }
    }

    $(document).ready(function () {
        // Bind inputs that trigger recalculation
       console.log("The value of Uniform deductions::", $("#UniformDeductions").val())

        console.log("The type of Uniform deductions::", typeof $("#UniformDeductions").val())
        // console.log(typeof myVar);

        $("#FromDate, #ToDate, #OpeningBalance, #leaveEarned, #leaveAvailed, #GrossSalary, #BasicSalary, #plBal, #OtherEarnings, #TOTALEARNING, #LTAAmount, #UniformDeductions, #OtherDeductions, #NOTICEPERIODDeductions, #PendingSalary, #TotalNoticePayDays, #NoOfYears, #LastBasics, #GraturityDaysPeryear, #PRORATABASISPAYMENT, #TotalAdvanceTaken, #TotalAdvancePaid")
            .on("change input", function () {
                EntryCalculations();
            });

        // Initial run
        EntryCalculations();
    });
    // debugger
</script> -->

<script>
    var ParseFloatCustom = function (obj) {
        try {
            var a = $(obj).val();
            a = parseFloat(a);
            return isNaN(a) ? 0 : a;
        } catch (e) {}
        return 0;
    }

    var EntryCalculations = function () {
        // Step 1: Calculate Leave Earned
        calculateLeaveEarned();

        // Step 2: Get values from form inputs
        var OpeningBalanceInput = ParseFloatCustom("#OpeningBalance");
        var LeaveEarnedInput = ParseFloatCustom("#leaveEarned");
        var LeaveAvailedInput = ParseFloatCustom("#leaveAvailed");
        var BasicSalaryInput = ParseFloatCustom("#BasicSalary");
        var GrossSalaryInput = ParseFloatCustom("#GrossSalary");
        var TotalNoticePayDaysInput = ParseFloatCustom("#TotalNoticePayDays");

        // Step 3: Gratuity Calculation
        var NoOfYearsinput = ParseFloatCustom("#NoOfYears");
        var LastBasicsInput = ParseFloatCustom("#LastBasics");
        var GraturityDaysPeryearInput = ParseFloatCustom("#GraturityDaysPeryear");
        var GraturityDivideDays = 26;
        var GraturityTotalPayments = 0;

        if (NoOfYearsinput >= 5) {
            var GraturityPayments = (GraturityDaysPeryearInput * LastBasicsInput * NoOfYearsinput) / GraturityDivideDays;
            GraturityTotalPayments = parseFloat(GraturityPayments.toFixed(2));
        }

        // Step 4: PL Payment Calculation
        var PLBalance = (OpeningBalanceInput + LeaveEarnedInput) - LeaveAvailedInput;
        var PLPaymentRate = parseFloat(((BasicSalaryInput * 12) / 365).toFixed(2));
        var PLPaymentAmount = parseFloat((PLPaymentRate * PLBalance).toFixed(2));

        // Step 5: Notice Pay
        var TotalNoticeRate = parseFloat(((BasicSalaryInput * 12) / 365).toFixed(2));
        var TotalNoticeAmount = parseFloat((TotalNoticePayDaysInput * TotalNoticeRate).toFixed(2));

        // Step 6: Get deduction values
        var UniformDeductionsInput = ParseFloatCustom("#UniformDeductions");
        var OtherDeductionsInput = ParseFloatCustom("#OtherDeductions");

        // Step 7: Pending Salary
        var PendingSalaryInput = ParseFloatCustom("#PendingSalary");

        // Step 8: Advance Calculation (we'll not fetch from DOM again after setting below)
        var TotalAdvanceTaken = ParseFloatCustom("#TotalAdvanceTaken");
        var TotalAdvancePaid = ParseFloatCustom("#TotalAdvancePaid");
        var TotalRemainingAmount = parseFloat((TotalAdvanceTaken - TotalAdvancePaid).toFixed(2));

        // Set Advance Salary value for DOM use and assign directly
        $("#RemainingAmount").val(TotalRemainingAmount);
        $("#AdvanceSalary").val(TotalRemainingAmount);
        var AdvanceSalaryInput = TotalRemainingAmount; // Use directly instead of re-parsing

        // Step 9: Final Deduction Calculation
        $("#NOTICEPERIODDeductions").val(TotalNoticeAmount); // ensure this is set before use
        var NOTICEPERIODDeductionsInput = TotalNoticeAmount;

        var TotalDeductions = parseFloat((
            UniformDeductionsInput +
            OtherDeductionsInput +
            NOTICEPERIODDeductionsInput +
            AdvanceSalaryInput
        ).toFixed(2));

        // Step 10: Earnings
        var LTAAmount = ParseFloatCustom("#PRORATABASISPAYMENT");
        var OtherEarningsValue = ParseFloatCustom("#OtherEarnings");

        var TOTALEARNINGValue = parseFloat((
            LTAAmount +
            PLPaymentAmount +
            OtherEarningsValue +
            PendingSalaryInput +
            GraturityTotalPayments
        ).toFixed(2));

        // Step 11: Payable Amount
        var TotalPayableAmount = parseFloat((TOTALEARNINGValue - TotalDeductions).toFixed(2));

        // Step 12: Set calculated values to fields
        $("#leaveEarned").val(LeaveEarnedInput.toFixed(2));
        $("#plBal").val(PLBalance.toFixed(2));
        $("#TotalPL").val(PLBalance.toFixed(2));
        $("#PlRate").val(PLPaymentRate);
        $("#PLAmount").val(PLPaymentAmount);
        $("#FinalPLPaymentAmount").val(PLPaymentAmount);

        $("#NPPRate").val(TotalNoticeRate);
        $("#NPPAmount").val(TotalNoticeAmount);

        $("#GraturityPayments").val(GraturityTotalPayments);
        $("#GraturityPaymentsEarning").val(GraturityTotalPayments);

        $("#LTAAmount").val(LTAAmount.toFixed(2));
        $("#TOTALEARNING").val(TOTALEARNINGValue);
        $("#TotalDeductions").val(TotalDeductions);
        $("#PayableAmount").val(TotalPayableAmount);

        console.log("UniformDeductionsInput:", UniformDeductionsInput);
        console.log("AdvanceSalaryInput:", AdvanceSalaryInput);
        console.log("TotalDeductions:", TotalDeductions);
        console.log("TOTALEARNINGValue:", TOTALEARNINGValue);
        console.log("PayableAmount:", TotalPayableAmount);
    };

    // Function to calculate leave earned based on joining and relieving dates
    function calculateLeaveEarned() {
        var fromDateValue = $("#FromDate").val();
        var toDateValue = $("#ToDate").val();

        if (fromDateValue && toDateValue) {
            var fromDate = new Date(fromDateValue);
            var toDate = new Date(toDateValue);

            var yearDiff = toDate.getFullYear() - fromDate.getFullYear();
            var monthDiff = toDate.getMonth() - fromDate.getMonth();
            var totalMonths = yearDiff * 12 + monthDiff;

            if (toDate.getDate() >= fromDate.getDate()) {
                totalMonths += 1;
            }

            totalMonths = Math.max(0, totalMonths);
            var leaveEarned = (totalMonths * 1.75).toFixed(2);
            $("#leaveEarned").val(leaveEarned);
        }
    }

    $(document).ready(function () {
        // Trigger EntryCalculations on input change
        $("#FromDate, #ToDate, #OpeningBalance, #leaveEarned, #leaveAvailed, #GrossSalary, #BasicSalary, #plBal, #OtherEarnings, #TOTALEARNING, #LTAAmount, #UniformDeductions, #OtherDeductions, #NOTICEPERIODDeductions, #PendingSalary, #TotalNoticePayDays, #NoOfYears, #LastBasics, #GraturityDaysPeryear, #PRORATABASISPAYMENT, #TotalAdvanceTaken, #TotalAdvancePaid")
            .on("change input", function () {
                EntryCalculations();
            });

        // Initial calculation on page load
        EntryCalculations();
    });
</script>


<!-- <script>
    var ParseFloatCustom = function (obj) {
        try {
            var a = $(obj).val();
            a = parseFloat(a);
            return isNaN(a) ? 0 : a;
        } catch (e) {}
        return 0;
    }

    var EntryCalculations = function () {
        calculateLeaveEarned(); // Calculate first

        var OpeningBalanceInput = ParseFloatCustom("#OpeningBalance");
        var LeaveEarnedInput = ParseFloatCustom("#leaveEarned");
        var LeaveAvailedInput = ParseFloatCustom("#leaveAvailed");

        var BasicSalaryInput = ParseFloatCustom("#BasicSalary");
        var GrossSalaryInput = ParseFloatCustom("#GrossSalary");

        // Total Notice Pay Days
        var TotalNoticePayDaysInput = ParseFloatCustom("#TotalNoticePayDays");
        // var NPPRateInput = ParseFloatCustom("#NPPRate");
        
        // GRATUITY PAYMENT
        var NoOfYearsinput = ParseFloatCustom("#NoOfYears");
        var LastBasicsInput = ParseFloatCustom("#LastBasics");
        var GraturityDaysPeryearInput = ParseFloatCustom("#GraturityDaysPeryear");


        var GraturityDivideDays = 26

        if (NoOfYearsinput >= 5) {
            GraturityPayments = (GraturityDaysPeryearInput * LastBasicsInput * NoOfYearsinput) / GraturityDivideDays;
            GraturityTotalPayments = GraturityPayments.toFixed(2);  // equivalent of Python's round(..., 2)
        } else {
            GraturityTotalPayments = 0;
        }

        $("#GraturityPayments").val(GraturityTotalPayments);


        // Calculate PL Balance
        var PLBalance = (OpeningBalanceInput + LeaveEarnedInput) - LeaveAvailedInput;

        // Calculate PL Payment Rate
        var PLPaymentRate = ((BasicSalaryInput * 12) / 365).toFixed(2);

        // Total Notice Pay Days Rate
        var TotalNoticeRate = ((BasicSalaryInput * 12) / 365).toFixed(2);
        var TotalNoticeAmount = (TotalNoticePayDaysInput * TotalNoticeRate).toFixed(2);

        // Calculate PL Amount directly from PLBalance
        // var PLPaymentAmount = (PLPaymentRate * PLBalance).toFixed(2);
        var PLPaymentAmount = parseFloat((PLPaymentRate * PLBalance).toFixed(2));



        // Total Deductions 
        var UniformDeductionsInput = ParseFloatCustom("#UniformDeductions");
        var OtherDeductionsInput = ParseFloatCustom("#OtherDeductions");
        var NOTICEPERIODDeductionsInput = ParseFloatCustom("#NOTICEPERIODDeductions");
        var PendingSalaryInput = ParseFloatCustom("#PendingSalary");
        var TotalDeductions = parseFloat(UniformDeductionsInput + OtherDeductionsInput + NOTICEPERIODDeductionsInput).toFixed(2);
        // var TotalDeductions = (UniformDeductionsInput + OtherDeductionsInput + NOTICEPERIODDeductionsInput + PendingSalaryInput)

        // Pro Rata Basis Payment (LTA Amount)
        var LTAAmount =  ParseFloatCustom("#PRORATABASISPAYMENT");

        // Total Section 
        var LTAValue =  ParseFloatCustom("#LTAAmount");
        var OtherEarningsValue =  ParseFloatCustom("#OtherEarnings");
        var GraturityPaymentsEarningValue =  ParseFloatCustom("#GraturityPaymentsEarning");
        var TOTALEARNINGValue =  parseFloat((LTAValue + PLPaymentAmount + OtherEarningsValue + PendingSalaryInput + GraturityPaymentsEarningValue).toFixed(2))

        // Payable Amount
        var TotalPayableAmount = parseFloat(TOTALEARNINGValue - TotalDeductions).toFixed(2);

        // Advance Salary 
        var TotalAdvanceTaken =  ParseFloatCustom("#TotalAdvanceTaken");
        var TotalAdvancePaid =  ParseFloatCustom("#TotalAdvancePaid");

        var TotalRemainingAmount = parseFloat(TotalAdvanceTaken - TotalAdvancePaid).toFixed(2);


        // Final Payable Amount
        // var TotalFinalPayableAmount = parseFloat(PendingSalaryInput + TotalPayableAmount).toFixed(2);


        
        // Set values to inputs
        $("#plBal").val(PLBalance.toFixed(2));
        $("#TotalPL").val(PLBalance.toFixed(2));
        $("#PlRate").val(PLPaymentRate);
        $("#PLAmount").val(PLPaymentAmount);
        $("#FinalPLPaymentAmount").val(PLPaymentAmount);
        $("#NPPRate").val(TotalNoticeRate);
        $("#NPPAmount").val(TotalNoticeAmount);
        $("#NOTICEPERIODDeductions").val(TotalNoticeAmount);
        $("#TOTALEARNING").val(TOTALEARNINGValue);
        $("#LTAAmount").val(LTAAmount.toFixed(2));
        $("#TotalDeductions").val(TotalDeductions);
        $("#RemainingAmount").val(TotalRemainingAmount);

        $("#AdvanceSalary").val($("#RemainingAmount").val());
        $("#GraturityPaymentsEarning").val($("#GraturityPayments").val());

        $("#PayableAmount").val(TotalPayableAmount);
        // $("#FinalPayableAmount").val(TotalFinalPayableAmount);
    }

    // EntryCalculations();

    function calculateLeaveEarned() {
        var fromDateValue = $("#FromDate").val();
        var toDateValue = $("#ToDate").val();

        if (fromDateValue && toDateValue) {
            var fromDate = new Date(fromDateValue);
            var toDate = new Date(toDateValue);

            var yearDiff = toDate.getFullYear() - fromDate.getFullYear();
            var monthDiff = toDate.getMonth() - fromDate.getMonth();

            var totalMonths = yearDiff * 12 + monthDiff;

            // If toDate day >= fromDate day, count as a full month
            if (toDate.getDate() >= fromDate.getDate()) {
                totalMonths += 1;
            }

            // Avoid negative month values
            totalMonths = Math.max(0, totalMonths);

            var leaveEarned = (totalMonths * 1.75).toFixed(2);

            $("#leaveEarned").val(leaveEarned);
        }
    }

    $("#FromDate, #ToDate").on("change", function () {
        calculateLeaveEarned();
        EntryCalculations();
    });

//     $(document).ready(function () {
//     // Trigger `EntryCalculations()` when any of these input fields change
//     $("#FromDate, #ToDate, #OpeningBalance, #leaveEarned, #leaveAvailed, #GrossSalary #BasicSalary, #plBal, #OtherEarnings #TOTALEARNING")
//         .on("change input", function () {
//             EntryCalculations();
//         });

//     // Initial run
//     EntryCalculations();
// });

    $(document).ready(function () {
        // Bind input fields that affect calculations
        $("#FromDate, #ToDate, #OpeningBalance, #leaveEarned, #TotalAdvancePaid, #TotalAdvanceTaken,  #RemainingAmount,  #leaveAvailed, #GrossSalary, #BasicSalary, #plBal, #OtherEarnings, #TOTALEARNING, #LTAAmount, #UniformDeductions, #OtherDeductions, #NOTICEPERIODDeductions, #PendingSalary, #TotalNoticePayDays, #NoOfYears, #LastBasics, #GraturityDaysPeryear, #PRORATABASISPAYMENT")
            .on("change input", function () {
                EntryCalculations();
            });

        // Initial run
        EntryCalculations();
    });




</script> -->
<!-- 
<script>
    var ParseFloatCustom = function (obj) {
        try {
            var a = $(obj).val();
            a = parseFloat(a);
            return isNaN(a) ? 0 : a;
        } catch (e) {}
        return 0;
    }

    var EntryCalculations = function () {
        calculateLeaveEarned(); // Calculate first

        // LEAVE SUMMARY and PL PAYMENT 
        var FromDateInput = $("#FromDate").val();
        var ToDateInput = $("#ToDate").val();
        var OpeningBalanceInput = ParseFloatCustom("#OpeningBalance");
        var LeaveEarnedInput = ParseFloatCustom("#leaveEarned");
        var LeaveAvailedInput = ParseFloatCustom("#leaveAvailed");
        var PlBalanceInput = ParseFloatCustom("#plBal");


        
        //  PL PAYMENT
        var TotalPLInput = ParseFloatCustom("#TotalPL");
        var BasicSalaryInput = ParseFloatCustom("#BasicSalary");
        var PLPaymentRateInput = ParseFloatCustom("#PlRate");
        var PLAmountInput = ParseFloatCustom("#PLAmount");

        // NOTICE PERIOD PAY 
        var GrossSalaryInput = ParseFloatCustom("#GrossSalary");

        // console.log("BasicSalaryInput::", BasicSalaryInput);
        // console.log("OpeningBalanceInput::", OpeningBalanceInput);
        // console.log("LeaveEarnedInput::", LeaveEarnedInput);
        // console.log("LeaveAvailedInput::", LeaveAvailedInput);
        // console.log("PlBalanceInput::", PlBalanceInput);
        // console.log("FromDateInput::", FromDateInput);
        // console.log("ToDateInput::", ToDateInput);

        // PL Balance 
        PLBalance = (OpeningBalanceInput + LeaveEarnedInput) - LeaveAvailedInput

        // PL PAYMENT Rate and Amount
        var PLPaymentRate = ((BasicSalaryInput * 12) / 365).toFixed(2);
        var PLPaymentAmount = PLPaymentRate * TotalPLInput
        


        console.log("PLBalance::", PLBalance);

        // var LE = ParseFloatCustom("#LE"); // Leave Earned
        // var LA = ParseFloatCustom("#LA"); // Leave Availed
        // var LB = LE - LA;

        // $("#LB").val(LB); // Assign Leave Balance
        $("#plBal").val(PLBalance)
        $("#TotalPL").val(PLBalance)
        $("#PlRate").val(PLPaymentRate)
        $("#PLAmount").val(PLPaymentAmount)


    }

    EntryCalculations();

    function calculateLeaveEarned() {
        var fromDateValue = $("#FromDate").val();
        var toDateValue = $("#ToDate").val();

        if (fromDateValue && toDateValue) {
            var fromDate = new Date(fromDateValue);
            var toDate = new Date(toDateValue);

            var yearDiff = toDate.getFullYear() - fromDate.getFullYear();
            var monthDiff = toDate.getMonth() - fromDate.getMonth();

            var totalMonths = yearDiff * 12 + monthDiff;

            // If toDate day >= fromDate day, count as a full month
            if (toDate.getDate() >= fromDate.getDate()) {
                totalMonths += 1;
            }

            // Avoid negative month values
            totalMonths = Math.max(0, totalMonths);

            var leaveEarned = (totalMonths * 1.75).toFixed(2);

            $("#leaveEarned").val(leaveEarned);
        }
    }

    $("#FromDate, #ToDate").on("change", function () {
        calculateLeaveEarned();
        // calculateLeaveEarned();
    });


</script> 
--->
<!-- <script>
    document.addEventListener("DOMContentLoaded", function () {
        // const fromDateInput = document.getElementById("FromDate");
        // const toDateInput = document.getElementById("ToDate");
        // const leaveEarnedInput = document.getElementById("leaveEarned");

        const fromDateInput = document.getElementById("FromDate");
        const toDateInput = document.getElementById("ToDate");
        const openingBalanceInput = document.getElementById("OpeningBalance");
        const leaveEarnedInput = document.getElementById("leaveEarned");
        const leaveAvailedInput = document.getElementById("leaveAvailed");
        const plBalInput = document.getElementById("plBal");
        const TotalPL = document.getElementById("TotalPL");
        const PlRateInput = document.getElementById("PlRate");
        const BasicSalaryInput = document.getElementById("BasicSalary");
        const TotalNoticePayDaysInput = document.getElementById("TotalNoticePayDays");

        function calculateLeaveEarned() {
            const fromDateValue = fromDateInput.value;
            const toDateValue = toDateInput.value;

            if (fromDateValue && toDateValue) {
                const fromDate = new Date(fromDateValue);
                const toDate = new Date(toDateValue);

                let yearDiff = toDate.getFullYear() - fromDate.getFullYear();
                let monthDiff = toDate.getMonth() - fromDate.getMonth();

                let totalMonths = yearDiff * 12 + monthDiff;

                // Optional: If the toDate day is greater or equal to fromDate day, count it as a full month
                if (toDate.getDate() >= fromDate.getDate()) {
                    totalMonths += 1;
                }

                // Ensure no negative months
                totalMonths = Math.max(0, totalMonths);

                const leaveEarned = (totalMonths * 1.75).toFixed(2);

                leaveEarnedInput.value = leaveEarned;
            }
        }

        function calculatePLBalance() {
            const openingBalance = parseFloat(openingBalanceInput.value) || 0;
            const leaveEarned = parseFloat(leaveEarnedInput.value) || 0;
            const leaveAvailed = parseFloat(leaveAvailedInput.value) || 0;

            const plBal = (openingBalance + leaveEarned - leaveAvailed).toFixed(2);
            plBalInput.value = plBal;
            TotalPL.value = plBal;
        }

        // function calculatePLPayment() {
        //     const PLBalance = parseFloat(plBalInput.value) || 0;
        //     const basicSalary = parseFloat(BasicSalaryInput.value) || 0;

        //     const PLPaymentRate = (basicSalary * 12) / 365;
        //     PlRateInput.value = PLPaymentRate.toFixed(2); // optionally multiply by PLBalance
        // }
        
        function calculatePLPayment() {
            // console.log("Calculating PL Rate..."); // Debug log

            const PLBalance = parseFloat(plBalInput?.value) || 0;
            const basicSalary = parseFloat(BasicSalaryInput?.value) || 0;

            const PLPaymentRate = (basicSalary * 12) / 365;

            // console.log("basicSalary:", basicSalary); // Debug log
            // console.log("PLPaymentRate:", PLPaymentRate); // Debug log

            if (PlRateInput) {
                PlRateInput.value = PLPaymentRate.toFixed(2);
            }
        }


        function CalculateNoticePeriodPay() {
            console.log("Calculating PL Rate..."); // Debug log

            const GrossSalary = parseFloat(GrossSalaryInput?.value) || 0;
            const basicTotalNoticePayDays = parseFloat(TotalNoticePayDaysInput?.value) || 0;

            const PLPaymentRate = (basicSalary * 12) / 365;

            console.log("basicSalary:", basicSalary); // Debug log
            console.log("PLPaymentRate:", PLPaymentRate); // Debug log

            if (PlRateInput) {
                PlRateInput.value = PLPaymentRate.toFixed(2);
            }
        }


        // Event listeners
        // fromDateInput.addEventListener("change", calculateLeaveEarned);
        // toDateInput.addEventListener("change", calculateLeaveEarned);

        // Initial calculation on page load
        // calculateLeaveEarned();
        
        // Event listeners
        // fromDateInput.addEventListener("change", calculateLeaveEarned);
        // toDateInput.addEventListener("change", calculateLeaveEarned);
        // BasicSalaryInput.addEventListener("input", calculatePLPayment);

        // openingBalanceInput.addEventListener("input", calculatePLBalance);
        // leaveEarnedInput.addEventListener("input", calculatePLBalance);
        // leaveAvailedInput.addEventListener("input", calculatePLBalance);

        // // Initial calculation on page load
        // calculateLeaveEarned();
        // calculatePLBalance();
        // calculatePLPayment();

        if (fromDateInput && toDateInput) {
            fromDateInput.addEventListener("change", calculateLeaveEarned);
            toDateInput.addEventListener("change", calculateLeaveEarned);
        }

        // if (BasicSalaryInput) {
        //     BasicSalaryInput.addEventListener("input", calculatePLPayment);
        // }
        calculatePLPayment()

        if (openingBalanceInput && leaveEarnedInput && leaveAvailedInput) {
            openingBalanceInput.addEventListener("input", calculatePLBalance);
            leaveEarnedInput.addEventListener("input", calculatePLBalance);
            leaveAvailedInput.addEventListener("input", calculatePLBalance);
        }

        // Initial calculations, but only if elements exist
        if (fromDateInput && toDateInput) calculateLeaveEarned();
        if (openingBalanceInput && leaveEarnedInput && leaveAvailedInput) calculatePLBalance();
        // if (BasicSalaryInput) calculatePLPayment();
    });
</script> -->


<!-- 
    <script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const fromDateInput = document.getElementById("FromDate");
        const toDateInput = document.getElementById("ToDate");
        const leaveEarnedInput = document.getElementById("leaveEarned");
        const leaveAvailedInput = document.getElementById("leaveAvailed");
        const plBalanceInput = document.getElementById("plBal"); // Ensure ID is used only once
        const openingBalanceInput = document.getElementById("OpeningBalance");
        const PLBasicSalary = document.getElementById("BasicSalary");
        const PlRate = document.getElementById("PlRate");
        const TotalPLInput = document.getElementById("TotalPL");
        const PLAmountInput = document.getElementById("PLAmount");
        const TotalNoticePayDaysInput = document.getElementById("TotalNoticePayDays");
        const NoticePeriodRateInput = document.getElementById("NPPRate");
        const NoticePeriodAmountInput = document.getElementById("NPPAmount");
        const GrossSalaryInput = document.getElementById("Gross");

        function updateToDateAndLeave() {
            const fromDateValue = fromDateInput.value;
            if (!fromDateValue) return;

            const fromDate = new Date(fromDateValue);
            const autoToDate = new Date(fromDate);
            autoToDate.setDate(autoToDate.getDate() + 365);

            const yyyy = autoToDate.getFullYear();
            const mm = String(autoToDate.getMonth() + 1).padStart(2, '0');
            const dd = String(autoToDate.getDate()).padStart(2, '0');
            toDateInput.value = `${yyyy}-${mm}-${dd}`;

            leaveEarnedInput.value = (12 * 1.75).toFixed(2);
            calculateOpeningBalance();
        }

        function calculateLeaveEarned() {
            const fromDateValue = fromDateInput.value;
            const toDateValue = toDateInput.value;

            if (!fromDateValue || !toDateValue) return;

            const fromDate = new Date(fromDateValue);
            const toDate = new Date(toDateValue);

            let monthDiff = (toDate.getFullYear() - fromDate.getFullYear()) * 12 +
                            (toDate.getMonth() - fromDate.getMonth());

            if (toDate.getDate() < fromDate.getDate()) {
                monthDiff -= 1;
            }

            const leaveEarned = Math.max(0, monthDiff * 1.75);
            leaveEarnedInput.value = leaveEarned.toFixed(2);
            calculateOpeningBalance();
        }

        function calculateOpeningBalance() {
            const earned = parseFloat(leaveEarnedInput.value) || 0;
            const availed = parseFloat(leaveAvailedInput.value) || 0;
            const plBalance = parseFloat(plBalanceInput.value) || 0;

            const openingBalance = plBalance - (earned - availed);
            // const openingBalance = (earned - availed) + plBalance;
            openingBalanceInput.value = openingBalance.toFixed(2);
        }


        // Listeners
        fromDateInput.addEventListener("change", () => {
            updateToDateAndLeave();
            calculateLeaveEarned();
        });

        // NOTICE PERIOD PAY
        function calculateNoticePeriodPay() {
            const TotalNoticePayDaysValue = parseFloat(TotalNoticePayDaysInput.value) || 0;
            const GrossValue = parseFloat(GrossSalaryInput.value) || 0;
            const NoticePeriodRate = (GrossValue * 12) / 365;

            
            const NoticePeriodAmount = (NoticePeriodRate * TotalNoticePayDaysValue);

            NoticePeriodRateInput.value = NoticePeriodRate.toFixed(2);
            NoticePeriodAmountInput.value = NoticePeriodAmount.toFixed(2);
        }

        // function calculatePLBasicSalary() {
        //     const basicSalary = parseFloat(PLBasicSalary.value) || 0;
        //     const PLBasicSalaryBalance = (basicSalary * 12) / 365;

        //     PlRateValue = PLBasicSalaryBalance.toFixed(2);
        //     PlRateValueFixed = (Math.ceil(PlRateValue * 100) / 100).toFixed(2);
        //     PlRate.value = PlRateValueFixed;
        // }

        function calculatePLBasicSalary() {
            const basicSalary = parseFloat(PLBasicSalary.value) || 0;
            const PLBasicSalaryBalance = (basicSalary * 12) / 365;

            // Apply Math.ceil to the raw number BEFORE converting to string
            const PlRateValueFixed = (Math.ceil(PLBasicSalaryBalance * 100) / 100).toFixed(2);
            
            PlRate.value = PlRateValueFixed;
        }


        function calculatePLAmount() {
            const rate = parseFloat(PlRate.value) || 0;
            const totalPL = parseFloat(TotalPLInput.value) || 0;
            const amount = rate * totalPL;
            PLAmountInput.value = amount.toFixed(2);

            // PLAmountInput.value = amount.toFixed(2);
        }

        toDateInput.addEventListener("change", calculateLeaveEarned);
        leaveEarnedInput.addEventListener("input", calculateOpeningBalance);
        leaveAvailedInput.addEventListener("input", calculateOpeningBalance);
        plBalanceInput.addEventListener("input", calculateOpeningBalance);
        PLBasicSalary.addEventListener("input", calculatePLBasicSalary);
        PlRate.addEventListener("input", calculatePLAmount);
        TotalPLInput.addEventListener("input", calculatePLAmount);

        GrossSalaryInput.addEventListener("input", calculateNoticePeriodPay);




        // Initial setup
        updateToDateAndLeave();
        calculateLeaveEarned();
        calculatePLBasicSalary(); // on DOM load
        calculatePLAmount();
        calculateNoticePeriodPay();
    });
</script> 
-->

{% endblock content %}
